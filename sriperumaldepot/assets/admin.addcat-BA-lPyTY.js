import{r as d,j as e,C as B,Q as O,S as L,U as _,V as K}from"./index-Drggu8kb.js";import{u as M,A as $,T as G,a as H}from"./productStore-9e27gCiD.js";import{n as j,C as b,A as Q,a as V,I as q,P as J,S as k,N as X,E as Y,b as Z}from"./index.browser-BR_XCwzo.js";import{a as t,T as s,b as S,P as y}from"./Button-Ckuc6VIP.js";import{I as x}from"./IconButton-Dn7Ej2Im.js";import{S as n,E as ee,C as re}from"./ExpandMore-CBmZJWmM.js";import{T as p,I as te}from"./TextField-_uvGVg9z.js";import{D as se}from"./Delete-QB8z1-hN.js";import"./useThemeProps-B2JTY9_F.js";import"./SwitchBase-C84RVtdc.js";import"./Select-Ctc3Tosv.js";import"./isMuiElement-9v0YadKW.js";function ue(){const{pushCategorytoDb:W,updateCategory:R,deleteCategory:D,categoryItems:E,fetchProducts:m}=M();d.useState(()=>{m()});const[h,C]=d.useState(null),[u,f]=d.useState(!1),[o,g]=d.useState({name:"",sku:"",id:j(),category:"",detail:"",price:0,originalPrice:0,icon:"fitness_center",imageColor:"black",src:"",sale:!1,isNew:!0,sizes:[],categoryOnly:!0}),l=(r,i)=>{g(a=>({...a,[r]:i}))},[A,v]=d.useState(!1),w=d.useRef(null),P=async r=>{const i=r.target.files?.[0];if(i){v(!0);try{const a=O(L,`categories/${j()}_${i.name}`),c=await _(a,i),F=await K(c.ref);g(N=>({...N,src:F}))}catch(a){console.error("Error uploading image: ",a),alert("Failed to upload image.")}finally{v(!1)}}},z=async()=>{try{const r=Object.entries(o).reduce((i,[a,c])=>(c!==void 0&&(typeof c=="string"?i[a]=c.trim():i[a]=c),i),{});if(r.category=r.name,console.log("Saving category...",r),!r.name||!r.src||!r.detail){alert("Please fill all details");return}h?(await R(r),alert("Category updated successfully!")):(await W(r),alert("Category saved successfully!")),await m(),I()}catch(r){console.error("Error saving category:",r),alert("Failed to save category")}},T=r=>{g({...r,categoryOnly:!0}),C(r.id),f(!0),window.scrollTo({top:0,behavior:"smooth"})},U=async r=>{confirm("Are you sure you want to delete this category?")&&(await D(r),await m())},I=()=>{g({name:"",sku:"",id:j(),category:"",detail:"",price:0,originalPrice:0,icon:"fitness_center",imageColor:"black",src:"",sale:!1,isNew:!0,sizes:[],categoryOnly:!0}),C(null),f(!1),window.scrollTo({top:0,behavior:"smooth"})};return e.jsxs(t,{sx:{minHeight:"100vh",bgcolor:"background.default",pb:10},children:[e.jsx($,{position:"sticky",color:"default",elevation:0,sx:{bgcolor:"background.paper",borderBottom:1,borderColor:"divider"},children:e.jsxs(G,{children:[e.jsx(x,{onClick:()=>window.history.back(),edge:"start",children:e.jsx(H,{})}),e.jsx(s,{variant:"h6",component:"h1",sx:{flexGrow:1,textAlign:"center",pr:5,fontWeight:"bold"},children:h?"Edit Category":"Add Category"}),h&&e.jsx(S,{color:"inherit",onClick:I,children:"Cancel Edit"})]})}),e.jsx(b,{maxWidth:"sm",sx:{py:3,display:"flex",flexDirection:"column",gap:3},children:e.jsxs(t,{sx:{border:1,borderColor:"divider",borderRadius:3,overflow:"hidden",bgcolor:"background.paper"},children:[e.jsxs(t,{onClick:()=>f(!u),sx:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",p:2,bgcolor:"action.hover",transition:"background-color 0.2s","&:hover":{bgcolor:"action.selected"}},children:[e.jsxs(n,{direction:"row",spacing:1.5,alignItems:"center",children:[e.jsx(Q,{color:"primary"}),e.jsx(s,{variant:"subtitle1",sx:{fontWeight:"bold"},children:h?"Edit Category Details":"Add New Category"})]}),e.jsx(x,{size:"small",sx:{transform:u?"rotate(180deg)":"none",transition:"transform 0.3s"},children:e.jsx(ee,{})})]}),e.jsx(re,{in:u,children:e.jsxs(t,{sx:{p:2,display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(t,{children:[e.jsx(s,{variant:"subtitle2",sx:{mb:1,fontWeight:"bold",textTransform:"uppercase"},children:"Category Image"}),e.jsx(p,{fullWidth:!0,placeholder:"Paste image URL or upload...",value:o.src??"",onChange:r=>l("src",r.target.value),InputProps:{endAdornment:e.jsxs(te,{position:"end",children:[e.jsx(x,{onClick:()=>w.current?.click(),edge:"end",children:A?e.jsx(B,{size:24}):e.jsx(V,{color:"primary"})}),e.jsx("input",{type:"file",hidden:!0,ref:w,accept:"image/*",onChange:P})]}),sx:{borderRadius:3}}}),e.jsx(t,{sx:{mt:2,height:160,borderRadius:3,border:"2px dashed",borderColor:"divider",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",bgcolor:"action.hover"},children:o.src?e.jsx(t,{component:"img",src:o.src,sx:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsxs(e.Fragment,{children:[e.jsx(q,{sx:{fontSize:40,opacity:.5,mb:1}}),e.jsx(s,{variant:"caption",sx:{opacity:.7},children:"Image preview will appear here"})]})})]}),e.jsxs(n,{spacing:2,children:[e.jsxs(n,{direction:"row",spacing:2,children:[e.jsxs(t,{flex:1,children:[e.jsx(s,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Category Name"}),e.jsx(p,{fullWidth:!0,placeholder:"Category Label",value:o.name??"",onChange:r=>{l("name",r.target.value),l("category",r.target.value)}})]}),e.jsxs(t,{width:140,children:[e.jsx(s,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"SKU ID"}),e.jsx(p,{fullWidth:!0,placeholder:"CAT-001",value:o.sku??"",onChange:r=>l("sku",r.target.value)})]})]}),e.jsxs(t,{children:[e.jsx(s,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Detail"}),e.jsx(p,{fullWidth:!0,multiline:!0,minRows:3,placeholder:"Describe the category features...",value:o.detail??"",onChange:r=>l("detail",r.target.value)})]})]}),e.jsx(t,{sx:{my:1,borderTop:1,borderColor:"divider",borderStyle:"dashed"}}),e.jsxs(y,{variant:"outlined",sx:{borderRadius:3,overflow:"hidden"},children:[e.jsxs(t,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px dashed",borderColor:"divider"},children:[e.jsxs(n,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(t,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"primary.light",color:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(J,{fontSize:"small"})}),e.jsx(s,{fontWeight:500,children:"On Sale"})]}),e.jsx(k,{checked:o.sale??!1,onChange:r=>l("sale",r.target.checked)})]}),e.jsxs(t,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(n,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(t,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"primary.light",color:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(X,{fontSize:"small"})}),e.jsx(s,{fontWeight:500,children:"New Arrival"})]}),e.jsx(k,{checked:o.isNew??!0,onChange:r=>l("isNew",r.target.checked)})]})]})]})})]})}),e.jsx(b,{maxWidth:"sm",sx:{pb:10},children:e.jsxs(t,{sx:{mt:4},children:[e.jsx(s,{variant:"h6",sx:{mb:2,fontWeight:"bold"},children:"Manage Categories"}),e.jsx(n,{spacing:2,children:E.map(r=>e.jsx(y,{variant:"outlined",sx:{p:2,borderRadius:2},children:e.jsxs(n,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(t,{component:"img",src:r.src||"",sx:{width:60,height:60,objectFit:"cover",borderRadius:2,bgcolor:"action.hover"}}),e.jsxs(t,{flex:1,children:[e.jsx(s,{fontWeight:600,children:r.name}),e.jsx(n,{direction:"row",spacing:1,alignItems:"center",children:e.jsx(s,{variant:"caption",color:"text.secondary",children:r.detail})}),r.sku&&e.jsxs(s,{variant:"caption",color:"text.secondary",children:["SKU: ",r.sku]})]}),e.jsx(x,{size:"small",onClick:()=>T(r),children:e.jsx(Y,{})}),e.jsx(x,{size:"small",color:"error",onClick:()=>U(r.id),children:e.jsx(se,{})})]})},r.id))})]})}),e.jsx(y,{sx:{position:"fixed",bottom:0,left:0,right:0,p:2,bgcolor:"background.paper",borderTop:1,borderColor:"divider",zIndex:10},elevation:4,children:e.jsx(b,{maxWidth:"sm",children:e.jsx(S,{fullWidth:!0,variant:"contained",size:"large",startIcon:e.jsx(Z,{}),onClick:z,sx:{height:56,borderRadius:3,fontSize:"1.1rem",fontWeight:"bold",boxShadow:2},children:h?"Update Category":"Save Category"})})})]})}export{ue as component};
