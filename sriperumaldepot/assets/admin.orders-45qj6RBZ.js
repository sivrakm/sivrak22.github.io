import{$ as ye,a as je,u as Ce,r as i,j as e,B as s,I as g,A as $,t as x,S as h,C as ve,x as Se,v as we,J as F,w as De,Y as H,F as ke,G as b,K as Re,M as Te,N as ze,H as Oe,Z as D,_ as A,a0 as Q}from"./index-Bkxv6Uxe.js";import{p as Ae}from"./printInvoice--RSYkIr8.js";import{O as Pe}from"./OrderItem-CD-Q_9sO.js";import{O as Ie,a as Le,W as Ee,R as Be,c as We}from"./WhatsAppShareButton-DbtPb9Fq.js";import{C as U,I as Ne,H as Me}from"./Inventory2-DgEXUS6a.js";import{S as qe}from"./Search-BBfysH3Y.js";import{B as a}from"./Button-4CCY_ygF.js";import{D as Y}from"./dividerClasses-D75e7TuT.js";import{D as J,a as G,b as K}from"./DialogTitle-IRCyoplM.js";import{D as X}from"./DialogContentText-BfCMsLuo.js";import{C as $e}from"./CheckCircle-iUq6-wjz.js";import{L as Fe}from"./LocalShipping-BSn-WcHy.js";import"./ShoppingCart-DitjyfuX.js";import"./Divider-DRgpaPk6.js";import"./QuantitySelector-BiNPJCdI.js";import"./Add-BfLSGc9R.js";import"./TextField-Cu-5JuGP.js";import"./isMuiElement-BGMeBMg7.js";import"./FormControlLabel-B-f_mJM1.js";import"./Checkbox-ov4b37Me.js";function He(P){return ye({select:u=>u.location})}const k=Oe`
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
`;function dr(){const P=je(),u=Ce(r=>r.user),[I,Z]=i.useState([]),[_,y]=i.useState(!0),[l,V]=i.useState("All"),[R,ee]=i.useState(null),[re,j]=i.useState(!1),[L,E]=i.useState(null),[te,B]=i.useState(!1),[m,oe]=i.useState(null),[se,T]=i.useState(!1),[C,v]=i.useState(""),W=He();i.useEffect(()=>{const t=new URLSearchParams(W.search).get("search");t&&(v(t),T(!0))},[W.search]);const[ne,S]=i.useState(!1),[N,z]=i.useState(""),[p,M]=i.useState(null),ie=["All","Processing","Delivered","Cancelled"],f=async()=>{if(!u){y(!1);return}try{const r=ke(b,"orders"),t=Re(r,Te("timestamp","desc")),n=(await ze(t)).docs.map(c=>({id:c.id,...c.data()}));Z(n)}catch(r){console.error("Error fetching orders:",r)}finally{y(!1)}};i.useEffect(()=>{f()},[u]);const d=I.filter(r=>{if(l!=="All"&&(r.status==="pending"?"Processing":r.status).toLowerCase()!==l.toLowerCase())return!1;if(C.trim()){const t=C.toLowerCase(),o=r.id.toLowerCase().includes(t),n=r.shippingDetails||{},c=(n.firstName?.toLowerCase()||"").includes(t)||(n.lastName?.toLowerCase()||"").includes(t),w=(n.phoneNumber||"").includes(t),fe=(n.orgName?.toLowerCase()||"").includes(t),ge=r.items?.some(be=>be.name.toLowerCase().includes(t));return o||c||w||fe||ge}return!0}),ae=async()=>{if(!u||!u.phoneNumber){alert("User phone number not found. Cannot verify identity.");return}if(N!==u.phoneNumber){alert("Phone number does not match logged-in user.");return}const r=d;if(r.length!==0){y(!0);try{const t=r.map(async o=>{const n=D(b,"orders",o.id);p==="deliver"?o.status!=="Delivered"&&await A(n,{status:"Delivered"}):p==="delete"&&await Q(n)});await Promise.all(t),alert(`Bulk ${p==="deliver"?"Delivery":"Deletion"} Complete!`),S(!1),z(""),M(null),f()}catch(t){console.error("Bulk action error:",t),alert("Failed to perform bulk action.")}finally{y(!1)}}},q=r=>{M(r),S(!0),z("")},le=r=>{switch(r.toLowerCase()){case"pending":case"processing":return{label:"Processing",icon:e.jsx(Me,{fontSize:"small"}),color:"warning.main",bgcolor:"rgba(237, 108, 2, 0.1)",borderColor:"rgba(237, 108, 2, 0.2)"};case"shipped":return{label:"Shipped",icon:e.jsx(Fe,{fontSize:"small"}),color:"info.main",bgcolor:"rgba(2, 136, 209, 0.1)",borderColor:"rgba(2, 136, 209, 0.2)"};case"delivered":return{label:"Delivered",icon:e.jsx(Ne,{fontSize:"small"}),color:"success.main",bgcolor:"rgba(46, 125, 50, 0.1)",borderColor:"rgba(46, 125, 50, 0.2)"};case"cancelled":return{label:"Cancelled",icon:e.jsx(U,{fontSize:"small"}),color:"error.main",bgcolor:"rgba(211, 47, 47, 0.1)",borderColor:"rgba(211, 47, 47, 0.2)"};case"returned":return{label:"Returned",icon:e.jsx(H,{fontSize:"small"}),color:"text.primary",bgcolor:"rgba(0, 0, 0, 0.08)",borderColor:"divider"};default:return{label:"Completed",icon:e.jsx($e,{fontSize:"small"}),color:"text.secondary",bgcolor:"action.hover",borderColor:"divider"}}},O=(r,t)=>{try{const o=D(b,"orders",r);A(o,{status:t}),f()}catch(o){console.error("Error updating order status:",o),alert("Failed to update order status = "+r)}},ce=async()=>{if(L)try{const r=D(b,"orders",L);await Q(r),j(!1),E(null),alert("Order deleted successfully"),f()}catch(r){console.error("Error deleting order:",r),alert("Failed to delete order")}},de=r=>{E(r),j(!0)},ue=r=>{if(!r)return"Just now";const t=r.toDate(),n=new Date().getTime()-t.getTime(),c=Math.floor(n/(1e3*60*60*24));return c===0?`Today, ${t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:c===1?`Yesterday, ${t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},pe=r=>{ee(R===r?null:r)},xe=r=>{const t=I.find(o=>o.id===r);Ae(t)},he=r=>{oe(r),B(!0)},me=async r=>{if(m)try{const t=We(r,m.manualAddons,m.deliveryAmount),o=r.every(w=>(w.returnedQuantity||0)>=w.quantity),n={...t,items:r};o&&(n.status="Returned");const c=D(b,"orders",m.id);await A(c,n),alert("Return processed successfully"),f()}catch(t){throw console.error("Error processing return:",t),t}};return e.jsxs(s,{sx:{pb:10,bgcolor:"background.default",minHeight:"100vh",color:"text.primary"},children:[e.jsx(s,{sx:{position:"sticky",top:0,zIndex:1100,bgcolor:"background.default",borderBottom:1,borderColor:"divider"},children:e.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2,height:60},children:se?e.jsxs(s,{sx:{display:"flex",alignItems:"center",flex:1,gap:1},children:[e.jsx(g,{onClick:()=>{T(!1),v("")},children:e.jsx($,{})}),e.jsx("input",{autoFocus:!0,placeholder:"Search orders...",style:{flex:1,border:"none",outline:"none",background:"transparent",fontSize:"1rem",color:"inherit"},value:C,onChange:r=>v(r.target.value)}),C&&e.jsx(g,{size:"small",onClick:()=>v(""),children:e.jsx(U,{fontSize:"small"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{sx:{ml:-1},onClick:()=>P({to:"/shop"}),children:e.jsx($,{})}),e.jsxs(x,{variant:"h6",sx:{fontWeight:"bold"},children:["Estimate"," History"]}),e.jsx(g,{sx:{mr:-1},onClick:()=>T(!0),children:e.jsx(qe,{})})]})})}),e.jsxs(s,{sx:{p:2},children:[e.jsx(s,{sx:{display:"flex",gap:1.5,overflowX:"auto",p:2,mb:2,"&::-webkit-scrollbar":{display:"none"},animation:`${k} 0.6s ease-out forwards`},children:ie.map(r=>e.jsx(a,{variant:l===r?"contained":"outlined",onClick:()=>V(r),sx:{flexShrink:0,borderRadius:50,textTransform:"none",fontWeight:"bold",fontSize:"0.875rem",px:3,py:1,bgcolor:l===r?"primary.main":"background.paper",color:l===r?"black":"text.secondary",borderColor:l===r?"primary.main":"divider",boxShadow:l===r?"0 4px 12px rgba(242, 215, 13, 0.2)":"none","&:hover":{bgcolor:l===r?"primary.main":"action.hover",borderColor:l===r?"primary.main":"divider"}},children:r},r))}),e.jsxs(h,{direction:"row",spacing:2,sx:{px:2,mb:2},justifyContent:"flex-end",children:[e.jsxs(a,{size:"small",variant:"outlined",color:"success",onClick:()=>q("deliver"),disabled:d.length===0,children:["Deliver All (",d.length,")"]}),e.jsxs(a,{size:"small",variant:"outlined",color:"error",onClick:()=>q("delete"),disabled:d.length===0,children:["Delete All (",d.length,")"]})]}),_?e.jsx(s,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(ve,{})}):d.length===0?e.jsx(s,{sx:{textAlign:"center",py:8,animation:`${k} 0.6s ease-out forwards`},children:e.jsx(x,{color:"text.secondary",children:"No orders found."})}):e.jsx(h,{spacing:2,sx:{animation:`${k} 0.6s ease-out forwards`,animationDelay:"0.1s"},children:d.map(r=>{const t=le(r.status);return e.jsx(Se,{sx:{p:2,borderRadius:3,border:1,borderColor:"divider",boxShadow:"none",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",transition:"all 0.2s","&:active":{transform:"scale(0.98)"}},onClick:()=>pe(r.id),children:e.jsxs(s,{sx:{width:"100%"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(we,{sx:{width:48,height:48,bgcolor:t.bgcolor,color:t.color,border:1,borderColor:t.borderColor},children:t.icon}),e.jsxs(s,{children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(x,{variant:"body2",sx:{fontWeight:"bold"},children:["#",r.id.slice(0,5).toUpperCase()]}),r.items?.some(o=>(o.returnedQuantity||0)>0)&&e.jsx(s,{sx:{px:.75,py:.25,borderRadius:1,bgcolor:r.items.every(o=>(o.returnedQuantity||0)>=o.quantity)?"error.main":"warning.main",color:"white",fontSize:"0.65rem",fontWeight:"bold",lineHeight:1},children:r.items.every(o=>(o.returnedQuantity||0)>=o.quantity)?"RETURNED":"PARTIAL"})]}),e.jsx(x,{variant:"caption",sx:{color:"text.secondary",mt:.5,display:"block"},children:ue(r.timestamp)})]})]}),e.jsxs(s,{sx:{textAlign:"right",display:"flex",alignItems:"center",gap:1},children:[e.jsxs(s,{children:[e.jsxs(x,{variant:"body2",sx:{fontWeight:"bold"},children:["â‚¹",r.total.toLocaleString()]}),e.jsx(s,{sx:{display:"inline-block",mt:.5,px:1.5,py:.25,borderRadius:10,bgcolor:t.bgcolor,color:t.color,fontSize:"0.625rem",fontWeight:"bold",textTransform:"uppercase",letterSpacing:.5},children:t.label})]}),e.jsx(g,{size:"small",sx:{transform:R===r.id?"rotate(180deg)":"none",transition:"transform 0.3s"},children:e.jsx(F,{})})]})]}),e.jsxs(De,{in:R===r.id,timeout:"auto",unmountOnExit:!0,children:[e.jsx(s,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:e.jsx(Ie,{order:r})}),e.jsx(s,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:e.jsx(a,{size:"small",variant:"outlined",color:"error",onClick:()=>de(r.id),children:"Delete"})}),e.jsx(s,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:e.jsx(Le,{shippingDetails:r.shippingDetails||{}})}),e.jsxs(s,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:[e.jsxs(x,{variant:"caption",sx:{fontWeight:"bold",color:"text.secondary",mb:1.5,display:"block",textTransform:"uppercase",letterSpacing:.5},children:["Estimate"," Items"]}),e.jsx(h,{spacing:2,children:r.items?.map((o,n)=>e.jsx(Pe,{item:o},n))}),e.jsxs(h,{direction:"row",spacing:1,sx:{mt:2},children:[e.jsx(a,{size:"small",variant:"outlined",color:"success",onClick:()=>O(r.id,"Delivered"),children:"Delivered"}),e.jsx(a,{size:"small",variant:"outlined",color:"error",onClick:()=>O(r.id,"Cancelled"),children:"Cancelled"}),e.jsx(a,{size:"small",variant:"outlined",color:"error",onClick:()=>O(r.id,"pending"),children:"Processing"})]})]}),e.jsx(s,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:e.jsxs(h,{direction:"row",spacing:1,sx:{mt:2},justifyContent:"space-between",children:[e.jsx(a,{size:"small",variant:"contained",color:"success",onClick:()=>xe(r.id),children:"Print"}),e.jsx(Ee,{order:r}),e.jsx(h,{direction:"row",spacing:1,children:e.jsx(a,{size:"small",variant:"outlined",color:"warning",startIcon:e.jsx(H,{}),onClick:()=>he(r),children:"Return"})})]})})]})]})},r.id)})}),e.jsx(s,{sx:{mt:4,textAlign:"center",animation:`${k} 0.6s ease-out forwards`,animationDelay:"0.3s"},children:e.jsx(a,{size:"small",endIcon:e.jsx(F,{}),sx:{color:"primary.main",fontWeight:"bold",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:1,"&:hover":{bgcolor:"transparent",color:"primary.dark"}},children:"Load More"})})]}),e.jsxs(Y,{open:re,onClose:()=>j(!1),PaperProps:{sx:{borderRadius:3,p:1}},children:[e.jsxs(J,{sx:{fontWeight:"bold"},children:["Delete ","Estimate","?"]}),e.jsx(G,{children:e.jsx(X,{children:"Are you sure you want to delete this order? This action is permanent and cannot be undone."})}),e.jsxs(K,{sx:{p:2},children:[e.jsx(a,{onClick:()=>j(!1),color:"inherit",sx:{fontWeight:"bold"},children:"Cancel"}),e.jsx(a,{onClick:ce,variant:"contained",color:"error",sx:{fontWeight:"bold",borderRadius:2},children:"Delete"})]})]}),e.jsxs(Y,{open:ne,onClose:()=>S(!1),PaperProps:{sx:{borderRadius:3,p:1}},children:[e.jsxs(J,{sx:{fontWeight:"bold"},children:["Confirm Bulk ",p==="deliver"?"Delivery":"Deletion"]}),e.jsxs(G,{children:[e.jsxs(X,{sx:{mb:2},children:["Please enter your phone number to confirm this bulk action.",e.jsx("br",{}),e.jsxs("strong",{children:["This will affect ",d.length," orders."]})]}),e.jsx("input",{type:"tel",placeholder:"Enter your phone number",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ccc",fontSize:"1rem",outline:"none"},value:N,onChange:r=>z(r.target.value)})]}),e.jsxs(K,{sx:{p:2},children:[e.jsx(a,{onClick:()=>S(!1),color:"inherit",sx:{fontWeight:"bold"},children:"Cancel"}),e.jsxs(a,{onClick:ae,variant:"contained",color:p==="delete"?"error":"primary",sx:{fontWeight:"bold",borderRadius:2},children:["Confirm ",p==="deliver"?"Delivery":"Deletion"]})]})]}),e.jsx(Be,{open:te,onClose:()=>B(!1),order:m,onSave:me})]})}export{dr as component};
