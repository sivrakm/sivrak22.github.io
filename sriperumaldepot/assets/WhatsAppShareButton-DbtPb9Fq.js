import{b as k,g as F,r as b,d as H,j as e,s as w,f as D,i as N,c as I,a1 as O,m as Y,e as et,h as z,k as L,n as ot,a2 as st,B as d,t as l,S as M}from"./index-Bkxv6Uxe.js";import{D as rt}from"./Divider-DRgpaPk6.js";import{P as nt,H as at}from"./printInvoice--RSYkIr8.js";import{Q as it}from"./QuantitySelector-BiNPJCdI.js";import{D as lt}from"./dividerClasses-D75e7TuT.js";import{S as ct,D as dt,a as ut,b as pt}from"./DialogTitle-IRCyoplM.js";import{u as Z,f as xt,c as mt,a as ht}from"./TextField-Cu-5JuGP.js";import{F as q}from"./FormControlLabel-B-f_mJM1.js";import{C as ft}from"./Checkbox-ov4b37Me.js";import{B as T}from"./Button-4CCY_ygF.js";function yt(t){return k("MuiFormGroup",t)}F("MuiFormGroup",["root","row","error"]);const gt=t=>{const{classes:s,row:c,error:n}=t;return N({root:["root",c&&"row",n&&"error"]},yt,s)},bt=w("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.root,c.row&&s.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),vt=b.forwardRef(function(s,c){const n=H({props:s,name:"MuiFormGroup"}),{className:a,row:x=!1,...h}=n,f=Z(),g=xt({props:n,muiFormControl:f,states:["error"]}),j={...n,row:x,error:g.error},y=gt(j);return e.jsx(bt,{className:D(y.root,a),ownerState:j,ref:c,...h})}),jt=I(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),St=I(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"})),Ct=w("span",{name:"MuiRadioButtonIcon",shouldForwardProp:O})({position:"relative",display:"flex"}),Rt=w(jt,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),wt=w(St,{name:"MuiRadioButtonIcon"})(Y(({theme:t})=>({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}}]})));function _(t){const{checked:s=!1,classes:c={},fontSize:n}=t,a={...t,checked:s};return e.jsxs(Ct,{className:c.root,ownerState:a,children:[e.jsx(Rt,{fontSize:n,className:c.background,ownerState:a}),e.jsx(wt,{fontSize:n,className:c.dot,ownerState:a})]})}const J=b.createContext(void 0);function It(){return b.useContext(J)}function zt(t){return k("MuiRadio",t)}const U=F("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),Pt=t=>{const{classes:s,color:c,size:n}=t,a={root:["root",`color${z(c)}`,n!=="medium"&&`size${z(n)}`]};return{...s,...N(a,zt,s)}},At=w(ct,{shouldForwardProp:t=>O(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.root,c.size!=="medium"&&s[`size${z(c.size)}`],s[`color${z(c.color)}`]]}})(Y(({theme:t})=>({color:(t.vars||t).palette.text.secondary,[`&.${U.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.alpha((t.vars||t).palette.action.active,(t.vars||t).palette.action.hoverOpacity)}}},...Object.entries(t.palette).filter(L()).map(([s])=>({props:{color:s,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.alpha((t.vars||t).palette[s].main,(t.vars||t).palette.action.hoverOpacity)}}})),...Object.entries(t.palette).filter(L()).map(([s])=>({props:{color:s,disabled:!1},style:{[`&.${U.checked}`]:{color:(t.vars||t).palette[s].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function Wt(t,s){return typeof s=="object"&&s!==null?t===s:String(t)===String(s)}const $t=e.jsx(_,{checked:!0}),Tt=e.jsx(_,{}),V=b.forwardRef(function(s,c){const n=H({props:s,name:"MuiRadio"}),{checked:a,checkedIcon:x=$t,color:h="primary",icon:f=Tt,name:g,onChange:j,size:y="medium",className:v,disabled:p,disableRipple:C=!1,slots:o={},slotProps:u={},inputProps:m,...i}=n,r=Z();let S=p;r&&typeof S>"u"&&(S=r.disabled),S??=!1;const P={...n,disabled:S,disableRipple:C,color:h,size:y},Q=Pt(P),R=It();let A=a;const K=mt(j,R&&R.onChange);let W=g;R&&(typeof A>"u"&&(A=Wt(R.value,n.value)),typeof W>"u"&&(W=R.name));const $=u.input??m,[X,tt]=et("root",{ref:c,elementType:At,className:D(Q.root,v),shouldForwardComponentProp:!0,externalForwardedProps:{slots:o,slotProps:u,...i},getSlotProps:G=>({...G,onChange:(B,...E)=>{G.onChange?.(B,...E),K(B,...E)}}),ownerState:P,additionalProps:{type:"radio",icon:b.cloneElement(f,{fontSize:f.props.fontSize??y}),checkedIcon:b.cloneElement(x,{fontSize:x.props.fontSize??y}),disabled:S,name:W,checked:A,slots:o,slotProps:{input:typeof $=="function"?$(P):$}}});return e.jsx(X,{...tt,classes:Q})});function kt(t){return k("MuiRadioGroup",t)}F("MuiRadioGroup",["root","row","error"]);const Ft=t=>{const{classes:s,row:c,error:n}=t;return N({root:["root",c&&"row",n&&"error"]},kt,s)},Dt=b.forwardRef(function(s,c){const{actions:n,children:a,className:x,defaultValue:h,name:f,onChange:g,value:j,...y}=s,v=b.useRef(null),p=Ft(s),[C,o]=ht({controlled:j,default:h,name:"RadioGroup"});b.useImperativeHandle(n,()=>({focus:()=>{let r=v.current.querySelector("input:not(:disabled):checked");r||(r=v.current.querySelector("input:not(:disabled)")),r&&r.focus()}}),[]);const u=ot(c,v),m=st(f),i=b.useMemo(()=>({name:m,onChange(r){o(r.target.value),g&&g(r,r.target.value)},value:C}),[m,g,o,C]);return e.jsx(J.Provider,{value:i,children:e.jsx(vt,{role:"radiogroup",ref:u,className:D(p.root,x),...y,children:a})})}),Nt=I(e.jsx("path",{d:"M12 7V3H2v18h20V7zM6 19H4v-2h2zm0-4H4v-2h2zm0-4H4V9h2zm0-4H4V5h2zm4 12H8v-2h2zm0-4H8v-2h2zm0-4H8V9h2zm0-4H8V5h2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8zm-2-8h-2v2h2zm0 4h-2v2h2z"})),Mt=I(e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"})),Qt=I(e.jsx("path",{d:"M16.75 13.96c.25.13.41.2.46.3.06.11.04.61-.21 1.18-.2.56-1.24 1.1-1.7 1.12-.46.02-.47.36-2.96-.73-2.49-1.09-3.99-3.75-4.11-3.92-.12-.17-.96-1.38-.92-2.61.05-1.22.69-1.8.95-2.04.24-.26.51-.29.68-.26h.47c.15 0 .36-.06.55.45l.69 1.87c.06.13.1.28.01.44l-.27.41-.39.42c-.12.12-.26.25-.12.5.12.26.62 1.09 1.32 1.78.91.88 1.71 1.17 1.95 1.3.24.14.39.12.54-.04l.81-.94c.19-.25.35-.19.58-.11l1.67.88M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10c-1.97 0-3.8-.57-5.35-1.55L2 22l1.55-4.65A9.969 9.969 0 0 1 2 12 10 10 0 0 1 12 2m0 2a8 8 0 0 0-8 8c0 1.72.54 3.31 1.46 4.61L4.5 19.5l2.89-.96A7.95 7.95 0 0 0 12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8z"})),Zt=({order:t})=>{const s=[{label:"Subtotal",value:t.subtotal||0,color:"text.primary"},{label:"Tax",value:t.tax||0,color:"text.secondary"},{label:"Item Addons",value:t.itemAddons||0,color:"text.secondary"}],c=t.manualAddons||[],n=!t.itemAddons&&!t.manualAddons&&(t.addons||0)>0?t.addons:0;return e.jsxs(d,{sx:{bgcolor:"background.paper",borderRadius:2,border:1,borderColor:"divider",overflow:"hidden"},children:[e.jsx(d,{sx:{px:2,py:1.5,bgcolor:"grey.50",borderBottom:1,borderColor:"divider"},children:e.jsx(l,{variant:"caption",sx:{fontWeight:800,color:"text.secondary",textTransform:"uppercase",letterSpacing:1},children:"Payment Summary"})}),e.jsxs(M,{spacing:1,sx:{p:2},children:[s.map((a,x)=>(a.value>0||x===0)&&e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(l,{variant:"body2",color:"text.secondary",sx:{fontWeight:500},children:a.label}),e.jsxs(l,{variant:"body2",sx:{fontWeight:600,color:a.color},children:["₹",a.value.toFixed(2)]})]},x)),c.map((a,x)=>e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(l,{variant:"body2",color:"text.secondary",sx:{fontWeight:500},children:a.label}),e.jsxs(l,{variant:"body2",sx:{fontWeight:600,color:a.amount<0?"error.main":"success.main"},children:[a.amount<0?"-":"+","₹",Math.abs(a.amount).toFixed(2)]})]},`manual-${x}`)),n!==void 0&&n>0&&e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(l,{variant:"body2",color:"text.secondary",sx:{fontWeight:500},children:"Addons (Legacy)"}),e.jsxs(l,{variant:"body2",sx:{fontWeight:600,color:"text.secondary"},children:["₹",n.toFixed(2)]})]}),(t.deliveryAmount||0)>0&&e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(l,{variant:"body2",color:"text.secondary",sx:{fontWeight:500},children:"Delivery"}),e.jsxs(l,{variant:"body2",sx:{fontWeight:600,color:"text.secondary"},children:["₹",t.deliveryAmount?.toFixed(2)]})]}),(t.returnedAmount||0)>0&&e.jsxs(d,{sx:{mt:1,pt:1,borderTop:"1px dashed",borderColor:"divider"},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:.5},children:[e.jsx(l,{variant:"body2",color:"text.secondary",sx:{fontWeight:600},children:"Original Total"}),e.jsxs(l,{variant:"body2",sx:{fontWeight:600,color:"text.secondary"},children:["₹",((t.total||0)+(t.returnedAmount||0)).toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(l,{variant:"body2",color:"error.main",sx:{fontWeight:700},children:"Returns Info"}),e.jsxs(l,{variant:"body2",sx:{fontWeight:800,color:"error.main"},children:["-₹",t.returnedAmount?.toLocaleString(void 0,{minimumFractionDigits:2})]})]})]}),e.jsx(rt,{sx:{my:1}}),e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(l,{variant:"subtitle1",sx:{fontWeight:800,color:"text.primary"},children:(t.returnedAmount||0)>0?"Net Total":"Total Amount"}),e.jsxs(l,{variant:"h6",sx:{fontWeight:900,color:"primary.main"},children:["₹",t.total.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]})},_t=({shippingDetails:t})=>e.jsxs(d,{sx:{bgcolor:"background.paper",borderRadius:2,border:1,borderColor:"divider",overflow:"hidden"},children:[e.jsx(d,{sx:{px:2,py:1.5,bgcolor:"grey.50",borderBottom:1,borderColor:"divider"},children:e.jsx(l,{variant:"caption",sx:{fontWeight:800,color:"text.secondary",textTransform:"uppercase",letterSpacing:1},children:"Shipping Information"})}),e.jsxs(M,{spacing:2,sx:{p:2},children:[e.jsxs(d,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(d,{sx:{p:1,borderRadius:1.5,bgcolor:"primary.main",color:"primary.contrastText",display:"flex"},children:e.jsx(Mt,{fontSize:"small"})}),e.jsxs(d,{children:[e.jsx(l,{variant:"caption",color:"text.secondary",sx:{fontWeight:700,textTransform:"uppercase",fontSize:"0.65rem"},children:"Customer"}),e.jsxs(l,{variant:"body2",sx:{fontWeight:600},children:[t.firstName," ",t.lastName]})]})]}),e.jsxs(d,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(d,{sx:{p:1,borderRadius:1.5,bgcolor:"secondary.main",color:"white",display:"flex"},children:e.jsx(nt,{fontSize:"small"})}),e.jsxs(d,{children:[e.jsx(l,{variant:"caption",color:"text.secondary",sx:{fontWeight:700,textTransform:"uppercase",fontSize:"0.65rem"},children:"Contact Number"}),e.jsx(l,{variant:"body2",sx:{fontWeight:600,letterSpacing:.5},children:t.phoneNumber})]})]}),(t.address||t.city)&&e.jsxs(d,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[e.jsx(d,{sx:{p:1,borderRadius:1.5,bgcolor:"info.main",color:"white",display:"flex",mt:.5},children:e.jsx(at,{fontSize:"small"})}),e.jsxs(d,{children:[e.jsx(l,{variant:"caption",color:"text.secondary",sx:{fontWeight:700,textTransform:"uppercase",fontSize:"0.65rem"},children:"Delivery Address"}),e.jsxs(l,{variant:"body2",sx:{fontWeight:600,lineHeight:1.4},children:[t.address,",",e.jsx("br",{}),t.city," ",t.zip&&`- ${t.zip}`]})]})]}),t.orgName&&e.jsxs(d,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(d,{sx:{p:1,borderRadius:1.5,bgcolor:"warning.main",color:"white",display:"flex"},children:e.jsx(Nt,{fontSize:"small"})}),e.jsxs(d,{children:[e.jsx(l,{variant:"caption",color:"text.secondary",sx:{fontWeight:700,textTransform:"uppercase",fontSize:"0.65rem"},children:"Organization"}),e.jsx(l,{variant:"body2",sx:{fontWeight:600},children:t.orgName})]})]})]})]}),Jt=({open:t,onClose:s,onSave:c,order:n})=>{const[a,x]=b.useState("full"),[h,f]=b.useState({}),[g,j]=b.useState({}),[y,v]=b.useState(!1);b.useEffect(()=>{if(t&&n?.items){x("full");const o={},u={};n.items.forEach((m,i)=>{const r=m.quantity-(m.returnedQuantity||0);o[i]=!1,u[i]=m.isComplexVariant?r:Math.min(1,r)}),f(o),j(u)}},[t,n]);const p=o=>{f(u=>({...u,[o]:!u[o]}))},C=async()=>{v(!0);try{const o=n.items.map((u,m)=>{let i=0;return a==="full"?i=u.quantity-(u.returnedQuantity||0):h[m]&&(i=g[m]||0),i>0?{...u,returnedQuantity:(u.returnedQuantity||0)+i}:u});await c(o),s()}catch(o){console.error("Error saving return:",o),alert("Failed to save return details")}finally{v(!1)}};return n?e.jsxs(lt,{open:t,onClose:s,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3}},children:[e.jsx(dt,{sx:{fontWeight:"bold"},children:"Process Return"}),e.jsxs(ut,{dividers:!0,children:[e.jsxs(d,{sx:{mb:3},children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"RETURN TYPE"}),e.jsxs(Dt,{value:a,onChange:o=>x(o.target.value),sx:{flexDirection:"row",gap:2},children:[e.jsx(q,{value:"full",control:e.jsx(V,{}),label:e.jsx(l,{variant:"body2",sx:{fontWeight:600},children:"Full Return"})}),e.jsx(q,{value:"partial",control:e.jsx(V,{}),label:e.jsx(l,{variant:"body2",sx:{fontWeight:600},children:"Partial Return"})})]})]}),a==="partial"&&e.jsxs(d,{children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",sx:{mb:2},children:"SELECT ITEMS & QUANTITIES"}),e.jsx(M,{spacing:2,children:n.items.map((o,u)=>{const m=o.quantity-(o.returnedQuantity||0);return m<=0?null:e.jsx(d,{sx:{p:1.5,borderRadius:2,border:1,borderColor:h[u]?"primary.main":"divider",bgcolor:h[u]?"primary.main08":"transparent"},children:e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(ft,{checked:!!h[u],onChange:()=>p(u),size:"small"}),e.jsxs(d,{sx:{flex:1,minWidth:0},children:[e.jsx(l,{variant:"body2",sx:{fontWeight:"bold"},noWrap:!0,children:o.name}),e.jsxs(l,{variant:"caption",color:"text.secondary",children:["Available to return: ",m]})]}),o.isComplexVariant?e.jsxs(l,{variant:"body2",sx:{fontWeight:"bold",bgcolor:"action.hover",px:1.5,py:.5,borderRadius:2},children:[g[u]," ",o.unitName]}):e.jsx(it,{quantity:g[u]||1,onQuantityChange:i=>{f(r=>({...r,[u]:!0})),j(r=>({...r,[u]:i}))},min:1,max:m,compact:!0})]})},u)})})]}),a==="full"&&e.jsx(d,{sx:{py:2,textAlign:"center",bgcolor:"action.hover",borderRadius:2},children:e.jsx(l,{variant:"body2",color:"text.secondary",children:"All eligible items will be marked as fully returned."})})]}),e.jsxs(pt,{sx:{p:2.5},children:[e.jsx(T,{onClick:s,color:"inherit",sx:{fontWeight:"bold"},children:"Cancel"}),e.jsx(T,{onClick:C,variant:"contained",color:"primary",disabled:y||a==="partial"&&!Object.values(h).some(o=>o),sx:{fontWeight:"bold",borderRadius:2,px:3},children:y?"Processing...":"Confirm Return"})]})]}):null},Kt=(t,s=[],c=0)=>{const n=i=>i.selectedSize?.price||i.price||i.buyPrice||0,a=t.reduce((i,r)=>i+n(r)*r.quantity,0),x=t.reduce((i,r)=>i+(r.taxAmount||0)*r.quantity,0),h=t.reduce((i,r)=>i+(r.addonAmount||0)*r.quantity,0),f=t.reduce((i,r)=>{const S=r.quantity-(r.returnedQuantity||0);return i+n(r)*S},0),g=t.reduce((i,r)=>{const S=r.quantity-(r.returnedQuantity||0);return i+(r.taxAmount||0)*S},0),j=t.reduce((i,r)=>{const S=r.quantity-(r.returnedQuantity||0);return i+(r.addonAmount||0)*S},0),y=t.length>0&&f===0,v=s.reduce((i,r)=>i+r.amount,0),p=y?0:v,C=y?0:c,o=f+g+j+p+C,m=a+x+h+v+c-o;return{subtotal:a,tax:x,itemAddons:h,orderAddons:v,addons:h+v,deliveryAmount:c,total:o,returnedAmount:m,items:t}},Xt=({order:t,variant:s="outlined",color:c="success",size:n="small"})=>{const a=x=>{x.stopPropagation();const h=t.shippingDetails?.phoneNumber||"",f=window.prompt("Enter WhatsApp Number",h);if(f===null)return;const g=t.timestamp?.toDate?t.timestamp.toDate().toLocaleDateString():new Date().toLocaleDateString(),j=`${t.shippingDetails?.firstName||""} ${t.shippingDetails?.lastName||""}`.trim()||"Guest",y=`${t.shippingDetails?.address||""}, ${t.shippingDetails?.city||""} ${t.shippingDetails?.zip||""}`.replace(/^, /,"").trim();let p=`*Estimate ID:* #${t.id.slice(0,5).toUpperCase()}
`;p+=`*Date:* ${g}
`,p+=`*Status:* ${t.status}
`,p+=`--------------------------------
`,p+=`*Customer Details:*
`,p+=`Name: ${j}
`,p+=`Phone: ${t.shippingDetails?.phoneNumber||"N/A"}
`,y&&(p+=`Address: ${y}
`),p+=`--------------------------------
`,p+=`*Items:*
`,t.items.forEach((o,u)=>{const m=o.selectedSize?` (${o.selectedSize.label})`:"",i=(o.totalPrice||o.buyPrice)*o.quantity;if(p+=`${u+1}. ${o.name}${m}
`,p+=`   Qty: ${o.quantity} x ₹${(o.totalPrice||o.buyPrice).toLocaleString()} = ₹${i.toLocaleString()}
`,o.returnedQuantity&&o.returnedQuantity>0){const r=(o.totalPrice||o.buyPrice)*o.returnedQuantity;p+=`   ⚠️ RETURNED: ${o.returnedQuantity} (-₹${r.toLocaleString()})
`}}),p+=`--------------------------------
`,t.subtotal&&(p+=`Subtotal: ₹${t.subtotal.toLocaleString()}
`),t.tax&&(p+=`Tax: ₹${t.tax.toLocaleString()}
`),t.deliveryAmount&&(p+=`Delivery: ₹${t.deliveryAmount.toLocaleString()}
`),p+=`*Grand Total: ₹${t.total.toLocaleString()}*
`,p+=`--------------------------------
`,p+="Thank you for reaching out to us!";const C=`https://wa.me/${f}?text=${encodeURIComponent(p)}`;window.open(C,"_blank")};return e.jsx(T,{size:n,variant:s,color:c,startIcon:e.jsx(Qt,{}),onClick:a,children:"Share"})};export{Zt as O,Jt as R,Xt as W,_t as a,Kt as c};
