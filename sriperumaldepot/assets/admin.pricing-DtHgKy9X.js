import{r as i,j as e,C as V}from"./index-BcxSdZbh.js";import{u as H}from"./pricingStore-B-OnHDCo.js";import{B as l,T as s,P as g,a as d}from"./Button-D7ynFjlK.js";import{A as q,T as J,a as K,C as A,M as W}from"./ArrowBackIosNew-CVJfBwE1.js";import{I as c}from"./IconButton-Bk_OCxGk.js";import{P as Q}from"./Page-XrM5sTBl.js";import{C as U,S as X,E as I}from"./Edit-DSWJJKMu.js";import{G as r}from"./Grid-DVQOFU8T.js";import{T as h}from"./TextField-Ycvf_Fdu.js";import{D as R}from"./Divider-BzkCuubw.js";import{A as S}from"./Add-w2aQt3U8.js";import{S as y}from"./Stack-DfjJLXum.js";import{D as z}from"./Delete-CkKi-CY3.js";import{D as Y}from"./Dialog-ClSmCUrD.js";import{D as Z,a as _,b as ee}from"./DialogTitle-D17Kxumk.js";import"./Select-S4qdU2LD.js";import"./Modal-BbEu56Kd.js";import"./useThemeProps-CmlVwWV-.js";import"./SwitchBase-t3XV-810.js";function be(){const{rules:b,fetchRules:P,addRule:E,updateRule:B,deleteRule:F,isLoading:N,deliveryConfig:v,fetchDeliveryConfig:G,updateDeliveryConfig:L}=H();i.useEffect(()=>{P(),G()},[]);const[O,C]=i.useState(!1),[u,D]=i.useState(null),[p,$]=i.useState("tax"),[t,o]=i.useState({label:"",type:"tax",valueType:"percentage",value:0}),[n,m]=i.useState({enabled:!1,amount:0});i.useEffect(()=>{m(v)},[v]);const x=(a,f)=>{f?(D(f),o(f)):(D(null),o({label:"",type:a,valueType:"percentage",value:0})),$(a),C(!0)},j=()=>{C(!1)},M=async()=>{if(!t.label||t.value===void 0){alert("Please fill in all fields");return}const a={label:t.label,type:p,valueType:t.valueType,value:Number(t.value)};u?await B({...a,id:u.id}):await E(a),j()},T=async a=>{confirm("Are you sure you want to delete this rule?")&&await F(a)},w=b.filter(a=>a.type==="tax"),k=b.filter(a=>a.type==="addon");return e.jsxs(l,{sx:{pb:10,bgcolor:"background.default",minHeight:"100vh",color:"text.primary"},children:[e.jsx(q,{position:"sticky",color:"default",elevation:0,sx:{bgcolor:"background.paper",borderBottom:1,borderColor:"divider"},children:e.jsxs(J,{children:[e.jsx(c,{onClick:()=>window.history.back(),edge:"start",children:e.jsx(K,{})}),e.jsx(s,{variant:"h6",component:"h1",sx:{flexGrow:1,textAlign:"center",pr:5,fontWeight:"bold"},children:"Pricing Configuration"})]})}),e.jsx(Q,{children:e.jsx(U,{maxWidth:"md",sx:{py:4},children:N?e.jsx(l,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(V,{})}):e.jsxs(r,{container:!0,spacing:4,children:[e.jsx(r,{size:12,children:e.jsx(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsx(s,{variant:"h6",sx:{fontWeight:"bold",color:"text.secondary",textDecoration:"underline"},children:"Order Level (1 per order)"})})}),e.jsxs(r,{size:12,children:[e.jsx(s,{variant:"h6",sx:{fontWeight:"bold",mb:2},children:"Delivery Charge"}),e.jsxs(g,{sx:{p:2,borderRadius:2},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(s,{variant:"subtitle1",fontWeight:"bold",children:"Enable Delivery Charge"}),e.jsx(X,{checked:n.enabled,onChange:a=>m({...n,enabled:a.target.checked})})]}),e.jsx(h,{label:"Amount",type:"number",fullWidth:!0,value:n.amount,disabled:!n.enabled,onChange:a=>m({...n,amount:Number(a.target.value)}),helperText:"Fixed amount applied to the entire order"}),e.jsx(d,{variant:"contained",color:"primary",sx:{mt:2},onClick:async()=>{try{await L(n),alert("Delivery charge saved successfully!")}catch{alert("Failed to save delivery charge. Please try again.")}},children:"Save Delivery Charge"})]})]}),e.jsxs(r,{size:12,children:[e.jsx(R,{}),e.jsx(R,{sx:{my:2}}),e.jsx(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsx(s,{variant:"h6",sx:{fontWeight:"bold",color:"text.secondary",textDecoration:"underline"},children:"Product Level (for each product)"})})]}),e.jsxs(r,{size:12,children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(s,{variant:"h6",sx:{fontWeight:"bold"},children:"Tax Rules"}),e.jsx(d,{variant:"contained",startIcon:e.jsx(S,{}),onClick:()=>x("tax"),size:"small",children:"Add Tax"})]}),e.jsxs(y,{spacing:2,children:[w.length===0&&e.jsx(s,{color:"text.secondary",children:"No tax rules defined."}),w.map(a=>e.jsxs(g,{sx:{p:2,display:"flex",justifyContent:"space-between",alignItems:"center",borderRadius:2},children:[e.jsxs(l,{children:[e.jsx(s,{variant:"subtitle1",fontWeight:"bold",children:a.label}),e.jsx(A,{label:`${a.value}${a.valueType==="percentage"?"%":" Fixed"}`,size:"small",color:"primary",variant:"outlined"})]}),e.jsxs(l,{children:[e.jsx(c,{onClick:()=>x("tax",a),size:"small",color:"primary",children:e.jsx(I,{})}),e.jsx(c,{onClick:()=>T(a.id),size:"small",color:"error",children:e.jsx(z,{})})]})]},a.id))]})]}),e.jsxs(r,{size:12,children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(s,{variant:"h6",sx:{fontWeight:"bold"},children:"Add-on Costs"}),e.jsx(d,{variant:"contained",color:"secondary",startIcon:e.jsx(S,{}),onClick:()=>x("addon"),size:"small",children:"Add Add-on"})]}),e.jsxs(y,{spacing:2,children:[k.length===0&&e.jsx(s,{color:"text.secondary",children:"No add-on rules defined."}),k.map(a=>e.jsxs(g,{sx:{p:2,display:"flex",justifyContent:"space-between",alignItems:"center",borderRadius:2},children:[e.jsxs(l,{children:[e.jsx(s,{variant:"subtitle1",fontWeight:"bold",children:a.label}),e.jsx(A,{label:`${a.value}${a.valueType==="percentage"?"%":" Fixed"}`,size:"small",color:"secondary",variant:"outlined"})]}),e.jsxs(l,{children:[e.jsx(c,{onClick:()=>x("addon",a),size:"small",color:"primary",children:e.jsx(I,{})}),e.jsx(c,{onClick:()=>T(a.id),size:"small",color:"error",children:e.jsx(z,{})})]})]},a.id))]})]})]})})}),e.jsxs(Y,{open:O,onClose:j,maxWidth:"xs",fullWidth:!0,children:[e.jsxs(Z,{children:[u?"Edit":"Add"," ",p==="tax"?"Tax Rule":"Add-on"]}),e.jsx(_,{children:e.jsxs(y,{spacing:2,sx:{mt:1},children:[e.jsx(h,{label:"Label",fullWidth:!0,placeholder:p==="tax"?"e.g. VAT, GST":"e.g. Gift Wrap, Service Charge",value:t.label,onChange:a=>o({...t,label:a.target.value})}),e.jsxs(h,{select:!0,label:"Type",fullWidth:!0,value:t.valueType,onChange:a=>o({...t,valueType:a.target.value}),children:[e.jsx(W,{value:"percentage",children:"Percentage (%)"}),e.jsx(W,{value:"fixed",children:"Fixed Amount"})]}),e.jsx(h,{label:"Value",type:"number",fullWidth:!0,value:t.value,onChange:a=>o({...t,value:Number(a.target.value)})})]})}),e.jsxs(ee,{children:[e.jsx(d,{onClick:j,children:"Cancel"}),e.jsx(d,{onClick:M,variant:"contained",disabled:!t.label,children:"Save"})]})]})]})}export{be as component};
