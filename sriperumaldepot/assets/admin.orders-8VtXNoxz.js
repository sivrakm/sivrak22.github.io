import{a as H,u as M,r as a,j as e,C as F,x as N,y as f,A as U,D as Y,E as J,z as X,L as w,M as G,N as K}from"./index-BxCZ3gJB.js";import{p as Q}from"./printInvoice-Cgy6HMJN.js";import{O as V}from"./OrderItem-CJcrPIrg.js";import{O as Z,a as _}from"./OrderShippingDetails-C4gM4d44.js";import{B as t,T as l,a as i}from"./Button-dAB4gEN8.js";import{I as b}from"./IconButton-Dcn8gMAF.js";import{A as ee}from"./ArrowBack-Ks9GZWNe.js";import{S as re}from"./Search-BppkVCUi.js";import{S as m}from"./Stack-WHqWnZP1.js";import{C as oe}from"./Card-DMKlaXqL.js";import{A as te}from"./Avatar-DH55DfsK.js";import{E as k}from"./ExpandMore-CCd_2SD3.js";import{C as se}from"./Collapse-BuC84cR0.js";import{D as ne}from"./Dialog-vMOPFcWR.js";import{D as ie,a as ae,b as le}from"./DialogTitle-BqDTnBnF.js";import{D as ce}from"./DialogContentText-WkOAjeGE.js";import{C as de}from"./CheckCircle-BAr91r9S.js";import{C as pe,I as me,H as xe}from"./Inventory2-BLVVjZxD.js";import{L as ue}from"./LocalShipping-DzDAh5Cl.js";import"./ShoppingCart-llfKQigw.js";import"./Divider-DUjWnQof.js";import"./dividerClasses-C8sJPztN.js";import"./useThemeProps-Dq8zE2h3.js";import"./Modal-CbVYm3dt.js";const x=X`
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
`;function qe(){const T=H(),j=M(r=>r.user),[y,I]=a.useState([]),[z,C]=a.useState(!0),[s,O]=a.useState("All"),[u,E]=a.useState(null),[A,p]=a.useState(!1),[v,S]=a.useState(null),L=["All","Processing","Delivered","Cancelled"],h=async()=>{if(!j){C(!1);return}try{const r=N(f,"orders"),o=U(r,Y("timestamp","desc")),c=(await J(o)).docs.map(d=>({id:d.id,...d.data()}));I(c)}catch(r){console.error("Error fetching orders:",r)}finally{C(!1)}};a.useEffect(()=>{h()},[j]);const D=y.filter(r=>s==="All"?!0:(r.status==="pending"?"Processing":r.status).toLowerCase()===s.toLowerCase()),P=r=>{switch(r.toLowerCase()){case"pending":case"processing":return{label:"Processing",icon:e.jsx(xe,{fontSize:"small"}),color:"warning.main",bgcolor:"rgba(237, 108, 2, 0.1)",borderColor:"rgba(237, 108, 2, 0.2)"};case"shipped":return{label:"Shipped",icon:e.jsx(ue,{fontSize:"small"}),color:"info.main",bgcolor:"rgba(2, 136, 209, 0.1)",borderColor:"rgba(2, 136, 209, 0.2)"};case"delivered":return{label:"Delivered",icon:e.jsx(me,{fontSize:"small"}),color:"success.main",bgcolor:"rgba(46, 125, 50, 0.1)",borderColor:"rgba(46, 125, 50, 0.2)"};case"cancelled":return{label:"Cancelled",icon:e.jsx(pe,{fontSize:"small"}),color:"error.main",bgcolor:"rgba(211, 47, 47, 0.1)",borderColor:"rgba(211, 47, 47, 0.2)"};default:return{label:"Completed",icon:e.jsx(de,{fontSize:"small"}),color:"text.secondary",bgcolor:"action.hover",borderColor:"divider"}}},g=(r,o)=>{try{const n=w(f,"orders",r);G(n,{status:o}),h()}catch(n){console.error("Error updating order status:",n),alert("Failed to update order status = "+r)}},R=async()=>{if(v)try{const r=w(f,"orders",v);await K(r),p(!1),S(null),alert("Order deleted successfully"),h()}catch(r){console.error("Error deleting order:",r),alert("Failed to delete order")}},W=r=>{S(r),p(!0)},B=r=>{if(!r)return"Just now";const o=r.toDate(),c=new Date().getTime()-o.getTime(),d=Math.floor(c/(1e3*60*60*24));return d===0?`Today, ${o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:d===1?`Yesterday, ${o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:o.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},$=r=>{E(u===r?null:r)},q=r=>{const o=y.find(n=>n.id===r);Q(o)};return e.jsxs(t,{sx:{pb:10,bgcolor:"background.default",minHeight:"100vh",color:"text.primary"},children:[e.jsx(t,{sx:{position:"sticky",top:0,zIndex:1100,bgcolor:"background.default",borderBottom:1,borderColor:"divider"},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2,height:60},children:[e.jsx(b,{sx:{ml:-1},onClick:()=>T({to:"/shop"}),children:e.jsx(ee,{})}),e.jsxs(l,{variant:"h6",sx:{fontWeight:"bold"},children:["Estimate"," History"]}),e.jsx(b,{sx:{mr:-1},children:e.jsx(re,{})})]})}),e.jsxs(t,{sx:{p:2},children:[e.jsx(t,{sx:{display:"flex",gap:1.5,overflowX:"auto",p:2,mb:2,"&::-webkit-scrollbar":{display:"none"},animation:`${x} 0.6s ease-out forwards`},children:L.map(r=>e.jsx(i,{variant:s===r?"contained":"outlined",onClick:()=>O(r),sx:{flexShrink:0,borderRadius:50,textTransform:"none",fontWeight:"bold",fontSize:"0.875rem",px:3,py:1,bgcolor:s===r?"primary.main":"background.paper",color:s===r?"black":"text.secondary",borderColor:s===r?"primary.main":"divider",boxShadow:s===r?"0 4px 12px rgba(242, 215, 13, 0.2)":"none","&:hover":{bgcolor:s===r?"primary.main":"action.hover",borderColor:s===r?"primary.main":"divider"}},children:r},r))}),z?e.jsx(t,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(F,{})}):D.length===0?e.jsx(t,{sx:{textAlign:"center",py:8,animation:`${x} 0.6s ease-out forwards`},children:e.jsx(l,{color:"text.secondary",children:"No orders found."})}):e.jsx(m,{spacing:2,sx:{animation:`${x} 0.6s ease-out forwards`,animationDelay:"0.1s"},children:D.map(r=>{const o=P(r.status);return e.jsx(oe,{sx:{p:2,borderRadius:3,border:1,borderColor:"divider",boxShadow:"none",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",transition:"all 0.2s","&:active":{transform:"scale(0.98)"}},onClick:()=>$(r.id),children:e.jsxs(t,{sx:{width:"100%"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(te,{sx:{width:48,height:48,bgcolor:o.bgcolor,color:o.color,border:1,borderColor:o.borderColor},children:o.icon}),e.jsxs(t,{children:[e.jsxs(l,{variant:"body2",sx:{fontWeight:"bold"},children:["Estimate"," #",r.id.slice(0,5).toUpperCase()]}),e.jsx(l,{variant:"caption",sx:{color:"text.secondary",mt:.5,display:"block"},children:B(r.timestamp)})]})]}),e.jsxs(t,{sx:{textAlign:"right",display:"flex",alignItems:"center",gap:1},children:[e.jsxs(t,{children:[e.jsxs(l,{variant:"body2",sx:{fontWeight:"bold"},children:["â‚¹",r.total.toLocaleString()]}),e.jsx(t,{sx:{display:"inline-block",mt:.5,px:1.5,py:.25,borderRadius:10,bgcolor:o.bgcolor,color:o.color,fontSize:"0.625rem",fontWeight:"bold",textTransform:"uppercase",letterSpacing:.5},children:o.label})]}),e.jsx(b,{size:"small",sx:{transform:u===r.id?"rotate(180deg)":"none",transition:"transform 0.3s"},children:e.jsx(k,{})})]})]}),e.jsxs(se,{in:u===r.id,timeout:"auto",unmountOnExit:!0,children:[e.jsx(t,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:e.jsx(Z,{order:r})}),e.jsx(t,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:e.jsx(_,{shippingDetails:r.shippingDetails||{}})}),e.jsxs(t,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:[e.jsxs(l,{variant:"caption",sx:{fontWeight:"bold",color:"text.secondary",mb:1.5,display:"block",textTransform:"uppercase",letterSpacing:.5},children:["Estimate"," Items"]}),e.jsx(m,{spacing:2,children:r.items?.map((n,c)=>e.jsx(V,{item:n},c))}),e.jsxs(m,{direction:"row",spacing:1,sx:{mt:2},children:[e.jsx(i,{size:"small",variant:"outlined",color:"success",onClick:()=>g(r.id,"Delivered"),children:"Delivered"}),e.jsx(i,{size:"small",variant:"outlined",color:"error",onClick:()=>g(r.id,"Cancelled"),children:"Cancelled"}),e.jsx(i,{size:"small",variant:"outlined",color:"error",onClick:()=>g(r.id,"pending"),children:"Processing"})]})]}),e.jsx(t,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:e.jsxs(m,{direction:"row",spacing:1,sx:{mt:2},justifyContent:"space-between",children:[e.jsx(i,{size:"small",variant:"contained",color:"success",onClick:()=>q(r.id),children:"Print Invoice"}),e.jsxs(i,{size:"small",variant:"outlined",color:"error",onClick:()=>W(r.id),children:["Delete ","Estimate"]})]})})]})]})},r.id)})}),e.jsx(t,{sx:{mt:4,textAlign:"center",animation:`${x} 0.6s ease-out forwards`,animationDelay:"0.3s"},children:e.jsx(i,{size:"small",endIcon:e.jsx(k,{}),sx:{color:"primary.main",fontWeight:"bold",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:1,"&:hover":{bgcolor:"transparent",color:"primary.dark"}},children:"Load More"})})]}),e.jsxs(ne,{open:A,onClose:()=>p(!1),PaperProps:{sx:{borderRadius:3,p:1}},children:[e.jsxs(ie,{sx:{fontWeight:"bold"},children:["Delete ","Estimate","?"]}),e.jsx(ae,{children:e.jsx(ce,{children:"Are you sure you want to delete this order? This action is permanent and cannot be undone."})}),e.jsxs(le,{sx:{p:2},children:[e.jsx(i,{onClick:()=>p(!1),color:"inherit",sx:{fontWeight:"bold"},children:"Cancel"}),e.jsx(i,{onClick:R,variant:"contained",color:"error",sx:{fontWeight:"bold",borderRadius:2},children:"Delete"})]})]})]})}export{qe as component};
