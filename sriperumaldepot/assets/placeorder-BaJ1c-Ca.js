import{f as F,j as e,m as me,p as be,r as a,a as fe,u as ge,B as r,I as _,h as s,n as ye,o as se,q as je,s as ve,t as Ce,v as Ie,w as Se,A as ke}from"./index-b1ip_EDv.js";import{u as M}from"./cartStore-CT8sgBm-.js";import{u as De}from"./orderStore-ROAvk_4X.js";import{u as ze}from"./pricingStore-BHLKKMH8.js";import{n as We}from"./index.browser-vcSNLBTf.js";import{O as Ae}from"./OfflineDialog-C2PUF6EE.js";import{B as R}from"./Button-B78WCA0J.js";import{G as p}from"./Grid-Bh7gOwzJ.js";import{T as l}from"./TextField-CMmL5EPD.js";import{I as we}from"./InputAdornment-Bk1KOm4w.js";import{F as ie}from"./FormControlLabel-BLhzEspZ.js";import{C as Ne}from"./Checkbox-DnPPPakV.js";import{D as Pe,a as Me,b as Re,c as Fe}from"./DialogTitle-5RZxZLE7.js";import{D as Te}from"./Delete-BzOv16qn.js";import{S as Le}from"./Switch-B40Dflci.js";import{A as Oe}from"./Add-C6RolQ-l.js";import{D as Ue}from"./Divider-BEh3D_4C.js";import{P as Ee}from"./Payments-dpPq__bH.js";import{C as Ve}from"./CheckCircle-DSp-wEfF.js";import{S as _e}from"./ShoppingCart-CUYNi2bv.js";import"./DialogContentText-DDlqcVzt.js";import"./isMuiElement-B8Y2ebQe.js";import"./SwitchBase-DSIZmQ03.js";import"./dividerClasses-CFrEYv8G.js";const He=F(e.jsx("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2m0 14H4v-6h16zm0-10H4V6h16z"})),$e=F(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 17h-2v-2h2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25"})),qe=F(e.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1z"})),Be=F(e.jsx("path",{d:"M17 1.01 7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99M17 19H7V5h10z"})),Ge=me()(be(x=>({shippingDetails:{firstName:"",orgName:"",address:"",zip:"",city:"",phoneNumber:""},setShippingDetails:k=>x({shippingDetails:k})}),{name:"shipping-storage"})),Je={arrow_back:e.jsx(ke,{}),shopping_cart:e.jsx(_e,{}),check_circle:e.jsx(Ve,{}),credit_card:e.jsx(He,{}),help:e.jsx($e,{}),lock:e.jsx(qe,{}),payments:e.jsx(Ee,{}),upi:e.jsx(Be,{})},g=({name:x,filled:k=!1,className:D=""})=>e.jsx(e.Fragment,{children:Je[x]});function yt(){const[x,k]=a.useState("upi"),[D,H]=a.useState(!1),y=fe(),z=M(t=>t.items),ne=M(t=>t.getTotalItems),ae=M(t=>t.getTotalPrice),$=M(t=>t.clearCart),q=ge(t=>t.user),{shippingDetails:u,setShippingDetails:le}=Ge(),B=De(t=>t.setLastOrder),{fetchDeliveryConfig:de,deliveryConfig:W}=ze(),[ce,G]=a.useState(!1);a.useState(()=>{navigator.onLine||G(!0),de()});const[n,xe]=a.useState({firstName:u.firstName,orgName:u.orgName,address:u.address,zip:u.zip,city:u.city,phoneNumber:u.phoneNumber||q?.phoneNumber||""}),[j,J]=a.useState([]),[v,X]=a.useState(null),[pe,T]=a.useState(!1),[Z,K]=a.useState(""),[L,Q]=a.useState(""),[O,ue]=a.useState(!1),h=t=>o=>{xe({...n,[t]:o.target.value})},U=ae(),A=z.reduce((t,o)=>t+(o.taxAmount||0)*o.quantity,0),Y=z.reduce((t,o)=>t+(o.addonAmount||0)*o.quantity,0),ee=j.reduce((t,o)=>t+o.amount,0),m=Y+ee,w=v!==null?v:W.enabled?W.amount:0,N=U+A+m+w,te=ne(),he=async()=>{if(!D){H(!0);try{le(n);const t=z.map(i=>({id:i.id,name:i.name,buyPrice:i.buyPrice,quantity:i.quantity,sku:i.sku||null,src:i.src||null,selectedSize:i.selectedSize||null,category:i.category||"Uncategorized",taxAmount:i.taxAmount||0,addonAmount:i.addonAmount||0,totalPrice:i.totalPrice||0,isComplexVariant:i.isComplexVariant||!1,unitName:i.unitName||null})),o={userId:q?.uid||"guest",shippingDetails:{firstName:n.firstName||"",orgName:n.orgName||"",address:n.address||"",zip:n.zip||"",city:n.city||"",phoneNumber:n.phoneNumber||""},items:t,subtotal:U||0,tax:A||0,itemAddons:Y||0,orderAddons:ee||0,addons:m||0,manualAddons:j||[],deliveryAmount:w||0,total:N||0,paymentMethod:x||"upi",status:"pending",timestamp:new Date,offlineId:crypto.randomUUID()};if(!navigator.onLine){const i=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),C=URL.createObjectURL(i),b=document.createElement("a");b.href=C,b.download=`order_${N.toFixed(0)}_${te}_${o.offlineId}.json`,b.click(),URL.revokeObjectURL(C),B({...o,isOffline:!0}),$(),y({to:"/orders"});return}const P=ye(se,"orders"),E=await je(P,{...o,timestamp:ve()});try{for(const i of t){const C=Ce(se,"products",String(i.id)),b=await Ie(C);if(b.exists()){const V=b.data(),I={};if(i.selectedSize){const d=V.sizes||[],f=d.findIndex(c=>c.label===i.selectedSize.label);if(f!==-1){let c=i.quantity;const S={...d[f]},re=S.returnStock||0,oe=Math.min(re,c);S.returnStock=re-oe,c-=oe,c>0&&(S.stock=(S.stock||0)-c),d[f]=S,I.sizes=d}}else{let d=i.quantity;const f=V.returnStock||0,c=Math.min(f,d);I.returnStock=f-c,d-=c,d>0&&(I.stock=(V.stock||0)-d)}Object.keys(I).length>0&&await Se(C,I)}}}catch(i){console.error("Error updating stock:",i)}B({...o,id:E.id}),$(),y({to:"/orders"})}catch(t){console.error("Error placing order:",t),alert("Failed to place order. Please try again.")}finally{H(!1)}}};return e.jsxs(r,{sx:{pb:30,bgcolor:"background.default",minHeight:"100vh",color:"text.primary",position:"relative"},children:[e.jsx(r,{sx:{position:"sticky",top:0,zIndex:1100,bgcolor:"background.default/90",backdropFilter:"blur(20px)",borderBottom:1,borderColor:"divider"},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2,height:64},children:[e.jsx(_,{sx:{ml:-1,bgcolor:"action.hover"},onClick:()=>y({to:"/checkout"}),children:e.jsx(g,{name:"arrow_back"})}),e.jsx(s,{variant:"h6",sx:{fontWeight:"bold"},children:"Checkout"}),e.jsx(r,{sx:{width:40}})," "]})}),e.jsxs(r,{sx:{p:2,display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(r,{children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1.5},children:[e.jsxs(s,{variant:"caption",sx:{fontWeight:"bold",color:"text.secondary",textTransform:"uppercase",letterSpacing:1},children:["Estimate"," Summary"]}),e.jsx(R,{size:"small",onClick:()=>y({to:"/checkout"}),sx:{fontSize:"0.75rem",fontWeight:500,color:"info.main",minWidth:"auto",p:0,"&:hover":{color:"text.primary",bgcolor:"transparent"}},children:"Edit Cart"})]}),e.jsx(r,{sx:{bgcolor:"background.paper",borderRadius:3,border:1,borderColor:"divider",p:2,boxShadow:"none"},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(r,{sx:{display:"flex",ml:1.5},children:e.jsx(r,{sx:{width:48,height:48,bgcolor:"action.hover",borderRadius:2,border:2,borderColor:"background.paper",display:"flex",alignItems:"center",justifyContent:"center",zIndex:30,ml:-1.5},children:e.jsx(g,{name:"shopping_cart",className:"!text-xl text-text-secondary"})})}),e.jsxs(r,{sx:{flex:1,minWidth:0,display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsxs(s,{variant:"body2",style:{fontWeight:"bold",whiteSpace:"nowrap"},children:[te," Items"]}),e.jsx(r,{style:{color:"text.secondary",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:z.map((t,o)=>e.jsxs(s,{variant:"body2",children:[t.quantity," x ",t.selectedSize?.label.slice(0,5),"..,",t.name.slice(0,10),".."]},`${t.id}-${t.selectedSize?.label||"default"}-${o}`))})]})]})}),e.jsxs(r,{sx:{mb:2.5,px:0,pt:2},children:[e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:1,mb:1.5},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(s,{variant:"body2",color:"text.secondary",sx:{minWidth:100},children:"Subtotal"}),e.jsxs(s,{variant:"body2",color:"text.primary",sx:{fontWeight:500,textAlign:"right"},children:["₹",U.toFixed(2)]})]}),A>0&&e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(s,{variant:"body2",color:"text.secondary",sx:{minWidth:100},children:"Tax"}),e.jsxs(s,{variant:"body2",color:"text.primary",sx:{fontWeight:500,textAlign:"right"},children:["₹",A.toFixed(2)]})]}),m!==0&&e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(s,{variant:"body2",color:"text.secondary",sx:{minWidth:100},children:"Add-ons/Discounts"}),e.jsxs(s,{variant:"body2",color:m>0?"text.primary":"error.main",sx:{fontWeight:500,textAlign:"right"},children:[m<0?"-":"","₹",Math.abs(m).toFixed(2)]})]}),(w!==0||v!==null)&&e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(s,{variant:"body2",color:"text.secondary",sx:{minWidth:100},children:"Delivery"}),e.jsxs(s,{variant:"body2",color:"text.primary",sx:{fontWeight:500,textAlign:"right"},children:["₹",w.toFixed(2)]})]})]}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pt:1.5,borderTop:"1px dashed",borderColor:"divider"},children:[e.jsx(s,{variant:"body1",sx:{fontWeight:"bold",minWidth:100},children:"Total"}),e.jsxs(s,{variant:"h6",sx:{fontWeight:"bold",color:"primary.main",textAlign:"right"},children:["₹",N.toFixed(2)]})]}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end",mt:1},children:e.jsx(R,{size:"small",onClick:()=>{v===null&&X(W.enabled?W.amount:0),T(!0)},sx:{fontSize:"0.75rem",fontWeight:500,color:"primary.main",p:0},children:"Edit Pricing"})})]})]}),e.jsxs(r,{children:[e.jsx(s,{variant:"caption",sx:{fontWeight:"bold",color:"text.secondary",textTransform:"uppercase",letterSpacing:1,display:"block",mb:1.5},children:"Shipping Address"}),e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[e.jsxs(p,{container:!0,spacing:1.5,children:[e.jsx(p,{size:12,children:e.jsx(l,{label:"First Name",variant:"filled",fullWidth:!0,value:n.firstName,onChange:h("firstName"),sx:{"& .MuiFilledInput-root":{borderRadius:3,bgcolor:"background.paper",border:1,borderColor:"divider"},"& .MuiInputLabel-root":{color:"text.secondary"}},InputProps:{disableUnderline:!0}})}),e.jsx(p,{size:12,children:e.jsx(l,{label:"Organization Name",variant:"filled",fullWidth:!0,value:n.orgName,onChange:h("orgName"),sx:{"& .MuiFilledInput-root":{borderRadius:3,bgcolor:"background.paper",border:1,borderColor:"divider"},"& .MuiInputLabel-root":{color:"text.secondary"}},InputProps:{disableUnderline:!0}})}),e.jsx(p,{size:12,children:e.jsx(l,{label:"Phone Number",variant:"filled",fullWidth:!0,placeholder:"+91 99999 99999",value:n.phoneNumber,onChange:h("phoneNumber"),sx:{"& .MuiFilledInput-root":{borderRadius:3,bgcolor:"background.paper",border:1,borderColor:"divider"},"& .MuiInputLabel-root":{color:"text.secondary"}},InputProps:{disableUnderline:!0}})})]}),e.jsx(l,{label:"Address",variant:"filled",fullWidth:!0,value:n.address,onChange:h("address"),sx:{"& .MuiFilledInput-root":{borderRadius:3,bgcolor:"background.paper",border:1,borderColor:"divider"},"& .MuiInputLabel-root":{color:"text.secondary"}},InputProps:{disableUnderline:!0}}),e.jsxs(p,{container:!0,spacing:1.5,children:[e.jsx(p,{size:4,children:e.jsx(l,{label:"Zip Code",variant:"filled",fullWidth:!0,value:n.zip,onChange:h("zip"),sx:{"& .MuiFilledInput-root":{borderRadius:3,bgcolor:"background.paper",border:1,borderColor:"divider"},"& .MuiInputLabel-root":{color:"text.secondary"}},InputProps:{disableUnderline:!0}})}),e.jsx(p,{size:8,children:e.jsx(l,{label:"City",variant:"filled",fullWidth:!0,value:n.city,onChange:h("city"),sx:{"& .MuiFilledInput-root":{borderRadius:3,bgcolor:"background.paper",border:1,borderColor:"divider"},"& .MuiInputLabel-root":{color:"text.secondary"}},InputProps:{disableUnderline:!0}})})]})]})]}),e.jsxs(r,{children:[e.jsx(s,{variant:"caption",sx:{fontWeight:"bold",color:"text.secondary",textTransform:"uppercase",letterSpacing:1,display:"block",mb:1.5},children:"Payment Method"}),e.jsx(r,{sx:{display:"flex",gap:1.5,mb:2,overflowX:"auto",pb:.5},children:["upi","payments"].map(t=>{const o=x===t,P={upi:"UPI",payments:"Cash"};return e.jsxs(r,{component:"button",onClick:()=>k(t),sx:{flex:1,minWidth:110,p:1.5,borderRadius:3,border:o?2:1,borderColor:o?"primary.main":"divider",bgcolor:o?"rgba(103, 103, 103, 0.1)":"background.paper",display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-between",height:80,position:"relative",transition:"all 0.2s","&:active":{transform:"scale(0.95)"}},children:[o&&e.jsx(r,{sx:{position:"absolute",top:8,right:8,color:"primary.main"},children:e.jsx(g,{name:"check_circle",filled:!0})}),e.jsx(r,{sx:{color:o?"primary.main":"text.secondary"},children:e.jsx(g,{name:t})}),e.jsx(s,{variant:"caption",sx:{fontWeight:o?"bold":"medium",color:o?"text.primary":"text.secondary"},children:P[t]})]},t)})}),x==="upi"&&e.jsxs(r,{sx:{bgcolor:"background.paper",borderRadius:3,border:1,borderColor:"divider",p:2,display:"flex",flexDirection:"column",gap:1.5},children:[e.jsx(l,{label:"UPI ID",variant:"filled",fullWidth:!0,placeholder:"username@bank",defaultValue:"mystore@a123bank",disabled:!0,sx:{"& .MuiFilledInput-root":{borderRadius:3,bgcolor:"action.hover",border:1,borderColor:"divider"},"& .MuiInputLabel-root":{color:"text.secondary"}},InputProps:{disableUnderline:!0,endAdornment:e.jsx(we,{position:"end",children:e.jsx(g,{name:"upi",className:"text-text-disabled"})})}}),e.jsx(s,{variant:"caption",color:"text.secondary",sx:{px:.5},children:"Securely pay using your favorite UPI app (GPay, PhonePe, Paytm, etc)."})]}),e.jsx(r,{sx:{display:"flex",alignItems:"center",mt:2},children:e.jsx(ie,{control:e.jsx(Ne,{defaultChecked:!0,sx:{color:"text.secondary","&.Mui-checked":{color:"primary.main"}}}),label:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Save this VPA for future purchases"})})})]})]}),e.jsx(r,{sx:{position:"fixed",bottom:0,left:0,right:0,bgcolor:"background.paper",borderTop:1,borderColor:"divider",p:3,pb:4,borderTopLeftRadius:24,borderTopRightRadius:24,boxShadow:"0 -8px 30px rgba(0,0,0,0.1)",zIndex:1e3},children:e.jsxs(R,{variant:"contained",color:"primary",fullWidth:!0,size:"large",sx:{borderRadius:4,py:2,variant:"contained",color:"primary",fontSize:"1rem",fontWeight:"bold",textTransform:"none",boxShadow:"0 8px 20px -4px rgba(242, 238, 13, 0.3)",display:"flex",justifyContent:"center",gap:1.5},onClick:he,disabled:D,children:[e.jsx(g,{name:"lock"}),D?"Processing...":`Place Estimate • Rs ${N.toFixed(2)}`]})}),e.jsxs(Pe,{open:pe,onClose:()=>T(!1),maxWidth:"xs",fullWidth:!0,PaperProps:{sx:{borderRadius:4,bgcolor:"background.paper"}},children:[e.jsx(Me,{sx:{fontWeight:"bold"},children:"Edit Pricing"}),e.jsx(Re,{children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsx(s,{variant:"subtitle2",sx:{fontWeight:"bold",color:"text.secondary"},children:"Addons / Discounts"}),e.jsx(r,{sx:{display:"flex",flexDirection:"column",gap:1},children:j.map((t,o)=>e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",bgcolor:"action.hover",p:1,borderRadius:2},children:[e.jsx(s,{variant:"body2",children:t.label}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(s,{variant:"body2",sx:{fontWeight:"bold"},children:["₹",t.amount.toFixed(2)]}),e.jsx(_,{size:"small",color:"error",onClick:()=>J(j.filter((P,E)=>E!==o)),children:e.jsx(Te,{fontSize:"small"})})]})]},o))}),e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(r,{sx:{display:"flex",gap:1},children:e.jsx(l,{label:"Description(optional)",variant:"outlined",size:"small",fullWidth:!0,value:Z,onChange:t=>K(t.target.value)})}),e.jsx(r,{sx:{display:"flex",gap:1},children:e.jsx(l,{label:"Amount",type:"number",variant:"outlined",size:"small",fullWidth:!0,value:L,onChange:t=>Q(t.target.value)})}),e.jsx(r,{sx:{display:"flex",gap:1,justifyContent:"center"},children:e.jsx(ie,{control:e.jsx(Le,{size:"small",checked:O,onChange:t=>ue(t.target.checked),color:"error"}),label:e.jsx(s,{variant:"caption",color:O?"error":"text.secondary",children:"Treat as Discount"})})}),e.jsx(_,{color:"primary",sx:{border:"2px solid #ccc",borderRadius:2},onClick:()=>{if(L){const t=Z||`manual-${We(5)}`,o=Number(L)*(O?-1:1);J([...j,{label:t,amount:o}]),K(""),Q("")}},children:e.jsx(Oe,{})})]}),e.jsx(Ue,{sx:{my:1}}),e.jsx(s,{variant:"subtitle2",sx:{fontWeight:"bold",color:"text.secondary"},children:"Delivery Charge"}),e.jsx(l,{label:"Delivery Amount",type:"number",variant:"outlined",fullWidth:!0,value:v??0,onChange:t=>X(Number(t.target.value)),helperText:"Set to 0 to remove delivery charge"})]})}),e.jsx(Fe,{sx:{p:2},children:e.jsx(R,{onClick:()=>T(!1),fullWidth:!0,variant:"contained",sx:{borderRadius:3,py:1.5,fontWeight:"bold"},children:"Done"})})]}),e.jsx(Ae,{open:ce,onContinue:()=>G(!1),onNavigateAway:()=>y({to:"/shop"})})]})}export{yt as component};
