import{j as e,r as p,C as Ce,i as ye,s as Ie,l as we,m as Se}from"./index-BrftD8ME.js";import{u as C}from"./productStore-CYKavjjq.js";import{u as Pe}from"./pricingStore-CDIHPSHB.js";import{n as y,A as G,C as Re,I as K,L as ke,P as We,N as ze,S as De}from"./index.browser-fbe_mTj8.js";import{c as te,B as s,T as n,a as f,P as T}from"./Button-CJN5vbBf.js";import{A as Ae,T as Te,a as Ee,M as I,C as Q}from"./ArrowBackIosNew-CKmh_qYH.js";import{I as j}from"./IconButton-9fU6RE08.js";import{C as E,S as q,E as Ne}from"./Edit-C4X_xSXy.js";import{S as d}from"./Stack-BbyMH-el.js";import{E as X}from"./ExpandMore-DqcQGCgq.js";import{C as J}from"./Collapse-BEem2PEM.js";import{T as u,I as Fe}from"./TextField-F5gMl4zx.js";import{I as w}from"./InputAdornment-BVNdK7W6.js";import{G as S}from"./Grid-BjII6Q-Z.js";import{F as Oe,S as Le,O as Ue}from"./Select-ua_mlDYE.js";import{C as Be}from"./Checkbox-Dw_om2jq.js";import{D as Y}from"./Delete-q3P4uv6_.js";import{S as _e}from"./Search-D3eQcOKB.js";import{D as Z,S as Me}from"./ShoppingBag-CUZI7Yo1.js";import{D as Ve}from"./Dialog-LUgSli6X.js";import{D as He,a as $e,b as Ge}from"./DialogTitle-Ck_HpUr9.js";import{D as Ke}from"./DialogContentText-oyesIjMP.js";import{F as Qe}from"./FitnessCenter-Cl86dZ0-.js";import"./useThemeProps-DhpRE2cF.js";import"./SwitchBase-BXtKTsm0.js";import"./Modal-LR47lFSl.js";const qe=te([e.jsx("path",{d:"m12 12.9-2.13 2.09c-.56.56-.87 1.29-.87 2.07C9 18.68 10.35 20 12 20s3-1.32 3-2.94c0-.78-.31-1.52-.87-2.07z"},"0"),e.jsx("path",{d:"m16 6-.44.55C14.38 8.02 12 7.19 12 5.3V2S4 6 4 13c0 2.92 1.56 5.47 3.89 6.86-.56-.79-.89-1.76-.89-2.8 0-1.32.52-2.56 1.47-3.5L12 10.1l3.53 3.47c.95.93 1.47 2.17 1.47 3.5 0 1.02-.31 1.96-.85 2.75 1.89-1.15 3.29-3.06 3.71-5.3.66-3.55-1.07-6.9-3.86-8.52"},"1")]),Xe=te(e.jsx("path",{d:"M20 10V8h-4V4h-2v4h-4V4H8v4H4v2h4v4H4v2h4v4h2v-4h4v4h2v-4h4v-2h-4v-4zm-6 4h-4v-4h4z"})),ee=[{value:"tag",label:"Tag",icon:e.jsx(Xe,{})},{value:"fitness_center",label:"Dumbbell",icon:e.jsx(Qe,{})},{value:"local_fire_department",label:"Fire",icon:e.jsx(qe,{})},{value:"shopping_bag",label:"Bag",icon:e.jsx(Me,{})}],Je=[{value:"black",color:"#000000"},{value:"white",color:"#ffffff"},{value:"red",color:"#ef4444"},{value:"blue",color:"#3b82f6"},{value:"yellow",color:"#f2b90d"}];function wt(){const re=C(t=>t.pushProducttoDb),se=C(t=>t.updateProduct),oe=C(t=>t.products),N=C(t=>t.fetchProducts),ie=C(t=>t.deleteProduct),F=C(t=>t.categories),{rules:k,fetchRules:ne}=Pe();p.useState(()=>{N(),ne()});const[b,O]=p.useState(null),[ae,L]=p.useState(!1),[W,z]=p.useState(!1),[le,P]=p.useState(!1),[U,B]=p.useState(null),[_,D]=p.useState({}),[A,de]=p.useState(""),ce=t=>{D(r=>({...r,[t]:!r[t]}))},he=t=>{const r={..._};t.forEach(i=>{r[i]=!0}),D(r)},xe=()=>{D({})},M=p.useRef(null),ue=async t=>{const r=t.target.files?.[0];if(r){L(!0);try{const i=ye(Ie,`products/${y()}_${r.name}`),a={customMetadata:{imgRefId:String(o.imgRefId),productName:String(o.name||"unnamed")}},v=await we(i,r,a),R=await Se(v.ref);m(l=>({...l,src:R}))}catch(i){console.error("Error uploading image: ",i),alert("Failed to upload image.")}finally{L(!1)}}},[o,m]=p.useState({name:"",sku:"",id:y(),imgRefId:y(),category:"",detail:"",price:void 0,icon:"fitness_center",imageColor:"black",src:"",sale:!1,isNew:!0,sizes:[],categoryOnly:!1,taxRuleId:"",addonRuleIds:[]}),c=(t,r)=>{m(i=>({...i,[t]:r}))},V=(t,r,i)=>{const a=[...o.sizes||[]];a[t]={...a[t],[r]:i},m(v=>({...v,sizes:a}))},pe=()=>{m(t=>({...t,sizes:[...t.sizes||[],{label:"",price:0}]}))},me=t=>{m(r=>({...r,sizes:r.sizes?.filter((i,a)=>a!==t)}))},ge=t=>{m({...t,imgRefId:t.imgRefId||y()}),O(t.id),z(!0),window.scrollTo({top:0,behavior:"smooth"})},fe=t=>{B(t),P(!0)},je=async()=>{U&&(await ie(U),P(!1),B(null))},H=()=>{m({name:"",sku:"",id:y(),imgRefId:y(),category:"",detail:"",price:void 0,icon:"fitness_center",imageColor:"black",src:"",sale:!1,isNew:!0,sizes:[],categoryOnly:!1}),O(null),z(!1),window.scrollTo({top:0,behavior:"smooth"})},be=async()=>{try{console.log("Saving product...",o);const t=Object.entries(o).reduce((r,[i,a])=>(a!==void 0&&(i==="price"?a===""||a===null||isNaN(Number(a))||(r[i]=Number(a)):r[i]=a),r),{});if(!t.name||!t.price){alert("Please fill in at least Name and Price");return}b?(await se({...t,id:b}),alert("Product updated successfully!")):(await re(t),alert("Product saved successfully!")),await N(),H()}catch(t){console.error("Error saving product:",t),alert("Failed to save product")}};return e.jsxs(s,{sx:{minHeight:"100vh",bgcolor:"background.default",pb:10},children:[e.jsx(Ae,{position:"sticky",color:"default",elevation:0,sx:{bgcolor:"background.paper",borderBottom:1,borderColor:"divider"},children:e.jsxs(Te,{children:[e.jsx(j,{onClick:()=>window.history.back(),edge:"start",children:e.jsx(Ee,{})}),e.jsx(n,{variant:"h6",component:"h1",sx:{flexGrow:1,textAlign:"center",pr:5,fontWeight:"bold"},children:b?"Edit Product":"Add Product"}),b&&e.jsx(f,{color:"inherit",onClick:H,children:"Cancel Edit"})]})}),e.jsx(E,{maxWidth:"sm",sx:{py:3,display:"flex",flexDirection:"column",gap:3},children:e.jsxs(s,{sx:{border:1,borderColor:"divider",borderRadius:3,overflow:"hidden",bgcolor:"background.paper"},children:[e.jsxs(s,{onClick:()=>z(!W),sx:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",p:2,bgcolor:"action.hover",transition:"background-color 0.2s","&:hover":{bgcolor:"action.selected"}},children:[e.jsxs(d,{direction:"row",spacing:1.5,alignItems:"center",children:[e.jsx(G,{color:"primary"}),e.jsx(n,{variant:"subtitle1",sx:{fontWeight:"bold"},children:b?"Edit Product Details":"Add New Product"})]}),e.jsx(j,{size:"small",sx:{transform:W?"rotate(180deg)":"none",transition:"transform 0.3s"},children:e.jsx(X,{})})]}),e.jsx(J,{in:W,children:e.jsxs(s,{sx:{p:2,display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(s,{children:[e.jsx(n,{variant:"subtitle2",sx:{mb:1,fontWeight:"bold",textTransform:"uppercase"},children:"Product Image"}),e.jsx(u,{fullWidth:!0,placeholder:"Paste image URL here...",value:o.src??"",onChange:t=>c("src",t.target.value),InputProps:{endAdornment:e.jsxs(w,{position:"end",children:[e.jsx(j,{onClick:()=>M.current?.click(),edge:"end",children:ae?e.jsx(Ce,{size:24}):e.jsx(Re,{color:"primary"})}),e.jsx("input",{type:"file",hidden:!0,ref:M,accept:"image/*",onChange:ue})]}),sx:{borderRadius:3}}}),e.jsx(s,{sx:{mt:2,height:160,borderRadius:3,border:"2px dashed",borderColor:"divider",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",bgcolor:"action.hover"},children:o.src?e.jsx(s,{component:"img",src:o.src,sx:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsxs(e.Fragment,{children:[e.jsx(K,{sx:{fontSize:40,opacity:.5,mb:1}}),e.jsx(n,{variant:"caption",sx:{opacity:.7},children:"Image preview will appear here"})]})})]}),e.jsxs(d,{spacing:2,children:[e.jsxs(d,{direction:"row",spacing:2,children:[e.jsxs(s,{flex:1,children:[e.jsx(n,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Product Name"}),e.jsx(u,{fullWidth:!0,placeholder:"e.g. Protein Whey",value:o.name??"",onChange:t=>c("name",t.target.value)})]}),e.jsxs(s,{width:140,children:[e.jsx(n,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"SKU ID"}),e.jsx(u,{fullWidth:!0,placeholder:"PROD-001",value:o.sku||"",onChange:t=>c("sku",t.target.value)})]})]}),e.jsxs(s,{children:[e.jsx(n,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Category"}),e.jsxs(u,{select:!0,fullWidth:!0,value:o.category,onChange:t=>c("category",t.target.value),children:[e.jsx(I,{value:"",disabled:!0,children:"Select Category"}),F.filter(t=>t!=="All Items").map(t=>e.jsx(I,{value:t,children:t},t))]})]}),e.jsxs(s,{children:[e.jsx(n,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Detail"}),e.jsx(u,{fullWidth:!0,multiline:!0,minRows:3,placeholder:"Describe the product features...",value:o.detail??"",onChange:t=>c("detail",t.target.value)})]})]}),e.jsx(s,{sx:{my:1,borderTop:1,borderColor:"divider",borderStyle:"dashed"}}),e.jsx(S,{container:!0,spacing:2,children:e.jsxs(S,{size:12,children:[e.jsx(n,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Price"}),e.jsx(u,{fullWidth:!0,type:"number",placeholder:"0.00",value:o.price??"",onChange:t=>c("price",t.target.value===""?void 0:Number(t.target.value)),InputProps:{startAdornment:e.jsx(w,{position:"start",children:"₹"})}})]})}),e.jsxs(S,{container:!0,spacing:2,children:[e.jsx(S,{size:6,children:e.jsxs(u,{select:!0,fullWidth:!0,label:"Tax Rule",value:o.taxRuleId||"",onChange:t=>c("taxRuleId",t.target.value),children:[e.jsx(I,{value:"",children:e.jsx("em",{children:"None"})}),k.filter(t=>t.type==="tax").map(t=>e.jsxs(I,{value:t.id,children:[t.label," (",t.value,t.valueType==="percentage"?"%":"",")"]},t.id))]})}),e.jsx(S,{size:6,children:e.jsxs(Oe,{fullWidth:!0,children:[e.jsx(Fe,{children:"Add-on Costs"}),e.jsx(Le,{multiple:!0,value:o.addonRuleIds||[],onChange:t=>{const r=t.target.value;c("addonRuleIds",typeof r=="string"?r.split(","):r)},input:e.jsx(Ue,{label:"Add-on Costs"}),renderValue:t=>e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(r=>{const i=k.find(a=>a.id===r);return e.jsx(Q,{label:i?.label||r,size:"small"},r)})}),children:k.filter(t=>t.type==="addon").map(t=>e.jsxs(I,{value:t.id,children:[e.jsx(Be,{checked:(o.addonRuleIds||[]).indexOf(t.id)>-1}),e.jsx(ke,{primary:t.label,secondary:`${t.value}${t.valueType==="percentage"?"%":""}`})]},t.id))})]})})]}),e.jsxs(d,{spacing:2,children:[e.jsxs(s,{children:[e.jsx(n,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Icon"}),e.jsx(u,{select:!0,fullWidth:!0,value:o.icon,onChange:t=>c("icon",t.target.value),InputProps:{startAdornment:e.jsx(w,{position:"start",children:ee.find(t=>t.value===o.icon)?.icon})},children:ee.map(t=>e.jsx(I,{value:t.value,children:e.jsxs(d,{direction:"row",alignItems:"center",spacing:1,children:[t.icon,e.jsx("span",{children:t.label})]})},t.value))})]}),e.jsxs(s,{children:[e.jsx(n,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Image Color"}),e.jsx(d,{direction:"row",spacing:1.5,sx:{overflowX:"auto",py:1},children:Je.map(t=>e.jsx(s,{onClick:()=>c("imageColor",t.value),sx:{width:40,height:40,borderRadius:"50%",bgcolor:t.color,border:t.value==="white"?"1px solid #e5e7eb":"none",cursor:"pointer",ring:o.imageColor===t.value?2:0,ringColor:"primary.main",ringOffset:2,boxShadow:1,transition:"all 0.2s",transform:o.imageColor===t.value?"scale(1.1)":"scale(1)"}},t.value))})]})]}),e.jsxs(T,{variant:"outlined",sx:{borderRadius:3,overflow:"hidden"},children:[e.jsxs(s,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px dashed",borderColor:"divider"},children:[e.jsxs(d,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(s,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"primary.light",color:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(We,{fontSize:"small"})}),e.jsx(n,{fontWeight:500,children:"On Sale"})]}),e.jsx(q,{checked:o.sale,onChange:t=>c("sale",t.target.checked)})]}),e.jsxs(s,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(d,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(s,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"primary.light",color:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ze,{fontSize:"small"})}),e.jsx(n,{fontWeight:500,children:"New Arrival"})]}),e.jsx(q,{checked:o.isNew,onChange:t=>c("isNew",t.target.checked)})]})]}),e.jsxs(s,{children:[e.jsx(n,{variant:"h6",sx:{mb:2,fontWeight:"bold"},children:"Available Sizes"}),e.jsxs(d,{spacing:2,children:[o.sizes?.map((t,r)=>e.jsxs(d,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(u,{sx:{width:180},placeholder:"Label",value:t.label,onChange:i=>V(r,"label",i.target.value),inputProps:{style:{textAlign:"center"}}}),e.jsx(u,{fullWidth:!0,placeholder:"0.00",type:"number",value:t.price,onChange:i=>V(r,"price",Number(i.target.value)),InputProps:{startAdornment:e.jsx(w,{position:"start",children:"₹"})}}),e.jsx(j,{color:"error",onClick:()=>me(r),sx:{bgcolor:"error.main",color:"white","&:hover":{bgcolor:"error.dark"},borderRadius:2},children:e.jsx(Y,{})})]},r)),e.jsx(f,{variant:"outlined",startIcon:e.jsx(G,{}),onClick:pe,sx:{py:1.5,borderStyle:"dashed",borderWidth:2,borderRadius:3,"&:hover":{borderWidth:2}},children:"Add Size Variant"})]})]})]})})]})}),e.jsx(E,{maxWidth:"sm",sx:{pb:10},children:e.jsxs(s,{sx:{mt:4},children:[e.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:e.jsx(n,{variant:"h6",sx:{fontWeight:"bold"},children:"Manage Products"})}),e.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:e.jsx(u,{size:"small",placeholder:"Search name or SKU...",value:A,onChange:t=>de(t.target.value),InputProps:{startAdornment:e.jsx(w,{position:"start",children:e.jsx(_e,{fontSize:"small",sx:{opacity:.5}})}),sx:{borderRadius:2,bgcolor:"background.paper"}},sx:{width:"100%"}})}),(()=>{const r=oe.filter(l=>{if(!A)return!0;const h=A.toLowerCase();return l.name.toLowerCase().includes(h)||l.sku&&l.sku.toLowerCase().includes(h)}).reduce((l,h)=>{const g=h.category||"Uncategorized";return l[g]||(l[g]=[]),l[g].push(h),l},{}),i=Object.keys(r).sort(),a=F.filter(l=>l!=="All Items"&&!r[l]).sort();a.forEach(l=>{r[l]=[]});const v=[...i,...a],R=l=>l.map(h=>{const g=r[h]?[...r[h]].sort((x,ve)=>x.name.localeCompare(ve.name)):[],$=!!_[h];return e.jsxs(s,{sx:{mb:3},children:[e.jsxs(s,{onClick:()=>ce(h),sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1.5,bgcolor:"action.selected",borderRadius:2,mb:1,cursor:"pointer"},children:[e.jsxs(n,{variant:"subtitle1",sx:{fontWeight:"bold",display:"flex",alignItems:"center",gap:1},children:[h,e.jsx(Q,{size:"small",label:g.length,sx:{fontWeight:"bold"}})]}),e.jsx(j,{size:"small",sx:{transform:$?"rotate(180deg)":"none",transition:"transform 0.3s"},children:e.jsx(X,{})})]}),e.jsx(J,{in:$,children:e.jsx(d,{spacing:2,children:g.length>0?g.map(x=>e.jsx(T,{variant:"outlined",sx:{p:2,borderRadius:2},children:e.jsxs(d,{direction:"row",spacing:2,alignItems:"center",children:[x.src?e.jsx(s,{component:"img",src:x.src,sx:{width:60,height:60,objectFit:"cover",borderRadius:2,bgcolor:"action.hover"}}):e.jsx(s,{sx:{width:60,height:60,borderRadius:2,bgcolor:"action.hover",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(K,{sx:{opacity:.3}})}),e.jsxs(s,{flex:1,children:[e.jsx(n,{fontWeight:600,children:x.name}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:["₹",x.price]}),e.jsx(d,{direction:"row",spacing:1,alignItems:"center",children:e.jsx(n,{variant:"caption",color:"text.secondary",children:x.category})}),x.sku&&e.jsxs(n,{variant:"caption",color:"text.secondary",children:["SKU: ",x.sku]})]}),e.jsx(j,{size:"small",onClick:()=>ge(x),children:e.jsx(Ne,{})}),e.jsx(j,{size:"small",color:"error",onClick:()=>fe(x.id),children:e.jsx(Y,{})})]})},x.id)):e.jsx(n,{variant:"body2",color:"text.secondary",sx:{fontStyle:"italic",px:1},children:"No products in this category."})})})]},h)});return e.jsxs(e.Fragment,{children:[v.length>0&&e.jsxs(s,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(f,{size:"small",variant:"outlined",onClick:()=>he(v),sx:{borderRadius:2,textTransform:"none",fontWeight:"bold",fontSize:"0.75rem"},children:"Expand All"}),e.jsx(f,{size:"small",variant:"outlined",onClick:xe,sx:{borderRadius:2,textTransform:"none",fontWeight:"bold",fontSize:"0.75rem"},children:"Collapse All"})]}),R(i),a.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",my:3},children:[e.jsx(Z,{sx:{flex:1}}),e.jsx(n,{variant:"caption",sx:{px:2,fontWeight:"bold",color:"text.secondary",textTransform:"uppercase"},children:"Empty Categories"}),e.jsx(Z,{sx:{flex:1}})]}),R(a)]})]})})()]})}),e.jsx(T,{sx:{position:"fixed",bottom:0,left:0,right:0,p:2,bgcolor:"background.paper",borderTop:1,borderColor:"divider",zIndex:10},elevation:4,children:e.jsx(E,{maxWidth:"sm",children:e.jsx(f,{fullWidth:!0,variant:"contained",size:"large",startIcon:e.jsx(De,{}),onClick:be,sx:{height:56,borderRadius:3,fontSize:"1.1rem",fontWeight:"bold",boxShadow:2},children:b?"Update Product":"Save Product"})})}),e.jsxs(Ve,{open:le,onClose:()=>P(!1),PaperProps:{sx:{borderRadius:3,p:1}},children:[e.jsx(He,{sx:{fontWeight:"bold"},children:"Delete Product?"}),e.jsx($e,{children:e.jsx(Ke,{children:"Are you sure you want to delete this product? This action is permanent and cannot be undone."})}),e.jsxs(Ge,{sx:{p:2},children:[e.jsx(f,{onClick:()=>P(!1),color:"inherit",sx:{fontWeight:"bold"},children:"Cancel"}),e.jsx(f,{onClick:je,variant:"contained",color:"error",sx:{fontWeight:"bold",borderRadius:2},children:"Delete"})]})]})]})}export{wt as component};
