import{a4 as _,a5 as $,r as y,a6 as J,a7 as K,z as V,D as Y,F as q,j as e,H as G,J as X,L as Z,h as d,M as ee,a8 as se,f as te,b as ae,B as f,_ as P,S as I,l as ie,I as ne,C as re,n as k,o as E,q as oe,s as le,v as ce,a9 as de,w as ue,y as pe}from"./index-DMntrt3L.js";import{H as he}from"./Header-C_uiZ5Uo.js";import{P as me}from"./Page-D33iz8L4.js";import{C as M}from"./CloudUpload-B5-EYuF6.js";import{B as w}from"./Button-Ckk0okGH.js";import{A as xe}from"./Alert-C2GjgLKw.js";import{C as fe}from"./CardContent-cikzG0YB.js";import{C as g}from"./Chip-DgrX7GFC.js";import{C as U}from"./CheckCircle-C78TZ2BW.js";import{D as ge}from"./Divider-Cwjuf2tN.js";import{P as be}from"./Person-CDWHQXEf.js";import{P as je}from"./Phone-DBk2LAGX.js";import{S as ye}from"./ShoppingBag-BQAemrGJ.js";import{D as L}from"./Delete-AjyBKf_c.js";import{T as ve,a as Se,b as Ce,c as Q,d as p,e as we}from"./TableRow-CSUPO8G-.js";import"./Grid-BFXh-DsK.js";import"./isMuiElement-DBjZruLu.js";import"./dividerClasses-CghbcqQP.js";function Te(t,c,a,r,h){const[n,m]=y.useState(()=>h&&a?a(t).matches:r?r(t).matches:c);return K(()=>{if(!a)return;const l=a(t),b=()=>{m(l.matches)};return b(),l.addEventListener("change",b),()=>{l.removeEventListener("change",b)}},[t,a]),n}const De={...J},F=De.useSyncExternalStore;function Ie(t,c,a,r,h){const n=y.useCallback(()=>c,[c]),m=y.useMemo(()=>{if(h&&a)return()=>a(t).matches;if(r!==null){const{matches:x}=r(t);return()=>x}return n},[n,t,r,h,a]),[l,b]=y.useMemo(()=>{if(a===null)return[n,()=>()=>{}];const x=a(t);return[()=>x.matches,j=>(x.addEventListener("change",j),()=>{x.removeEventListener("change",j)})]},[n,a,t]);return F(b,l,m)}function H(t={}){const{themeId:c}=t;return function(r,h={}){let n=_();n&&c&&(n=n[c]||n);const m=typeof window<"u"&&typeof window.matchMedia<"u",{defaultMatches:l=!1,matchMedia:b=m?window.matchMedia:null,ssrMatchMedia:S=null,noSsr:x=!1}=$({name:"MuiUseMediaQuery",props:h,theme:n});let j=typeof r=="function"?r(n):r;return j=j.replace(/^@media( ?)/m,""),j.includes("print")&&console.warn(["MUI: You have provided a `print` query to the `useMediaQuery` hook.","Using the print media query to modify print styles can lead to unexpected results.","Consider using the `displayPrint` field in the `sx` prop instead.","More information about `displayPrint` on our docs: https://mui.com/system/display/#display-in-print."].join(`
`)),(F!==void 0?Ie:Te)(j,l,b,S,x)}}H();function ze(t){return V("MuiAlertTitle",t)}Y("MuiAlertTitle",["root"]);const Ae=t=>{const{classes:c}=t;return Z({root:["root"]},ze,c)},Me=G(d,{name:"MuiAlertTitle",slot:"Root"})(ee(({theme:t})=>({fontWeight:t.typography.fontWeightMedium,marginTop:-2}))),Re=y.forwardRef(function(c,a){const r=q({props:c,name:"MuiAlertTitle"}),{className:h,...n}=r,m=r,l=Ae(m);return e.jsx(Me,{gutterBottom:!0,component:"div",ownerState:m,ref:a,className:X(l.root,h),...n})}),We=H({themeId:se}),B=te(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}));function Xe(){const[t,c]=y.useState(!1),[a,r]=y.useState([]),[h,n]=y.useState(!1),m=ae(),l=We(m.breakpoints.down("sm")),b=s=>!s.items||!Array.isArray(s.items)?"Missing or invalid items array":typeof s.total!="number"?"Missing or invalid total price":!s.shippingDetails||!s.shippingDetails.phoneNumber?"Missing shipping details or phone number":null,S=async s=>{if(!s)return!1;const i=ce(k(E,"orders"),ue("offlineId","==",s),de(1));return!(await pe(i)).empty},x=async s=>{const i=s.target.files;if(!i||i.length===0)return;const u=[];for(let o=0;o<i.length;o++){const v=i[o];try{const D=await v.text(),C=JSON.parse(D),N=b(C);let A=N?"invalid":"valid",O=N||void 0;A==="valid"&&C.offlineId&&await S(C.offlineId)&&(A="duplicate",O="This order has already been synced."),u.push({fileName:v.name,data:C,status:A,error:O})}catch{u.push({fileName:v.name,data:null,status:"invalid",error:"Failed to parse JSON"})}}r(o=>[...o,...u]),n(!0),s.target.value=""},j=async()=>{c(!0);const s=k(E,"orders"),i=[...a];for(let u=0;u<i.length;u++){const o=i[u];if(o.status==="valid")try{if(o.data.offlineId&&await S(o.data.offlineId)){i[u]={...o,status:"duplicate",error:"Already synced."};continue}const{id:v,...D}=o.data;await oe(s,{...D,timestamp:le(),offlineTimestamp:o.data.timestamp||new Date().toISOString(),isOfflineUpload:!0}),i[u]={...o,status:"success"}}catch(v){i[u]={...o,status:"error",error:v.message}}}r(i),c(!1)},z=s=>{r(i=>i.filter((u,o)=>o!==s)),a.length<=1&&n(!1)},R=()=>{r([]),n(!1)},T=a.filter(s=>s.status==="valid").length,W=a.filter(s=>s.status==="success").length;return e.jsxs(f,{sx:{bgcolor:"background.default",minHeight:"100vh",pb:5},children:[e.jsx(he,{title:"Offline Order Sync"}),e.jsx(me,{children:e.jsxs(f,{sx:{p:2},children:[e.jsx(d,{variant:"h5",sx:{mb:1,fontWeight:"bold"},children:"Sync Offline Orders"}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Upload the .json files generated while placing orders in offline mode."}),h?e.jsxs(I,{spacing:2,children:[e.jsxs(xe,{severity:"info",variant:"outlined",sx:{borderRadius:2},children:[e.jsxs(Re,{sx:{fontWeight:"bold"},children:[a.length," Order(s) Loaded"]}),T>0?`${T} valid orders ready for sync.`:"No valid orders found in the selected files.",W>0&&` | ${W} successfully uploaded!`]}),l?e.jsx(I,{spacing:2,children:a.map((s,i)=>e.jsx(ie,{sx:{borderRadius:3,border:1,borderColor:"divider",boxShadow:"none"},children:e.jsxs(fe,{sx:{p:2,"&:last-child":{pb:2}},children:[e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1.5},children:[e.jsxs(f,{children:[e.jsx(d,{variant:"caption",color:"text.secondary",sx:{textTransform:"uppercase",letterSpacing:1},children:s.fileName}),e.jsxs(d,{variant:"h6",sx:{fontWeight:"bold"},children:["₹",s.data?.total||0]})]}),e.jsxs(f,{children:[s.status==="valid"&&e.jsx(g,{label:"Ready",color:"info",size:"small"}),s.status==="invalid"&&e.jsx(g,{label:"Invalid",color:"error",size:"small"}),s.status==="duplicate"&&e.jsx(g,{label:"Duplicate",color:"warning",size:"small",title:s.error}),s.status==="success"&&e.jsx(g,{label:"Sync OK",color:"success",size:"small",icon:e.jsx(U,{sx:{fontSize:"1rem !important"}})}),s.status==="error"&&e.jsx(g,{label:"Failed",color:"error",size:"small",icon:e.jsx(B,{sx:{fontSize:"1rem !important"}})})]})]}),e.jsx(ge,{sx:{mb:1.5}}),e.jsxs(I,{spacing:1,children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(be,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(d,{variant:"body2",children:s.data?.shippingDetails?.firstName||"N/A"})]}),e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(je,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(d,{variant:"body2",children:s.data?.shippingDetails?.phoneNumber||"N/A"})]}),e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ye,{sx:{fontSize:16,color:"text.secondary"}}),e.jsxs(d,{variant:"body2",children:[s.data?.items?.length||0," Items"]})]})]}),(s.status==="invalid"||s.status==="error")&&e.jsxs(d,{variant:"caption",color:"error",sx:{mt:1,display:"block"},children:["Error: ",s.error]}),s.status!=="success"&&s.status!=="error"&&e.jsx(f,{sx:{mt:2,display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{size:"small",color:"error",startIcon:e.jsx(L,{}),onClick:()=>z(i),disabled:t,children:"Remove"})})]})},i))}):e.jsx(ve,{component:P,sx:{borderRadius:3,border:1,borderColor:"divider",boxShadow:"none"},children:e.jsxs(Se,{children:[e.jsx(Ce,{sx:{bgcolor:"action.hover"},children:e.jsxs(Q,{children:[e.jsx(p,{sx:{fontWeight:"bold"},children:"File / ID"}),e.jsx(p,{sx:{fontWeight:"bold"},children:"Customer"}),e.jsx(p,{sx:{fontWeight:"bold"},children:"Items"}),e.jsx(p,{sx:{fontWeight:"bold"},children:"Total"}),e.jsx(p,{sx:{fontWeight:"bold"},children:"Status"}),e.jsx(p,{sx:{fontWeight:"bold"},align:"right",children:"Action"})]})}),e.jsx(we,{children:a.map((s,i)=>e.jsxs(Q,{children:[e.jsxs(p,{children:[e.jsx(d,{variant:"body2",sx:{fontWeight:500},children:s.fileName}),e.jsx(d,{variant:"caption",color:"text.secondary",children:s.data?.timestamp?new Date(s.data.timestamp).toLocaleString():"N/A"})]}),e.jsxs(p,{children:[s.data?.shippingDetails?.firstName||"N/A",e.jsx(d,{variant:"caption",display:"block",color:"text.secondary",children:s.data?.shippingDetails?.phoneNumber})]}),e.jsx(p,{children:s.data?.items?.length||0}),e.jsxs(p,{sx:{fontWeight:"bold"},children:["₹",s.data?.total?.toLocaleString()||0]}),e.jsxs(p,{children:[s.status==="valid"&&e.jsx(g,{label:"Ready",color:"info",variant:"outlined",size:"small"}),s.status==="invalid"&&e.jsx(g,{label:"Invalid",color:"error",variant:"outlined",size:"small",title:s.error}),s.status==="duplicate"&&e.jsx(g,{label:"Duplicate",color:"warning",variant:"outlined",size:"small",title:s.error}),s.status==="success"&&e.jsx(g,{label:"Synced",color:"success",size:"small",icon:e.jsx(U,{})}),s.status==="error"&&e.jsx(g,{label:"Failed",color:"error",size:"small",icon:e.jsx(B,{}),title:s.error})]}),e.jsx(p,{align:"right",children:s.status!=="success"&&e.jsx(ne,{color:"error",size:"small",onClick:()=>z(i),disabled:t,children:e.jsx(L,{})})})]},i))})]})}),e.jsxs(I,{direction:l?"column":"row",spacing:2,justifyContent:"space-between",sx:{mt:2},children:[e.jsx(w,{variant:"outlined",color:"inherit",onClick:R,disabled:t,fullWidth:l,sx:{borderRadius:10,textTransform:"none"},children:"Cancel & Clear"}),e.jsxs(f,{sx:{display:"flex",gap:2},children:[e.jsxs(w,{variant:"outlined",component:"label",disabled:t,fullWidth:l,sx:{borderRadius:10,textTransform:"none"},children:["Add More Files",e.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".json",onChange:x})]}),e.jsx(w,{variant:"contained",color:"primary",onClick:j,disabled:t||T===0,fullWidth:l,startIcon:t?e.jsx(re,{size:20,color:"inherit"}):e.jsx(M,{}),sx:{borderRadius:10,px:4,textTransform:"none",fontWeight:"bold"},children:t?"Syncing...":`Sync ${T} Orders`})]})]})]}):e.jsxs(P,{sx:{p:6,textAlign:"center",border:"2px dashed",borderColor:"primary.main",borderRadius:4,bgcolor:"rgba(25, 118, 210, 0.02)",transition:"all 0.3s","&:hover":{bgcolor:"rgba(25, 118, 210, 0.05)",borderColor:"primary.dark"}},children:[e.jsx(M,{sx:{fontSize:80,color:"primary.main",mb:2,opacity:.8}}),e.jsx(d,{variant:"h6",sx:{mb:1,fontWeight:"bold"},children:"Ready to upload"}),e.jsx(d,{variant:"body2",sx:{mb:4,color:"text.secondary",maxWidth:300,mx:"auto"},children:"Drag and drop your order files here or click the button below to browse."}),e.jsxs(w,{variant:"contained",component:"label",size:"large",startIcon:e.jsx(M,{}),sx:{borderRadius:10,px:4,py:1.5,textTransform:"none",fontSize:"1rem",fontWeight:"bold"},children:["Browse Files",e.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".json",onChange:x})]})]})]})})]})}export{Xe as component};
