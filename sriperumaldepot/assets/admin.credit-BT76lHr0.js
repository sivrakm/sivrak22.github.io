import{a as J,u as Q,r as l,j as e,B as r,I as x,A as I,h as i,C as V,S as b,m as G,k as _,E as K,l as X,o as Z,q as C,z as ee,F as te,G as se,y as re,v as A,x as O}from"./index-Cp2I37WV.js";import{O as oe}from"./OrderItem-ngo4I1yh.js";import{O as ne,a as ae}from"./OrderShippingDetails-BHgEyGr8.js";import{T as P}from"./TextField-DFh5Z3SN.js";import{S as ie}from"./Search-BDBvXvmT.js";import{T as le,a as E}from"./Tabs-5ehGGnYo.js";import{P as de}from"./Page-C5G7tS54.js";import{C as R}from"./CheckCircle-Cn5NRRkC.js";import{H as ce}from"./HourglassTop-XmYwMvNG.js";import{B as p}from"./Button-BhddC0uT.js";import{D as xe,a as pe,b as me}from"./DialogTitle-C1XPoAzT.js";import{D as he}from"./DialogContentText-Z6gPO8G6.js";import{D as ue}from"./DialogActions-B-je9ZVc.js";import"./ShoppingCart-DD5dTHTw.js";import"./Divider-BmF7nJuL.js";import"./dividerClasses-DniQLY7G.js";import"./Person-DCpPYQWV.js";import"./Phone-Bt5g39SG.js";import"./Home-B28n4KG8.js";import"./isMuiElement-C4u7QS8z.js";const fe=re`
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
`;function Ne(){const F=J(),S=Q(t=>t.user),[d,B]=l.useState([]),[N,v]=l.useState(!0),[m,L]=l.useState(0),[q,w]=l.useState(null),[h,T]=l.useState({}),[u,D]=l.useState(""),[z,k]=l.useState(!1),[f,c]=l.useState(null),g=async()=>{if(!S){v(!1);return}try{const t=Z(C,"orders"),o=ee(t,te("timestamp","desc")),n=(await se(o)).docs.map(s=>({id:s.id,...s.data()})).filter(s=>s.orderType==="delay");B(n)}catch(t){console.error("Error fetching credit orders:",t)}finally{v(!1)}};l.useEffect(()=>{g()},[S]);const W=d.filter(t=>{const o=t.isClosed||!1;if(m===0&&o||m===1&&!o)return!1;if(u.trim()){const a=u.toLowerCase(),n=t.id.toLowerCase().includes(a),s=t.shippingDetails||{},y=(s.firstName?.toLowerCase()||"").includes(a)||(s.orgName?.toLowerCase()||"").includes(a),j=(s.phoneNumber||"").includes(a);return n||y||j}return!0}),M=async(t,o,a)=>{if(!o||o<=0)return;const n=d.find(s=>s.id===t);if(n)try{const s={amount:o,timestamp:new Date,method:a},y=[...n.payments||[],s],j=(n.paidAmount||0)+o,$=A(C,"orders",t);await O($,{payments:y,paidAmount:j}),T(Y=>({...Y,[t]:""})),g()}catch(s){console.error("Error adding payment:",s),alert("Failed to add payment")}},U=async()=>{if(f)try{const t=A(C,"orders",f);await O(t,{isClosed:!0}),c(null),g()}catch(t){console.error("Error closing delay:",t),alert("Failed to close delayed order")}},H=t=>t?t.toDate().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"Just now";return e.jsxs(r,{sx:{pb:10,bgcolor:"background.default",minHeight:"100vh",color:"text.primary"},children:[e.jsxs(r,{sx:{position:"sticky",top:0,zIndex:1100,bgcolor:"background.default",borderBottom:1,borderColor:"divider"},children:[e.jsx(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2,height:60},children:z?e.jsxs(r,{sx:{display:"flex",alignItems:"center",flex:1,gap:1},children:[e.jsx(x,{onClick:()=>{k(!1),D("")},children:e.jsx(I,{})}),e.jsx(P,{autoFocus:!0,placeholder:"Search Customer or Org...",variant:"standard",size:"small",fullWidth:!0,value:u,onChange:t=>D(t.target.value),InputProps:{disableUnderline:!0,sx:{fontSize:"1rem",fontWeight:600,"& input":{padding:"8px 0"}}}})]}):e.jsxs(e.Fragment,{children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(x,{sx:{ml:-1},onClick:()=>F({to:"/admin"}),children:e.jsx(I,{})}),e.jsx(i,{variant:"h6",sx:{fontWeight:800},children:"Credit"})]}),e.jsx(x,{onClick:()=>k(!0),children:e.jsx(ie,{})})]})}),e.jsxs(le,{value:m,onChange:(t,o)=>L(o),variant:"fullWidth",indicatorColor:"primary",textColor:"primary",sx:{borderTop:1,borderColor:"divider"},children:[e.jsx(E,{label:`Active (${d.filter(t=>!t.isClosed).length})`,sx:{fontWeight:"bold",textTransform:"none"}}),e.jsx(E,{label:`Closed (${d.filter(t=>t.isClosed).length})`,sx:{fontWeight:"bold",textTransform:"none"}})]})]}),e.jsx(de,{children:N?e.jsx(r,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(V,{})}):W.length===0?e.jsx(r,{sx:{textAlign:"center",py:8},children:e.jsx(i,{color:"text.secondary",children:"No credit orders found."})}):e.jsx(b,{spacing:2,sx:{p:2},children:W.map(t=>{const o=(t.total||0)-(t.paidAmount||0),a=q===t.id;return e.jsxs(G,{sx:{p:2,borderRadius:3,border:1,borderColor:a?"primary.main":"divider",boxShadow:"none",transition:"all 0.2s",animation:`${fe} 0.4s ease-out`},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,cursor:"pointer",flex:1},onClick:()=>w(a?null:t.id),children:[e.jsx(_,{sx:{bgcolor:t.isClosed?"success.lighter":"secondary.lighter",color:t.isClosed?"success.main":"secondary.main",border:1,borderColor:"divider",width:48,height:48},children:t.isClosed?e.jsx(R,{}):e.jsx(ce,{})}),e.jsxs(r,{children:[e.jsx(i,{variant:"body1",sx:{fontWeight:800},children:t.shippingDetails?.orgName||t.shippingDetails?.firstName||"Unknown Customer"}),e.jsxs(i,{variant:"caption",sx:{color:"text.secondary",fontWeight:600},children:["#",t.id.slice(0,5).toUpperCase()," • ",H(t.timestamp)]})]})]}),e.jsxs(r,{sx:{textAlign:"right",mr:1},children:[e.jsx(i,{variant:"body1",sx:{fontWeight:900,color:o>0?"error.main":"success.main"},children:o>0?`₹${o.toFixed(0)}`:"Settled"}),e.jsxs(i,{variant:"caption",color:"text.secondary",sx:{fontWeight:600},children:["Total: ₹",t.total?.toFixed(0)]})]}),e.jsx(x,{size:"small",onClick:()=>w(a?null:t.id),children:e.jsx(K,{sx:{transform:a?"rotate(180deg)":"none",transition:"0.3s"}})})]}),e.jsx(X,{in:a,timeout:"auto",unmountOnExit:!0,children:e.jsxs(r,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:[e.jsx(ne,{order:t}),e.jsxs(r,{sx:{mt:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:800,color:"primary.main",mb:1.5,display:"block",textTransform:"uppercase",letterSpacing:1},children:"Payment History"}),e.jsxs(b,{spacing:1,children:[t.payments?.map((n,s)=>e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",bgcolor:"action.hover",p:1.5,borderRadius:2,border:1,borderColor:"divider"},children:[e.jsxs(r,{children:[e.jsxs(i,{variant:"body2",sx:{fontWeight:700},children:[n.method," Payment"]}),e.jsx(i,{variant:"caption",sx:{color:"text.secondary",fontWeight:600},children:n.timestamp?.seconds?new Date(n.timestamp.seconds*1e3).toLocaleDateString():"Just now"})]}),e.jsxs(i,{variant:"body2",sx:{fontWeight:900,color:"success.main",display:"flex",alignItems:"center"},children:["+₹",n.amount.toFixed(2)]})]},s)),!t.isClosed&&e.jsxs(r,{sx:{display:"flex",gap:1.5,mt:1.5},children:[e.jsx(P,{size:"small",placeholder:"Enter amount paid...",type:"number",fullWidth:!0,value:h[t.id]||"",onChange:n=>T(s=>({...s,[t.id]:n.target.value})),sx:{"& .MuiOutlinedInput-root":{borderRadius:3,bgcolor:"background.paper"}}}),e.jsx(p,{variant:"contained",onClick:()=>M(t.id,Number(h[t.id]),"Cash"),disabled:!h[t.id],sx:{borderRadius:3,textTransform:"none",fontWeight:900,px:4,boxShadow:"none"},children:"Add"})]})]})]}),!t.isClosed&&e.jsx(r,{sx:{mt:3},children:e.jsx(p,{fullWidth:!0,variant:"outlined",color:"primary",onClick:()=>c(t.id),startIcon:e.jsx(R,{}),sx:{borderRadius:3,fontWeight:900,textTransform:"none",py:1.2,border:2,"&:hover":{border:2}},children:"Mark as Fully Settled"})}),e.jsx(r,{sx:{mt:3,pt:3,borderTop:1,borderColor:"divider"},children:e.jsx(ae,{shippingDetails:t.shippingDetails||{}})}),e.jsxs(r,{sx:{mt:3},children:[e.jsxs(i,{variant:"caption",sx:{fontWeight:800,color:"text.secondary",mb:1.5,display:"block",textTransform:"uppercase",letterSpacing:1},children:["Items in this ","Estimate"]}),e.jsx(b,{spacing:1,children:t.items?.map((n,s)=>e.jsx(oe,{item:n},s))})]})]})})]},t.id)})})}),e.jsxs(xe,{open:!!f,onClose:()=>c(null),PaperProps:{sx:{borderRadius:3,p:1}},children:[e.jsx(pe,{sx:{fontWeight:800},children:"Confirm Settlement"}),e.jsx(me,{children:e.jsx(he,{sx:{fontWeight:600},children:'Are you sure you want to mark this credit account as fully settled? This will move it to the "Closed" list.'})}),e.jsxs(ue,{sx:{px:3,pb:2},children:[e.jsx(p,{onClick:()=>c(null),sx:{fontWeight:700,color:"text.secondary"},children:"Cancel"}),e.jsx(p,{onClick:U,variant:"contained",color:"success",sx:{fontWeight:800,borderRadius:2,px:3,boxShadow:"none"},children:"Yes, Settle"})]})]})]})}export{Ne as component};
