import{j as e,r as s,Z as D,_ as S,C as N,$ as W,u as b,a as q,a0 as B}from"./index-BKQIwkgS.js";import{H as G}from"./Header-m7DMjSSN.js";import{P as I}from"./Page-C_dNj2ei.js";import{F as U}from"./FlashOn-DYzU7c7X.js";import{c as V,a as O}from"./Button-BtkFHrzY.js";import{T}from"./TextField-DNonHxpy.js";import{I as Z}from"./InputAdornment-XqDxGbQl.js";import"./Grid-CIQrjXfY.js";import"./useThemeProps-C7-CrF6s.js";import"./Select--fNtjKdT.js";import"./Modal-DYh4GvsK.js";const _=V([e.jsx("path",{d:"M20 5V4c0-1.1-.9-2-2-2s-2 .9-2 2v1h-1v5h6V5zm-1 0h-2V4c0-.55.45-1 1-1s1 .45 1 1z"},"0"),e.jsx("path",{d:"m15.63 14.4-2.52 2.5c-2.5-1.43-4.57-3.5-6-6l2.5-2.52c.23-.24.33-.57.27-.9L9.13 3.8c-.09-.46-.5-.8-.98-.8H4c-.56 0-1.03.47-1 1.03.17 2.89 1.05 5.6 2.43 7.97 1.58 2.73 3.85 4.99 6.57 6.57 2.37 1.37 5.08 2.26 7.97 2.43.56.03 1.03-.44 1.03-1v-4.15c0-.48-.34-.89-.8-.98l-3.67-.73c-.33-.07-.67.03-.9.26"},"1")]),$=V(e.jsx("path",{d:"M2 17h20v2H2zm1.15-4.05L4 11.47l.85 1.48 1.3-.75-.85-1.48H7v-1.5H5.3l.85-1.47L4.85 7 4 8.47 3.15 7l-1.3.75.85 1.47H1v1.5h1.7l-.85 1.48zm6.7-.75 1.3.75.85-1.48.85 1.48 1.3-.75-.85-1.48H15v-1.5h-1.7l.85-1.47-1.3-.75L12 8.47 11.15 7l-1.3.75.85 1.47H9v1.5h1.7zM23 9.22h-1.7l.85-1.47-1.3-.75L20 8.47 19.15 7l-1.3.75.85 1.47H17v1.5h1.7l-.85 1.48 1.3.75.85-1.48.85 1.48 1.3-.75-.85-1.48H23z"})),C=(c,o,a,r)=>{const n=c.target.value.replace(/\D/g,"");n.length<=a&&(o(n),r?.(!0)),n.length===a&&r?.(!1)},L={"& input[type=number]":{MozAppearance:"textfield"},"& input[type=number]::-webkit-outer-spin-button,                                         & input[type=number]::-webkit-inner-spin-button":{WebkitAppearance:"none",margin:0}};function J({icon:c=e.jsx(U,{}),title:o="POS Demo",onSuccess:a,onLoading:r,onBeforeSendOtp:n}){const[h,z]=s.useState(!1),[l,H]=s.useState(""),[v,w]=s.useState(""),[F,u]=s.useState(!1),[k,f]=s.useState(!1),[E,p]=s.useState(""),[y,A]=s.useState(null),j=s.useRef(null),[m,g]=s.useState(!1);s.useEffect(()=>{j.current||(j.current=new D(S,"recaptcha-container",{size:"invisible",callback:()=>{}}))},[]);const P=t=>{g(t),r&&r(t)},R=async t=>{if(!y){f(!0);return}P(!0);try{const d=await y.confirm(t);a&&a(d.user)}catch(d){console.error("Error verifying OTP:",d),f(!0),P(!1)}},M=async()=>{if(!l){p("Phone number cannot be empty"),u(!0);return}if(l.length<10){p("Please enter a valid 10-digit mobile number"),u(!0);return}const t=j.current;if(!t)return;if(g(!0),n){const i=await n(l);if(!i.allowed){p(i.error||"Unauthorized"),u(!0),g(!1);return}}const d="+91"+l;try{const i=await W(S,d,t);A(i),z(!0)}catch(i){console.error("Error sending OTP:",i);let x="Failed to send OTP. Please try again.";i.code==="auth/billing-not-enabled"?x="Server not enabled. Try again later.":i.code==="auth/invalid-app-credential"?x="Invalid Config. Try again later.":i.code==="auth/too-many-requests"&&(x="Too many attempts. Try again later."),p(x),u(!0)}finally{g(!1)}};return e.jsx(I,{children:e.jsxs("span",{className:"signin-page",children:[e.jsx(G,{icon:c,title:o,rightContent:e.jsxs("span",{className:"header-right-content",children:["Need help?Â ",e.jsx("br",{}),e.jsx("span",{className:"highlighted",children:"Contact Support"})]})}),e.jsxs("div",{className:"signin-content",children:[e.jsx("div",{className:"head-text",children:h?"Verify OTP":"Sign in with Phone"}),e.jsxs(I,{variant:"card1",className:"signin-card",children:[e.jsx("div",{children:h?e.jsx($,{className:"signin-icon"}):e.jsx(_,{className:"signin-icon"})}),e.jsx("div",{className:"head-text-desc",children:h?"Enter the OTP sent to your mobile number for verification.":"Enter your mobile number to access the platform."}),h?e.jsxs(e.Fragment,{children:[e.jsx(T,{name:"otp",value:v,onChange:t=>{f(!1),C(t,w,6)},label:"One Time Password",color:"secondary",placeholder:"x x x x x x",className:"signin-input",type:"number",sx:L}),e.jsx("br",{}),k&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"invalid-msg",children:"Invalid OTP, Please try again."}),e.jsx("br",{})]}),e.jsx(O,{variant:"contained",color:"success",className:"signin-button",onClick:()=>R(v),disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsx(N,{size:20,color:"inherit"}),e.jsx("span",{style:{marginLeft:"10px"},children:"Verifying..."})]}):"Verify & Sign In"})]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{label:"Phone Number",color:"secondary",placeholder:" 00000 00000",className:"signin-input",name:"phone",value:l,onChange:t=>C(t,H,10,u),type:"number",sx:L,slotProps:{input:{inputMode:"numeric",startAdornment:e.jsx(Z,{position:"start",children:"+91"})}}}),e.jsx("br",{}),F&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"invalid-msg",children:E}),e.jsx("br",{})]}),e.jsx("div",{id:"recaptcha-container"}),e.jsx(O,{variant:"contained",color:"success",className:"signin-button",onClick:M,disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsx(N,{size:20,color:"inherit"}),e.jsx("span",{style:{marginLeft:"10px"},children:"Sending..."})]}):"Get OTP"})]})]})]})]})})}const oe=()=>{const c=b(n=>n.login),o=b(n=>n.isAuthenticated),a=b(n=>n.setLoading),r=q();return s.useEffect(()=>(o&&(a(!0),r({to:"/shop"})),()=>a(!1)),[o,r,a]),e.jsx(J,{onSuccess:n=>{c(n),r({to:"/shop"})},onLoading:a,onBeforeSendOtp:B})};export{oe as component};
