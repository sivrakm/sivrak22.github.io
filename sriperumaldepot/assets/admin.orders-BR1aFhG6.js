import{a9 as ze,a as Pe,u as Te,r as i,j as e,B as s,I as j,A as K,h as g,S as C,C as Oe,l as Ae,i as Ie,E as Z,k as Ee,_ as ee,n as Le,o as f,y as Be,D as We,F as Qe,x as Ne,t as S,w as T,aa as re,v as qe}from"./index-b1ip_EDv.js";import{p as Me}from"./printInvoice-CcVnMh2q.js";import{O as Fe}from"./OrderItem-bo2LFLST.js";import{O as Ue,a as $e,W as He,R as Ye,c as _e}from"./WhatsAppShareButton-Cy_NxDGN.js";import{Y as Je}from"./index-C1o_VoeG.js";import{C as te,I as Ve,H as Xe}from"./Inventory2-B6lEWcpY.js";import{S as Ge}from"./Search-VoUk0TD0.js";import{B as a}from"./Button-B78WCA0J.js";import{D as oe,a as se,b as ne,c as ie}from"./DialogTitle-5RZxZLE7.js";import{D as ae}from"./DialogContentText-DDlqcVzt.js";import{C as Ke}from"./CheckCircle-DSp-wEfF.js";import{L as Ze}from"./LocalShipping-ar9ls4SR.js";import"./ShoppingCart-CUYNi2bv.js";import"./Divider-BEh3D_4C.js";import"./dividerClasses-CFrEYv8G.js";import"./Person-xBZQx18C.js";import"./Phone-Cv3wvD6U.js";import"./QuantitySelector-CMGu1lnP.js";import"./Add-C6RolQ-l.js";import"./TextField-CMmL5EPD.js";import"./isMuiElement-B8Y2ebQe.js";import"./FormControlLabel-BLhzEspZ.js";import"./SwitchBase-DSIZmQ03.js";import"./Checkbox-DnPPPakV.js";function er(q){return ze({select:p=>p.location})}const O=Ne`
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
`;function kr(){const q=Pe(),p=Te(r=>r.user),[M,le]=i.useState([]),[ce,v]=i.useState(!0),[d,de]=i.useState("All"),[A,ue]=i.useState(null),[pe,w]=i.useState(!1),[F,U]=i.useState(null),[xe,$]=i.useState(!1),[x,he]=i.useState(null),[me,I]=i.useState(!1),[k,D]=i.useState(""),H=er();i.useEffect(()=>{const t=new URLSearchParams(H.search).get("search");t&&(D(t),I(!0))},[H.search]);const[ge,R]=i.useState(!1),[Y,E]=i.useState(""),[h,_]=i.useState(null),fe=["All","Processing","Delivered","Cancelled"],b=async()=>{if(!p){v(!1);return}try{const r=Le(f,"orders"),t=Be(r,We("timestamp","desc")),o=(await Qe(t)).docs.map(l=>({id:l.id,...l.data()}));le(o)}catch(r){console.error("Error fetching orders:",r)}finally{v(!1)}};i.useEffect(()=>{b()},[p]);const u=M.filter(r=>{if(d!=="All"&&(r.status==="pending"?"Processing":r.status).toLowerCase()!==d.toLowerCase())return!1;if(k.trim()){const t=k.toLowerCase(),n=r.id.toLowerCase().includes(t),o=r.shippingDetails||{},l=(o.firstName?.toLowerCase()||"").includes(t)||(o.lastName?.toLowerCase()||"").includes(t),c=(o.phoneNumber||"").includes(t),m=(o.orgName?.toLowerCase()||"").includes(t),B=r.items?.some(W=>W.name.toLowerCase().includes(t));return n||l||c||m||B}return!0}),be=async()=>{if(!p||!p.phoneNumber){alert("User phone number not found. Cannot verify identity.");return}if(Y!==p.phoneNumber){alert("Phone number does not match logged-in user.");return}const r=u;if(r.length!==0){v(!0);try{const t=r.map(async n=>{const o=S(f,"orders",n.id);h==="deliver"?n.status!=="Delivered"&&await T(o,{status:"Delivered"}):h==="delete"&&await re(o)});await Promise.all(t),alert(`Bulk ${h==="deliver"?"Delivery":"Deletion"} Complete!`),R(!1),E(""),_(null),b()}catch(t){console.error("Bulk action error:",t),alert("Failed to perform bulk action.")}finally{v(!1)}}},J=r=>{_(r),R(!0),E("")},ye=r=>{switch(r.toLowerCase()){case"pending":case"processing":return{label:"Processing",icon:e.jsx(Xe,{fontSize:"small"}),color:"warning.main",bgcolor:"rgba(237, 108, 2, 0.1)",borderColor:"rgba(237, 108, 2, 0.2)"};case"shipped":return{label:"Shipped",icon:e.jsx(Ze,{fontSize:"small"}),color:"info.main",bgcolor:"rgba(2, 136, 209, 0.1)",borderColor:"rgba(2, 136, 209, 0.2)"};case"delivered":return{label:"Delivered",icon:e.jsx(Ve,{fontSize:"small"}),color:"success.main",bgcolor:"rgba(46, 125, 50, 0.1)",borderColor:"rgba(46, 125, 50, 0.2)"};case"cancelled":return{label:"Cancelled",icon:e.jsx(te,{fontSize:"small"}),color:"error.main",bgcolor:"rgba(211, 47, 47, 0.1)",borderColor:"rgba(211, 47, 47, 0.2)"};case"returned":return{label:"Returned",icon:e.jsx(ee,{fontSize:"small"}),color:"text.primary",bgcolor:"rgba(0, 0, 0, 0.08)",borderColor:"divider"};default:return{label:"Completed",icon:e.jsx(Ke,{fontSize:"small"}),color:"text.secondary",bgcolor:"action.hover",borderColor:"divider"}}},L=(r,t)=>{try{const n=S(f,"orders",r);T(n,{status:t}),b()}catch(n){console.error("Error updating order status:",n),alert("Failed to update order status = "+r)}},je=async()=>{if(F)try{const r=S(f,"orders",F);await re(r),w(!1),U(null),alert("Order deleted successfully"),b()}catch(r){console.error("Error deleting order:",r),alert("Failed to delete order")}},Ce=r=>{U(r),w(!0)},Se=r=>{if(!r)return"Just now";const t=r.toDate(),o=new Date().getTime()-t.getTime(),l=Math.floor(o/(1e3*60*60*24));return l===0?`Today, ${t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:l===1?`Yesterday, ${t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},ve=r=>{ue(A===r?null:r)},we=r=>{const t=M.find(n=>n.id===r);Me(t)},ke=r=>{he(r),$(!0)},De=async r=>{if(x)try{const t=_e(r,x.manualAddons,x.deliveryAmount),n=r.every(c=>(c.returnedQuantity||0)>=c.quantity),o={...t,items:r};n&&(o.status="Returned");const l=S(f,"orders",x.id);await T(l,o);try{for(let c=0;c<r.length;c++){const m=r[c],B=x.items[c],W=m.returnedQuantity||0,Re=B.returnedQuantity||0,Q=W-Re;if(Q>0){const V=S(f,"products",String(m.id)),X=await qe(V);if(X.exists()){const G=X.data(),z={};if(m.selectedSize){const P=G.sizes||[],N=P.findIndex(y=>y.label===m.selectedSize.label);if(N!==-1){const y={...P[N]};y.returnStock=(y.returnStock||0)+Q,P[N]=y,z.sizes=P}}else z.returnStock=(G.returnStock||0)+Q;Object.keys(z).length>0&&await T(V,z)}}}}catch(c){console.error("Error updating return stock:",c)}alert("Return processed successfully"),b()}catch(t){throw console.error("Error processing return:",t),t}};return e.jsxs(s,{sx:{pb:10,bgcolor:"background.default",minHeight:"100vh",color:"text.primary"},children:[e.jsx(s,{sx:{position:"sticky",top:0,zIndex:1100,bgcolor:"background.default",borderBottom:1,borderColor:"divider"},children:e.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2,height:60},children:me?e.jsxs(s,{sx:{display:"flex",alignItems:"center",flex:1,gap:1},children:[e.jsx(j,{onClick:()=>{I(!1),D("")},children:e.jsx(K,{})}),e.jsx("input",{autoFocus:!0,placeholder:"Search orders...",style:{flex:1,border:"none",outline:"none",background:"transparent",fontSize:"1rem",color:"inherit"},value:k,onChange:r=>D(r.target.value)}),k&&e.jsx(j,{size:"small",onClick:()=>D(""),children:e.jsx(te,{fontSize:"small"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{sx:{ml:-1},onClick:()=>q({to:"/shop"}),children:e.jsx(K,{})}),e.jsxs(g,{variant:"h6",sx:{fontWeight:"bold"},children:["Estimate"," History"]}),e.jsx(j,{sx:{mr:-1},onClick:()=>I(!0),children:e.jsx(Ge,{})})]})})}),e.jsxs(s,{sx:{p:2},children:[e.jsx(s,{sx:{display:"flex",gap:1.5,overflowX:"auto",p:2,mb:2,"&::-webkit-scrollbar":{display:"none"},animation:`${O} 0.6s ease-out forwards`},children:fe.map(r=>e.jsx(a,{variant:d===r?"contained":"outlined",onClick:()=>de(r),sx:{flexShrink:0,borderRadius:50,textTransform:"none",fontWeight:"bold",fontSize:"0.875rem",px:3,py:1,bgcolor:d===r?"primary.main":"background.paper",color:d===r?"black":"text.secondary",borderColor:d===r?"primary.main":"divider",boxShadow:d===r?"0 4px 12px rgba(242, 215, 13, 0.2)":"none","&:hover":{bgcolor:d===r?"primary.main":"action.hover",borderColor:d===r?"primary.main":"divider"}},children:r},r))}),e.jsxs(C,{direction:"row",spacing:2,sx:{px:2,mb:2},justifyContent:"flex-end",children:[e.jsxs(a,{size:"small",variant:"outlined",color:"success",onClick:()=>J("deliver"),disabled:u.length===0,children:["Deliver All (",u.length,")"]}),e.jsxs(a,{size:"small",variant:"outlined",color:"error",onClick:()=>J("delete"),disabled:u.length===0,children:["Delete All (",u.length,")"]})]}),ce?e.jsx(s,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(Oe,{})}):u.length===0?e.jsx(s,{sx:{textAlign:"center",py:8,animation:`${O} 0.6s ease-out forwards`},children:e.jsx(g,{color:"text.secondary",children:"No orders found."})}):e.jsx(s,{sx:{width:"100%",animation:`${O} 0.6s ease-out forwards`,animationDelay:"0.1s"},children:e.jsx(Je,{useWindowScroll:!0,increaseViewportBy:300,data:u,itemContent:(r,t)=>{const n=ye(t.status);return e.jsx(s,{sx:{pb:2},children:e.jsx(Ae,{sx:{p:2,borderRadius:3,border:1,borderColor:"divider",boxShadow:"none",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",transition:"all 0.2s","&:active":{transform:"scale(0.98)"}},onClick:()=>ve(t.id),children:e.jsxs(s,{sx:{width:"100%"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Ie,{sx:{width:48,height:48,bgcolor:n.bgcolor,color:n.color,border:1,borderColor:n.borderColor},children:n.icon}),e.jsxs(s,{children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(g,{variant:"body2",sx:{fontWeight:"bold"},children:["#",t.id.slice(0,5).toUpperCase()]}),t.items?.some(o=>(o.returnedQuantity||0)>0)&&e.jsx(s,{sx:{px:.75,py:.25,borderRadius:1,bgcolor:t.items.every(o=>(o.returnedQuantity||0)>=o.quantity)?"error.main":"warning.main",color:"white",fontSize:"0.65rem",fontWeight:"bold",lineHeight:1},children:t.items.every(o=>(o.returnedQuantity||0)>=o.quantity)?"RETURNED":"PARTIAL"})]}),e.jsx(g,{variant:"caption",sx:{color:"text.secondary",mt:.5,display:"block"},children:Se(t.timestamp)})]})]}),e.jsxs(s,{sx:{textAlign:"right",display:"flex",alignItems:"center",gap:1},children:[e.jsxs(s,{children:[e.jsxs(g,{variant:"body2",sx:{fontWeight:"bold"},children:["â‚¹",t.total.toLocaleString()]}),e.jsx(s,{sx:{display:"inline-block",mt:.5,px:1.5,py:.25,borderRadius:10,bgcolor:n.bgcolor,color:n.color,fontSize:"0.625rem",fontWeight:"bold",textTransform:"uppercase",letterSpacing:.5},children:n.label})]}),e.jsx(j,{size:"small",sx:{transform:A===t.id?"rotate(180deg)":"none",transition:"transform 0.3s"},children:e.jsx(Z,{})})]})]}),e.jsxs(Ee,{in:A===t.id,timeout:"auto",unmountOnExit:!0,children:[e.jsx(s,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:e.jsx(Ue,{order:t})}),e.jsx(s,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:e.jsx(a,{size:"small",variant:"outlined",color:"error",onClick:o=>{o.stopPropagation(),Ce(t.id)},children:"Delete"})}),e.jsx(s,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:e.jsx($e,{shippingDetails:t.shippingDetails||{}})}),e.jsxs(s,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:[e.jsxs(g,{variant:"caption",sx:{fontWeight:"bold",color:"text.secondary",mb:1.5,display:"block",textTransform:"uppercase",letterSpacing:.5},children:["Estimate"," Items"]}),e.jsx(C,{spacing:2,children:t.items?.map((o,l)=>e.jsx(Fe,{item:o},l))}),e.jsxs(C,{direction:"row",spacing:1,sx:{mt:2},children:[e.jsx(a,{size:"small",variant:"outlined",color:"success",onClick:o=>{o.stopPropagation(),L(t.id,"Delivered")},children:"Delivered"}),e.jsx(a,{size:"small",variant:"outlined",color:"error",onClick:o=>{o.stopPropagation(),L(t.id,"Cancelled")},children:"Cancelled"}),e.jsx(a,{size:"small",variant:"outlined",color:"warning",onClick:o=>{o.stopPropagation(),L(t.id,"pending")},children:"Processing"})]})]}),e.jsx(s,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:e.jsxs(C,{direction:"row",spacing:1,sx:{mt:2},justifyContent:"space-between",children:[e.jsx(a,{size:"small",variant:"contained",color:"success",onClick:o=>{o.stopPropagation(),we(t.id)},children:"Print"}),e.jsx(s,{onClick:o=>o.stopPropagation(),children:e.jsx(He,{order:t})}),e.jsx(C,{direction:"row",spacing:1,children:e.jsx(a,{size:"small",variant:"outlined",color:"warning",startIcon:e.jsx(ee,{}),onClick:o=>{o.stopPropagation(),ke(t)},children:"Return"})})]})})]})]})},t.id)})}})}),e.jsx(s,{sx:{mt:4,textAlign:"center",animation:`${O} 0.6s ease-out forwards`,animationDelay:"0.3s"},children:e.jsx(a,{size:"small",endIcon:e.jsx(Z,{}),sx:{color:"primary.main",fontWeight:"bold",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:1,"&:hover":{bgcolor:"transparent",color:"primary.dark"}},children:"Load More"})})]}),e.jsxs(oe,{open:pe,onClose:()=>w(!1),PaperProps:{sx:{borderRadius:3,p:1}},children:[e.jsxs(se,{sx:{fontWeight:"bold"},children:["Delete ","Estimate","?"]}),e.jsx(ne,{children:e.jsx(ae,{children:"Are you sure you want to delete this order? This action is permanent and cannot be undone."})}),e.jsxs(ie,{sx:{p:2},children:[e.jsx(a,{onClick:()=>w(!1),color:"inherit",sx:{fontWeight:"bold"},children:"Cancel"}),e.jsx(a,{onClick:je,variant:"contained",color:"error",sx:{fontWeight:"bold",borderRadius:2},children:"Delete"})]})]}),e.jsxs(oe,{open:ge,onClose:()=>R(!1),PaperProps:{sx:{borderRadius:3,p:1}},children:[e.jsxs(se,{sx:{fontWeight:"bold"},children:["Confirm Bulk ",h==="deliver"?"Delivery":"Deletion"]}),e.jsxs(ne,{children:[e.jsxs(ae,{sx:{mb:2},children:["Please enter your phone number to confirm this bulk action.",e.jsx("br",{}),e.jsxs("strong",{children:["This will affect ",u.length," orders."]})]}),e.jsx("input",{type:"tel",placeholder:"Enter your phone number",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ccc",fontSize:"1rem",outline:"none"},value:Y,onChange:r=>E(r.target.value)})]}),e.jsxs(ie,{sx:{p:2},children:[e.jsx(a,{onClick:()=>R(!1),color:"inherit",sx:{fontWeight:"bold"},children:"Cancel"}),e.jsxs(a,{onClick:be,variant:"contained",color:h==="delete"?"error":"primary",sx:{fontWeight:"bold",borderRadius:2},children:["Confirm ",h==="deliver"?"Delivery":"Deletion"]})]})]}),e.jsx(Ye,{open:xe,onClose:()=>$(!1),order:x,onSave:De})]})}export{kr as component};
