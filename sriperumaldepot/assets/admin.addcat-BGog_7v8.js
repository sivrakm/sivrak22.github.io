import{r as a,j as e,C as H,O as J,P as V,Q as X,S as Y}from"./index-DPMeJsKZ.js";import{u as Z,A as ee,T as re,a as te}from"./productStore-DhwU9xUm.js";import{n as h,C as w,A as se,a as oe,I as P,P as ie,S as A,N as ae,E as ne,b as le}from"./index.browser-BfXix5Go.js";import{B as t,T as s,a as f,P as v}from"./Button-BIX3GRht.js";import{I as g}from"./IconButton-Hw8WbtNh.js";import{S as l,E as ce}from"./ExpandMore-u8U1fPbH.js";import{C as de}from"./Collapse-D-Jz6uJz.js";import{T as m,I as T}from"./TextField-CD6hLXiF.js";import{S as he}from"./Search-CwIN95I4.js";import{D as xe}from"./Delete-F0Bw7Obd.js";import{D as ge}from"./Dialog-BB6swBfO.js";import{D as me,a as pe,b as ue,c as fe}from"./DialogTitle-DhoSV6bE.js";import"./useThemeProps-8uCsiUgR.js";import"./SwitchBase-Cbn3LxlV.js";import"./Select-C2isiBkS.js";import"./isMuiElement-B1MDafNB.js";import"./Modal-CXJJcq9R.js";function Ne(){const{pushCategorytoDb:E,updateCategory:z,deleteCategory:N,categoryItems:U,fetchProducts:j}=Z();a.useState(()=>{j()});const[x,I]=a.useState(null),[b,y]=a.useState(!1),[F,p]=a.useState(!1),[S,k]=a.useState(null),[C,B]=a.useState(""),[i,u]=a.useState({name:"",sku:"",id:h(),imgRefId:h(),category:"",detail:"",price:0,originalPrice:0,icon:"fitness_center",imageColor:"black",src:"",sale:!1,isNew:!0,sizes:[],categoryOnly:!0}),c=(r,o)=>{u(n=>({...n,[r]:o}))},[O,D]=a.useState(!1),R=a.useRef(null),L=async r=>{const o=r.target.files?.[0];if(o){D(!0);try{const n=J(V,`categories/${h()}_${o.name}`),d={customMetadata:{imgRefId:String(i.imgRefId),categoryName:String(i.name||"unnamed")}},$=await X(n,o,d),q=await Y($.ref);u(G=>({...G,src:q}))}catch(n){console.error("Error uploading image: ",n),alert("Failed to upload image.")}finally{D(!1)}}},K=async()=>{try{const r=Object.entries(i).reduce((o,[n,d])=>(d!==void 0&&(typeof d=="string"?o[n]=d.trim():o[n]=d),o),{});if(r.category=r.name,console.log("Saving category...",r),!r.name||!r.detail){alert("Please fill all details");return}x?(await z(r),alert("Category updated successfully!")):(await E(r),alert("Category saved successfully!")),await j(),W()}catch(r){console.error("Error saving category:",r),alert("Failed to save category")}},M=r=>{u({...r,categoryOnly:!0,imgRefId:r.imgRefId||h()}),I(r.id),y(!0),window.scrollTo({top:0,behavior:"smooth"})},Q=r=>{k(r),p(!0)},_=async()=>{S&&(await N(S),await j(),p(!1),k(null))},W=()=>{u({name:"",sku:"",id:h(),imgRefId:h(),category:"",detail:"",price:0,originalPrice:0,icon:"fitness_center",imageColor:"black",src:"",sale:!1,isNew:!0,sizes:[],categoryOnly:!0}),I(null),y(!1),window.scrollTo({top:0,behavior:"smooth"})};return e.jsxs(t,{sx:{minHeight:"100vh",bgcolor:"background.default",pb:10},children:[e.jsx(ee,{position:"sticky",color:"default",elevation:0,sx:{bgcolor:"background.paper",borderBottom:1,borderColor:"divider"},children:e.jsxs(re,{children:[e.jsx(g,{onClick:()=>window.history.back(),edge:"start",children:e.jsx(te,{})}),e.jsx(s,{variant:"h6",component:"h1",sx:{flexGrow:1,textAlign:"center",pr:5,fontWeight:"bold"},children:x?"Edit Category":"Add Category"}),x&&e.jsx(f,{color:"inherit",onClick:W,children:"Cancel Edit"})]})}),e.jsx(w,{maxWidth:"sm",sx:{py:3,display:"flex",flexDirection:"column",gap:3},children:e.jsxs(t,{sx:{border:1,borderColor:"divider",borderRadius:3,overflow:"hidden",bgcolor:"background.paper"},children:[e.jsxs(t,{onClick:()=>y(!b),sx:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",p:2,bgcolor:"action.hover",transition:"background-color 0.2s","&:hover":{bgcolor:"action.selected"}},children:[e.jsxs(l,{direction:"row",spacing:1.5,alignItems:"center",children:[e.jsx(se,{color:"primary"}),e.jsx(s,{variant:"subtitle1",sx:{fontWeight:"bold"},children:x?"Edit Category Details":"Add New Category"})]}),e.jsx(g,{size:"small",sx:{transform:b?"rotate(180deg)":"none",transition:"transform 0.3s"},children:e.jsx(ce,{})})]}),e.jsx(de,{in:b,children:e.jsxs(t,{sx:{p:2,display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(t,{children:[e.jsx(s,{variant:"subtitle2",sx:{mb:1,fontWeight:"bold",textTransform:"uppercase"},children:"Category Image"}),e.jsx(m,{fullWidth:!0,placeholder:"Paste image URL or upload...",value:i.src??"",onChange:r=>c("src",r.target.value),InputProps:{endAdornment:e.jsxs(T,{position:"end",children:[e.jsx(g,{onClick:()=>R.current?.click(),edge:"end",children:O?e.jsx(H,{size:24}):e.jsx(oe,{color:"primary"})}),e.jsx("input",{type:"file",hidden:!0,ref:R,accept:"image/*",onChange:L})]}),sx:{borderRadius:3}}}),e.jsx(t,{sx:{mt:2,height:160,borderRadius:3,border:"2px dashed",borderColor:"divider",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",bgcolor:"action.hover"},children:i.src?e.jsx(t,{component:"img",src:i.src,sx:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsxs(e.Fragment,{children:[e.jsx(P,{sx:{fontSize:40,opacity:.5,mb:1}}),e.jsx(s,{variant:"caption",sx:{opacity:.7},children:"Image preview will appear here"})]})})]}),e.jsxs(l,{spacing:2,children:[e.jsxs(l,{direction:"row",spacing:2,children:[e.jsxs(t,{flex:1,children:[e.jsx(s,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Category Name"}),e.jsx(m,{fullWidth:!0,placeholder:"Category Label",value:i.name??"",onChange:r=>{c("name",r.target.value),c("category",r.target.value)}})]}),e.jsxs(t,{width:140,children:[e.jsx(s,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"SKU ID"}),e.jsx(m,{fullWidth:!0,placeholder:"CAT-001",value:i.sku??"",onChange:r=>c("sku",r.target.value)})]})]}),e.jsxs(t,{children:[e.jsx(s,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Detail"}),e.jsx(m,{fullWidth:!0,multiline:!0,minRows:3,placeholder:"Describe the category features...",value:i.detail??"",onChange:r=>c("detail",r.target.value)})]})]}),e.jsx(t,{sx:{my:1,borderTop:1,borderColor:"divider",borderStyle:"dashed"}}),e.jsxs(v,{variant:"outlined",sx:{borderRadius:3,overflow:"hidden"},children:[e.jsxs(t,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px dashed",borderColor:"divider"},children:[e.jsxs(l,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(t,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"primary.light",color:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ie,{fontSize:"small"})}),e.jsx(s,{fontWeight:500,children:"On Sale"})]}),e.jsx(A,{checked:i.sale??!1,onChange:r=>c("sale",r.target.checked)})]}),e.jsxs(t,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(l,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(t,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"primary.light",color:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ae,{fontSize:"small"})}),e.jsx(s,{fontWeight:500,children:"New Arrival"})]}),e.jsx(A,{checked:i.isNew??!0,onChange:r=>c("isNew",r.target.checked)})]})]})]})})]})}),e.jsx(w,{maxWidth:"sm",sx:{pb:10},children:e.jsxs(t,{sx:{mt:4},children:[e.jsx(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:e.jsx(s,{variant:"h6",sx:{fontWeight:"bold"},children:"Manage Categories"})}),e.jsx(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:e.jsx(m,{size:"small",placeholder:"Search name or SKU...",value:C,onChange:r=>B(r.target.value),InputProps:{startAdornment:e.jsx(T,{position:"start",children:e.jsx(he,{fontSize:"small",sx:{opacity:.5}})}),sx:{borderRadius:2,bgcolor:"background.paper"}},sx:{width:"100%"}})}),e.jsx(l,{spacing:2,children:U.filter(r=>{if(!C)return!0;const o=C.toLowerCase();return r.name.toLowerCase().includes(o)||r.sku&&r.sku.toLowerCase().includes(o)}).map(r=>e.jsx(v,{variant:"outlined",sx:{p:2,borderRadius:2},children:e.jsxs(l,{direction:"row",spacing:2,alignItems:"center",children:[r.src?e.jsx(t,{component:"img",src:r.src,sx:{width:60,height:60,objectFit:"cover",borderRadius:2,bgcolor:"action.hover"}}):e.jsx(t,{sx:{width:60,height:60,borderRadius:2,bgcolor:"action.hover",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(P,{sx:{opacity:.3}})}),e.jsxs(t,{flex:1,children:[e.jsx(s,{fontWeight:600,children:r.name}),e.jsx(l,{direction:"row",spacing:1,alignItems:"center",children:e.jsx(s,{variant:"caption",color:"text.secondary",children:r.detail})}),r.sku&&e.jsxs(s,{variant:"caption",color:"text.secondary",children:["SKU: ",r.sku]})]}),e.jsx(g,{size:"small",onClick:()=>M(r),children:e.jsx(ne,{})}),e.jsx(g,{size:"small",color:"error",onClick:()=>Q(r.id),children:e.jsx(xe,{})})]})},r.id))})]})}),e.jsx(v,{sx:{position:"fixed",bottom:0,left:0,right:0,p:2,bgcolor:"background.paper",borderTop:1,borderColor:"divider",zIndex:10},elevation:4,children:e.jsx(w,{maxWidth:"sm",children:e.jsx(f,{fullWidth:!0,variant:"contained",size:"large",startIcon:e.jsx(le,{}),onClick:K,sx:{height:56,borderRadius:3,fontSize:"1.1rem",fontWeight:"bold",boxShadow:2},children:x?"Update Category":"Save Category"})})}),e.jsxs(ge,{open:F,onClose:()=>p(!1),PaperProps:{sx:{borderRadius:3,p:1}},children:[e.jsx(me,{sx:{fontWeight:"bold"},children:"Delete Category?"}),e.jsx(pe,{children:e.jsx(ue,{children:"Are you sure you want to delete this category? This action is permanent and cannot be undone."})}),e.jsxs(fe,{sx:{p:2},children:[e.jsx(f,{onClick:()=>p(!1),color:"inherit",sx:{fontWeight:"bold"},children:"Cancel"}),e.jsx(f,{onClick:_,variant:"contained",color:"error",sx:{fontWeight:"bold",borderRadius:2},children:"Delete"})]})]})]})}export{Ne as component};
