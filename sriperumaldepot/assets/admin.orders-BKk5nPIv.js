import{a as $,u as M,r as c,j as e,C as q,x as H,y as b,A as U,D as Y,E as J,z as X,L as k,M as G,N as K}from"./index-D8P3JBa-.js";import{p as Q}from"./printInvoice-jRRD6ymd.js";import{O as V}from"./OrderItem-X9zbRrEB.js";import{B as o,T as n,a}from"./Button-dvIA4wQD.js";import{I as f}from"./IconButton-uPyCecuf.js";import{A as Z}from"./ArrowBack-tQtRsbO0.js";import{S as _}from"./Search-BN3bWMdU.js";import{S as x}from"./Stack-D2lsGIlM.js";import{C as ee}from"./Card-3zE3o1o9.js";import{A as re}from"./Avatar-CavcAH73.js";import{E as T}from"./ExpandMore-C275GaZ4.js";import{C as te}from"./Collapse-PFCyXs2F.js";import{D as oe}from"./Dialog-CVho0_dj.js";import{D as se,a as ne,b as ie}from"./DialogTitle-D1enqnUO.js";import{D as ae}from"./DialogContentText-CMhA5VeV.js";import{C as le}from"./CheckCircle-CkQjL-V9.js";import{C as ce,I as de,H as pe}from"./Inventory2-Dhrd-npd.js";import{L as xe}from"./LocalShipping-B_-hRtAA.js";import"./ShoppingCart-B8XIcZ2F.js";import"./useThemeProps-XXHDDOu8.js";import"./Modal-DrnKYS8Q.js";const m=X`
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
`;function Le(){const w=$(),j=M(r=>r.user),[y,A]=c.useState([]),[I,C]=c.useState(!0),[i,O]=c.useState("All"),[h,z]=c.useState(null),[W,p]=c.useState(!1),[v,S]=c.useState(null),F=["All","Processing","Delivered","Cancelled"],g=async()=>{if(!j){C(!1);return}try{const r=H(b,"orders"),t=U(r,Y("timestamp","desc")),l=(await J(t)).docs.map(d=>({id:d.id,...d.data()}));A(l)}catch(r){console.error("Error fetching orders:",r)}finally{C(!1)}};c.useEffect(()=>{g()},[j]);const D=y.filter(r=>i==="All"?!0:(r.status==="pending"?"Processing":r.status).toLowerCase()===i.toLowerCase()),L=r=>{switch(r.toLowerCase()){case"pending":case"processing":return{label:"Processing",icon:e.jsx(pe,{fontSize:"small"}),color:"warning.main",bgcolor:"rgba(237, 108, 2, 0.1)",borderColor:"rgba(237, 108, 2, 0.2)"};case"shipped":return{label:"Shipped",icon:e.jsx(xe,{fontSize:"small"}),color:"info.main",bgcolor:"rgba(2, 136, 209, 0.1)",borderColor:"rgba(2, 136, 209, 0.2)"};case"delivered":return{label:"Delivered",icon:e.jsx(de,{fontSize:"small"}),color:"success.main",bgcolor:"rgba(46, 125, 50, 0.1)",borderColor:"rgba(46, 125, 50, 0.2)"};case"cancelled":return{label:"Cancelled",icon:e.jsx(ce,{fontSize:"small"}),color:"error.main",bgcolor:"rgba(211, 47, 47, 0.1)",borderColor:"rgba(211, 47, 47, 0.2)"};default:return{label:"Completed",icon:e.jsx(le,{fontSize:"small"}),color:"text.secondary",bgcolor:"action.hover",borderColor:"divider"}}},u=(r,t)=>{try{const s=k(b,"orders",r);G(s,{status:t}),g()}catch(s){console.error("Error updating order status:",s),alert("Failed to update order status = "+r)}},E=async()=>{if(v)try{const r=k(b,"orders",v);await K(r),p(!1),S(null),alert("Order deleted successfully"),g()}catch(r){console.error("Error deleting order:",r),alert("Failed to delete order")}},P=r=>{S(r),p(!0)},R=r=>{if(!r)return"Just now";const t=r.toDate(),l=new Date().getTime()-t.getTime(),d=Math.floor(l/(1e3*60*60*24));return d===0?`Today, ${t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:d===1?`Yesterday, ${t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},N=r=>{z(h===r?null:r)},B=r=>{const t=y.find(s=>s.id===r);Q(t)};return e.jsxs(o,{sx:{pb:10,bgcolor:"background.default",minHeight:"100vh",color:"text.primary"},children:[e.jsx(o,{sx:{position:"sticky",top:0,zIndex:1100,bgcolor:"background.default",borderBottom:1,borderColor:"divider"},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2,height:60},children:[e.jsx(f,{sx:{ml:-1},onClick:()=>w({to:"/shop"}),children:e.jsx(Z,{})}),e.jsx(n,{variant:"h6",sx:{fontWeight:"bold"},children:"Order History"}),e.jsx(f,{sx:{mr:-1},children:e.jsx(_,{})})]})}),e.jsxs(o,{sx:{p:2},children:[e.jsx(o,{sx:{display:"flex",gap:1.5,overflowX:"auto",p:2,mb:2,"&::-webkit-scrollbar":{display:"none"},animation:`${m} 0.6s ease-out forwards`},children:F.map(r=>e.jsx(a,{variant:i===r?"contained":"outlined",onClick:()=>O(r),sx:{flexShrink:0,borderRadius:50,textTransform:"none",fontWeight:"bold",fontSize:"0.875rem",px:3,py:1,bgcolor:i===r?"primary.main":"background.paper",color:i===r?"black":"text.secondary",borderColor:i===r?"primary.main":"divider",boxShadow:i===r?"0 4px 12px rgba(242, 215, 13, 0.2)":"none","&:hover":{bgcolor:i===r?"primary.main":"action.hover",borderColor:i===r?"primary.main":"divider"}},children:r},r))}),I?e.jsx(o,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(q,{})}):D.length===0?e.jsx(o,{sx:{textAlign:"center",py:8,animation:`${m} 0.6s ease-out forwards`},children:e.jsx(n,{color:"text.secondary",children:"No orders found."})}):e.jsx(x,{spacing:2,sx:{animation:`${m} 0.6s ease-out forwards`,animationDelay:"0.1s"},children:D.map(r=>{const t=L(r.status);return e.jsx(ee,{sx:{p:2,borderRadius:3,border:1,borderColor:"divider",boxShadow:"none",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",transition:"all 0.2s","&:active":{transform:"scale(0.98)"}},onClick:()=>N(r.id),children:e.jsxs(o,{sx:{width:"100%"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(re,{sx:{width:48,height:48,bgcolor:t.bgcolor,color:t.color,border:1,borderColor:t.borderColor},children:t.icon}),e.jsxs(o,{children:[e.jsxs(n,{variant:"body2",sx:{fontWeight:"bold"},children:["Order #",r.id.slice(0,5).toUpperCase()]}),e.jsx(n,{variant:"caption",sx:{color:"text.secondary",mt:.5,display:"block"},children:R(r.timestamp)})]})]}),e.jsxs(o,{sx:{textAlign:"right",display:"flex",alignItems:"center",gap:1},children:[e.jsxs(o,{children:[e.jsxs(n,{variant:"body2",sx:{fontWeight:"bold"},children:["₹",r.total.toLocaleString()]}),e.jsx(o,{sx:{display:"inline-block",mt:.5,px:1.5,py:.25,borderRadius:10,bgcolor:t.bgcolor,color:t.color,fontSize:"0.625rem",fontWeight:"bold",textTransform:"uppercase",letterSpacing:.5},children:t.label})]}),e.jsx(f,{size:"small",sx:{transform:h===r.id?"rotate(180deg)":"none",transition:"transform 0.3s"},children:e.jsx(T,{})})]})]}),e.jsxs(te,{in:h===r.id,timeout:"auto",unmountOnExit:!0,children:[e.jsxs(o,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:[e.jsx(n,{variant:"caption",sx:{fontWeight:"bold",color:"text.secondary",mb:1.5,display:"block",textTransform:"uppercase",letterSpacing:.5},children:"Details"}),e.jsxs(n,{variant:"caption",sx:{fontWeight:"bold",color:"text.primary",mb:1.5,display:"block",textTransform:"uppercase",letterSpacing:.5},children:[r?.timestamp>0&&e.jsxs(e.Fragment,{children:["Time stamp : ",r?.timestamp?.toDate().toLocaleString()," ",e.jsx("br",{})]}),r.total>0&&e.jsxs(e.Fragment,{children:["Total : ₹",r.total," ",e.jsx("br",{})]}),r.subtotal>0&&e.jsxs(e.Fragment,{children:["Subtotal : ₹",r.subtotal?.toFixed(2)," ",e.jsx("br",{})]}),r.tax>0&&e.jsxs(e.Fragment,{children:["Tax : ₹",r.tax?.toFixed(2)," ",e.jsx("br",{})]}),r.itemAddons>0&&e.jsxs(e.Fragment,{children:["Item Addons : ₹",r.itemAddons?.toFixed(2)," ",e.jsx("br",{})]}),r.manualAddons?.map((s,l)=>e.jsxs("span",{children:[s.label," : ",s.amount<0?"-":"","₹",Math.abs(s.amount).toFixed(2)," ",e.jsx("br",{})]},l)),!r.itemAddons&&!r.manualAddons&&r.addons>0&&e.jsxs(e.Fragment,{children:["Addons : ₹",r.addons?.toFixed(2),e.jsx("br",{})]}),r.deliveryAmount>0&&e.jsxs(e.Fragment,{children:["Delivery : ₹",r.deliveryAmount?.toFixed(2),e.jsx("br",{})]})]})]}),e.jsxs(o,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:[e.jsx(n,{variant:"caption",sx:{fontWeight:"bold",color:"text.secondary",mb:1.5,display:"block",textTransform:"uppercase",letterSpacing:.5},children:"Phone Number"}),e.jsx(n,{variant:"caption",sx:{fontWeight:"bold",color:"text.primary",mb:1.5,display:"block",textTransform:"uppercase",letterSpacing:.5},children:r.shippingDetails?.phoneNumber}),e.jsx(n,{variant:"caption",sx:{fontWeight:"bold",color:"text.secondary",mb:1.5,display:"block",textTransform:"uppercase",letterSpacing:.5},children:"Shipping Details"}),e.jsxs(n,{variant:"caption",sx:{fontWeight:"bold",color:"text.primary",mb:1.5,display:"block",textTransform:"uppercase",letterSpacing:.5},children:["Name: ",r.shippingDetails?.firstName,",",r.shippingDetails?.orgName]}),e.jsxs(n,{variant:"caption",sx:{fontWeight:"bold",color:"text.primary",mb:1.5,display:"block",textTransform:"uppercase",letterSpacing:.5},children:["Address: ",r.shippingDetails?.address,", ",r.shippingDetails?.city,", ",r.shippingDetails?.zip,", ",r.shippingDetails?.orgName]})]}),e.jsxs(o,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:[e.jsx(n,{variant:"caption",sx:{fontWeight:"bold",color:"text.secondary",mb:1.5,display:"block",textTransform:"uppercase",letterSpacing:.5},children:"Order Items"}),e.jsx(x,{spacing:2,children:r.items?.map((s,l)=>e.jsx(V,{item:s},l))}),e.jsxs(x,{direction:"row",spacing:1,sx:{mt:2},children:[e.jsx(a,{size:"small",variant:"outlined",color:"success",onClick:()=>u(r.id,"Delivered"),children:"Delivered"}),e.jsx(a,{size:"small",variant:"outlined",color:"error",onClick:()=>u(r.id,"Cancelled"),children:"Cancelled"}),e.jsx(a,{size:"small",variant:"outlined",color:"error",onClick:()=>u(r.id,"pending"),children:"Processing"})]})]}),e.jsx(o,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:e.jsxs(x,{direction:"row",spacing:1,sx:{mt:2},justifyContent:"space-between",children:[e.jsx(a,{size:"small",variant:"contained",color:"success",onClick:()=>B(r.id),children:"Print Invoice"}),e.jsx(a,{size:"small",variant:"outlined",color:"error",onClick:()=>P(r.id),children:"Delete Order"})]})})]})]})},r.id)})}),e.jsx(o,{sx:{mt:4,textAlign:"center",animation:`${m} 0.6s ease-out forwards`,animationDelay:"0.3s"},children:e.jsx(a,{size:"small",endIcon:e.jsx(T,{}),sx:{color:"primary.main",fontWeight:"bold",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:1,"&:hover":{bgcolor:"transparent",color:"primary.dark"}},children:"Load More"})})]}),e.jsxs(oe,{open:W,onClose:()=>p(!1),PaperProps:{sx:{borderRadius:3,p:1}},children:[e.jsx(se,{sx:{fontWeight:"bold"},children:"Delete Order?"}),e.jsx(ne,{children:e.jsx(ae,{children:"Are you sure you want to delete this order? This action is permanent and cannot be undone."})}),e.jsxs(ie,{sx:{p:2},children:[e.jsx(a,{onClick:()=>p(!1),color:"inherit",sx:{fontWeight:"bold"},children:"Cancel"}),e.jsx(a,{onClick:E,variant:"contained",color:"error",sx:{fontWeight:"bold",borderRadius:2},children:"Delete"})]})]})]})}export{Le as component};
