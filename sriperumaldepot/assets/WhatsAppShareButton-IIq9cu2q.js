import{H as F,J as T,r as x,K as L,j as a,M as P,N as A,P as N,f as O,aa as V,Q as H,a1 as tt,O as w,U as B,c as ot,a0 as et,B as C,h as v,S as st}from"./index-Cp2I37WV.js";import{Q as at}from"./QuantitySelector-Bx9V5BIG.js";import{D as rt,a as nt,b as it}from"./DialogTitle-C1XPoAzT.js";import{a as J,f as lt,c as ct,u as ut}from"./TextField-DFh5Z3SN.js";import{F as W}from"./ListItemAvatar-BVgMZjQw.js";import{S as dt}from"./SwitchBase-CJSetpRX.js";import{C as pt}from"./Checkbox-ByfKq9bR.js";import{D as ft}from"./DialogActions-B-je9ZVc.js";import{B as Q}from"./Button-BhddC0uT.js";import{W as mt}from"./WhatsApp-BHlUL3bd.js";function ht(t){return F("MuiFormGroup",t)}T("MuiFormGroup",["root","row","error"]);const xt=t=>{const{classes:s,row:i,error:n}=t;return N({root:["root",i&&"row",n&&"error"]},ht,s)},yt=P("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:i}=t;return[s.root,i.row&&s.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),gt=x.forwardRef(function(s,i){const n=L({props:s,name:"MuiFormGroup"}),{className:u,row:y=!1,...p}=n,f=J(),h=lt({props:n,muiFormControl:f,states:["error"]}),b={...n,row:y,error:h.error},m=xt(b);return a.jsx(yt,{className:A(m.root,u),ownerState:b,ref:i,...p})}),bt=O(a.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),Rt=O(a.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"})),St=P("span",{name:"MuiRadioButtonIcon",shouldForwardProp:V})({position:"relative",display:"flex"}),vt=P(bt,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),Ct=P(Rt,{name:"MuiRadioButtonIcon"})(H(({theme:t})=>({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}}]})));function K(t){const{checked:s=!1,classes:i={},fontSize:n}=t,u={...t,checked:s};return a.jsxs(St,{className:i.root,ownerState:u,children:[a.jsx(vt,{fontSize:n,className:i.background,ownerState:u}),a.jsx(Ct,{fontSize:n,className:i.dot,ownerState:u})]})}const Y=x.createContext(void 0);function jt(){return x.useContext(Y)}function Pt(t){return F("MuiRadio",t)}const q=T("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),wt=t=>{const{classes:s,color:i,size:n}=t,u={root:["root",`color${w(i)}`,n!=="medium"&&`size${w(n)}`]};return{...s,...N(u,Pt,s)}},$t=P(dt,{shouldForwardProp:t=>V(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:i}=t;return[s.root,i.size!=="medium"&&s[`size${w(i.size)}`],s[`color${w(i.color)}`]]}})(H(({theme:t})=>({color:(t.vars||t).palette.text.secondary,[`&.${q.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.alpha((t.vars||t).palette.action.active,(t.vars||t).palette.action.hoverOpacity)}}},...Object.entries(t.palette).filter(B()).map(([s])=>({props:{color:s,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.alpha((t.vars||t).palette[s].main,(t.vars||t).palette.action.hoverOpacity)}}})),...Object.entries(t.palette).filter(B()).map(([s])=>({props:{color:s,disabled:!1},style:{[`&.${q.checked}`]:{color:(t.vars||t).palette[s].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function It(t,s){return typeof s=="object"&&s!==null?t===s:String(t)===String(s)}const Dt=a.jsx(K,{checked:!0}),kt=a.jsx(K,{}),U=x.forwardRef(function(s,i){const n=L({props:s,name:"MuiRadio"}),{checked:u,checkedIcon:y=Dt,color:p="primary",icon:f=kt,name:h,onChange:b,size:m="medium",className:g,disabled:c,disableRipple:S=!1,slots:o={},slotProps:l={},inputProps:d,...r}=n,e=J();let R=c;e&&typeof R>"u"&&(R=e.disabled),R??=!1;const $={...n,disabled:R,disableRipple:S,color:p,size:m},G=wt($),j=jt();let I=u;const Z=ct(b,j&&j.onChange);let D=h;j&&(typeof I>"u"&&(I=It(j.value,n.value)),typeof D>"u"&&(D=j.name));const k=l.input??d,[_,X]=tt("root",{ref:i,elementType:$t,className:A(G.root,g),shouldForwardComponentProp:!0,externalForwardedProps:{slots:o,slotProps:l,...r},getSlotProps:z=>({...z,onChange:(E,...M)=>{z.onChange?.(E,...M),Z(E,...M)}}),ownerState:$,additionalProps:{type:"radio",icon:x.cloneElement(f,{fontSize:f.props.fontSize??m}),checkedIcon:x.cloneElement(y,{fontSize:y.props.fontSize??m}),disabled:R,name:D,checked:I,slots:o,slotProps:{input:typeof k=="function"?k($):k}}});return a.jsx(_,{...X,classes:G})});function Qt(t){return F("MuiRadioGroup",t)}T("MuiRadioGroup",["root","row","error"]);const Ft=t=>{const{classes:s,row:i,error:n}=t;return N({root:["root",i&&"row",n&&"error"]},Qt,s)},Tt=x.forwardRef(function(s,i){const{actions:n,children:u,className:y,defaultValue:p,name:f,onChange:h,value:b,...m}=s,g=x.useRef(null),c=Ft(s),[S,o]=ut({controlled:b,default:p,name:"RadioGroup"});x.useImperativeHandle(n,()=>({focus:()=>{let e=g.current.querySelector("input:not(:disabled):checked");e||(e=g.current.querySelector("input:not(:disabled)")),e&&e.focus()}}),[]);const l=ot(i,g),d=et(f),r=x.useMemo(()=>({name:d,onChange(e){o(e.target.value),h&&h(e,e.target.value)},value:S}),[d,h,o,S]);return a.jsx(Y.Provider,{value:r,children:a.jsx(gt,{role:"radiogroup",ref:l,className:A(c.root,y),...m,children:u})})}),Lt=({open:t,onClose:s,onSave:i,order:n})=>{const[u,y]=x.useState("full"),[p,f]=x.useState({}),[h,b]=x.useState({}),[m,g]=x.useState(!1);x.useEffect(()=>{if(t&&n?.items){y("full");const o={},l={};n.items.forEach((d,r)=>{const e=d.quantity-(d.returnedQuantity||0);o[r]=!1,l[r]=d.isComplexVariant?e:Math.min(1,e)}),f(o),b(l)}},[t,n]);const c=o=>{f(l=>({...l,[o]:!l[o]}))},S=async()=>{g(!0);try{const o=n.items.map((l,d)=>{let r=0;return u==="full"?r=l.quantity-(l.returnedQuantity||0):p[d]&&(r=h[d]||0),r>0?{...l,returnedQuantity:(l.returnedQuantity||0)+r}:l});await i(o),s()}catch(o){console.error("Error saving return:",o),alert("Failed to save return details")}finally{g(!1)}};return n?a.jsxs(rt,{open:t,onClose:s,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3}},children:[a.jsx(nt,{sx:{fontWeight:"bold"},children:"Process Return"}),a.jsxs(it,{dividers:!0,children:[a.jsxs(C,{sx:{mb:3},children:[a.jsx(v,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"RETURN TYPE"}),a.jsxs(Tt,{value:u,onChange:o=>y(o.target.value),sx:{flexDirection:"row",gap:2},children:[a.jsx(W,{value:"full",control:a.jsx(U,{}),label:a.jsx(v,{variant:"body2",sx:{fontWeight:600},children:"Full Return"})}),a.jsx(W,{value:"partial",control:a.jsx(U,{}),label:a.jsx(v,{variant:"body2",sx:{fontWeight:600},children:"Partial Return"})})]})]}),u==="partial"&&a.jsxs(C,{children:[a.jsx(v,{variant:"subtitle2",color:"text.secondary",sx:{mb:2},children:"SELECT ITEMS & QUANTITIES"}),a.jsx(st,{spacing:2,children:n.items.map((o,l)=>{const d=o.quantity-(o.returnedQuantity||0);return d<=0?null:a.jsx(C,{sx:{p:1.5,borderRadius:2,border:1,borderColor:p[l]?"primary.main":"divider",bgcolor:p[l]?"primary.main08":"transparent"},children:a.jsxs(C,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[a.jsx(pt,{checked:!!p[l],onChange:()=>c(l),size:"small"}),a.jsxs(C,{sx:{flex:1,minWidth:0},children:[a.jsx(v,{variant:"body2",sx:{fontWeight:"bold"},noWrap:!0,children:o.name}),a.jsxs(v,{variant:"caption",color:"text.secondary",children:["Available to return: ",d]})]}),o.isComplexVariant?a.jsxs(v,{variant:"body2",sx:{fontWeight:"bold",bgcolor:"action.hover",px:1.5,py:.5,borderRadius:2},children:[h[l]," ",o.unitName]}):a.jsx(at,{quantity:h[l]||1,onQuantityChange:r=>{f(e=>({...e,[l]:!0})),b(e=>({...e,[l]:r}))},min:1,max:d,compact:!0})]})},l)})})]}),u==="full"&&a.jsx(C,{sx:{py:2,textAlign:"center",bgcolor:"action.hover",borderRadius:2},children:a.jsx(v,{variant:"body2",color:"text.secondary",children:"All eligible items will be marked as fully returned."})})]}),a.jsxs(ft,{sx:{p:2.5},children:[a.jsx(Q,{onClick:s,color:"inherit",sx:{fontWeight:"bold"},children:"Cancel"}),a.jsx(Q,{onClick:S,variant:"contained",color:"primary",disabled:m||u==="partial"&&!Object.values(p).some(o=>o),sx:{fontWeight:"bold",borderRadius:2,px:3},children:m?"Processing...":"Confirm Return"})]})]}):null},Ot=(t,s=[],i=0)=>{const n=r=>r.selectedSize?.price||r.price||r.buyPrice||0,u=t.reduce((r,e)=>r+n(e)*e.quantity,0),y=t.reduce((r,e)=>r+(e.taxAmount||0)*e.quantity,0),p=t.reduce((r,e)=>r+(e.addonAmount||0)*e.quantity,0),f=t.reduce((r,e)=>{const R=e.quantity-(e.returnedQuantity||0);return r+n(e)*R},0),h=t.reduce((r,e)=>{const R=e.quantity-(e.returnedQuantity||0);return r+(e.taxAmount||0)*R},0),b=t.reduce((r,e)=>{const R=e.quantity-(e.returnedQuantity||0);return r+(e.addonAmount||0)*R},0),m=t.length>0&&f===0,g=s.reduce((r,e)=>r+e.amount,0),c=m?0:g,S=m?0:i,o=f+h+b+c+S,d=u+y+p+g+i-o;return{subtotal:u,tax:y,itemAddons:p,orderAddons:g,addons:p+g,deliveryAmount:i,total:o,returnedAmount:d,items:t}},Vt=({order:t,variant:s="outlined",color:i="success",size:n="small"})=>{const u=y=>{y.stopPropagation();const p=t.shippingDetails?.phoneNumber||"",f=window.prompt("Enter WhatsApp Number",p);if(f===null)return;const h=t.timestamp?.toDate?t.timestamp.toDate().toLocaleDateString():new Date().toLocaleDateString(),b=`${t.shippingDetails?.firstName||""} ${t.shippingDetails?.lastName||""}`.trim()||"Guest",m=`${t.shippingDetails?.address||""}, ${t.shippingDetails?.city||""} ${t.shippingDetails?.zip||""}`.replace(/^, /,"").trim();let c=`*Estimate ID:* #${t.id.slice(0,5).toUpperCase()}
`;c+=`*Date:* ${h}
`,c+=`*Status:* ${t.status}
`,c+=`--------------------------------
`,c+=`*Customer Details:*
`,c+=`Name: ${b}
`,c+=`Phone: ${t.shippingDetails?.phoneNumber||"N/A"}
`,m&&(c+=`Address: ${m}
`),c+=`--------------------------------
`,c+=`*Items:*
`,t.items.forEach((o,l)=>{const d=o.selectedSize?` (${o.selectedSize.label})`:"",r=(o.totalPrice||o.buyPrice)*o.quantity;if(c+=`${l+1}. ${o.name}${d}
`,c+=`   Qty: ${o.quantity} x ₹${(o.totalPrice||o.buyPrice).toLocaleString()} = ₹${r.toLocaleString()}
`,o.returnedQuantity&&o.returnedQuantity>0){const e=(o.totalPrice||o.buyPrice)*o.returnedQuantity;c+=`   ⚠️ RETURNED: ${o.returnedQuantity} (-₹${e.toLocaleString()})
`}}),c+=`--------------------------------
`,t.subtotal&&(c+=`Subtotal: ₹${t.subtotal.toLocaleString()}
`),t.tax&&(c+=`Tax: ₹${t.tax.toLocaleString()}
`),t.deliveryAmount&&(c+=`Delivery: ₹${t.deliveryAmount.toLocaleString()}
`),c+=`*Grand Total: ₹${t.total.toLocaleString()}*
`,c+=`--------------------------------
`,c+="Thank you for reaching out to us!";const S=`https://wa.me/${f}?text=${encodeURIComponent(c)}`;window.open(S,"_blank")};return a.jsx(Q,{size:n,variant:s,color:i,startIcon:a.jsx(mt,{}),onClick:u,children:"Share"})};export{Lt as R,Vt as W,Ot as c};
