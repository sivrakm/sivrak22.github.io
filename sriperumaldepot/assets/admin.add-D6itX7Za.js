import{f as L,j as e,r as m,B as a,I as C,h as o,S as x,E as K,k as Ie,C as Se,a0 as W,af as we,ag as Re,ah as ke,ai as Pe}from"./index-hWqqEidX.js";import{u as w}from"./productStore-CKvLnhtR.js";import{u as We}from"./pricingStore-CGBSpTbx.js";import{n as R}from"./index.browser-vcSNLBTf.js";import{Y as ze}from"./index-DL9nLGov.js";import{A as De,T as Ae,a as Ne,M as b}from"./ArrowBackIosNew-CyWJsUe0.js";import{B as v}from"./Button-BfS2zT8f.js";import{C as F,E as Te}from"./Edit-CNvoYhH3.js";import{A as q,I as Y,L as X,P as Ee,N as Fe}from"./Percent-DPtNatg5.js";import{T as c,F as Oe,h as Ve,S as Le,O as Be}from"./TextField-DwE7O7_A.js";import{I as y}from"./InputAdornment-3ODLmMsf.js";import{C as Ue}from"./CloudUpload-CVbtiE2q.js";import{G as f}from"./Grid-D7RppRjU.js";import{D as O}from"./Delete-CI7nSIiw.js";import{C as J}from"./Checkbox-DAYfLWdz.js";import{C as Z}from"./Chip-DecVCN_f.js";import{S as V}from"./Switch-CMYZeYpy.js";import{S as Me}from"./Straighten-Bmf3mVz0.js";import{S as _e}from"./Search-Dr6Tldl4.js";import{D as ee}from"./Divider-DXEa-dUJ.js";import{S as He}from"./Save-D7R6Ny4o.js";import{D as $e,a as Qe,b as Ge,c as Ke}from"./DialogTitle-BUa6KLRt.js";import{D as qe}from"./DialogContentText-D_m4JUkb.js";import{F as Ye}from"./FitnessCenter-BwZHc6gT.js";import{S as Xe}from"./ShoppingBag-C8XOgvtz.js";import"./dividerClasses-M4d4isCD.js";import"./isMuiElement-lysYTGo2.js";import"./SwitchBase-D8GW_uCT.js";const Je=L(e.jsx("path",{d:"M3 17h18v-2H3zm0 3h18v-1H3zm0-7h18v-3H3zm0-9v4h18V4z"})),Ze=L([e.jsx("path",{d:"m12 12.9-2.13 2.09c-.56.56-.87 1.29-.87 2.07C9 18.68 10.35 20 12 20s3-1.32 3-2.94c0-.78-.31-1.52-.87-2.07z"},"0"),e.jsx("path",{d:"m16 6-.44.55C14.38 8.02 12 7.19 12 5.3V2S4 6 4 13c0 2.92 1.56 5.47 3.89 6.86-.56-.79-.89-1.76-.89-2.8 0-1.32.52-2.56 1.47-3.5L12 10.1l3.53 3.47c.95.93 1.47 2.17 1.47 3.5 0 1.02-.31 1.96-.85 2.75 1.89-1.15 3.29-3.06 3.71-5.3.66-3.55-1.07-6.9-3.86-8.52"},"1")]),et=L(e.jsx("path",{d:"M20 10V8h-4V4h-2v4h-4V4H8v4H4v2h4v4H4v2h4v4h2v-4h4v4h2v-4h4v-2h-4v-4zm-6 4h-4v-4h4z"})),te=[{value:"tag",label:"Tag",icon:e.jsx(et,{})},{value:"fitness_center",label:"Dumbbell",icon:e.jsx(Ye,{})},{value:"local_fire_department",label:"Fire",icon:e.jsx(Ze,{})},{value:"shopping_bag",label:"Bag",icon:e.jsx(Xe,{})}],tt=[{value:"black",color:"#000000"},{value:"white",color:"#ffffff"},{value:"red",color:"#ef4444"},{value:"blue",color:"#3b82f6"},{value:"yellow",color:"#f2b90d"}];function zt(){const re=w(t=>t.pushProducttoDb),se=w(t=>t.updateProduct),ne=w(t=>t.products),B=w(t=>t.fetchProducts),ae=w(t=>t.deleteProduct),U=w(t=>t.categories),{rules:p,fetchRules:oe}=We();m.useState(()=>{B(),oe()});const[I,M]=m.useState(null),[ie,_]=m.useState(!1),[z,D]=m.useState(!1),[le,P]=m.useState(!1),[H,$]=m.useState(null),[A,N]=m.useState({}),[T,de]=m.useState(""),ce=t=>{N(s=>({...s,[t]:!s[t]}))},ue=t=>{const s={...A};t.forEach(n=>{s[n]=!0}),N(s)},he=()=>{N({})},Q=m.useRef(null),xe=async t=>{const s=t.target.files?.[0];if(s){_(!0);try{const n=we(Re,`products/${R()}_${s.name}`),d={customMetadata:{imgRefId:String(r.imgRefId),productName:String(r.name||"unnamed")}},S=await ke(n,s,d),g=await Pe(S.ref);j(i=>({...i,src:g}))}catch(n){console.error("Error uploading image: ",n),alert("Failed to upload image.")}finally{_(!1)}}},[r,j]=m.useState({name:"",sku:"",id:R(),imgRefId:R(),category:"",detail:"",price:void 0,icon:"fitness_center",imageColor:"black",src:"",sale:!1,isNew:!0,sizes:[],categoryOnly:!1,taxRuleId:"",addonRuleIds:[],isComplexVariant:!1,unitName:"",purchasePrice:void 0,stock:0,returnStock:0}),pe=(()=>{if(!r.taxRuleId&&(!r.addonRuleIds||r.addonRuleIds.length===0))return!1;const t=p.map(n=>n.id);return!!(r.taxRuleId&&!t.includes(r.taxRuleId)||r.addonRuleIds?.some(n=>!t.includes(n)))})(),me=()=>{const t=p.map(n=>n.id),s={...r};r.taxRuleId&&!t.includes(r.taxRuleId)&&(s.taxRuleId=""),r.addonRuleIds&&r.addonRuleIds.length>0&&(s.addonRuleIds=r.addonRuleIds.filter(n=>t.includes(n))),j(s)},u=(t,s)=>{j(n=>({...n,[t]:s}))},k=(t,s,n)=>{const d=[...r.sizes||[]];d[t]={...d[t],[s]:n},j(S=>({...S,sizes:d}))},ge=()=>{j(t=>({...t,sizes:[...t.sizes||[],{label:"",price:0,stock:0,returnStock:0,purchasePrice:0}]}))},fe=t=>{j(s=>({...s,sizes:s.sizes?.filter((n,d)=>d!==t)}))},je=t=>{j({...t,imgRefId:t.imgRefId||R()}),M(t.id),D(!0),window.scrollTo({top:0,behavior:"smooth"})},be=t=>{$(t),P(!0)},ve=async()=>{H&&(await ae(H),P(!1),$(null))},G=()=>{j({name:"",sku:"",id:R(),imgRefId:R(),category:"",detail:"",price:void 0,icon:"fitness_center",imageColor:"black",src:"",sale:!1,isNew:!0,sizes:[],categoryOnly:!1,isComplexVariant:!1,unitName:"",purchasePrice:void 0,stock:0,returnStock:0}),M(null),D(!1),window.scrollTo({top:0,behavior:"smooth"})},ye=async()=>{try{console.log("Saving product...",r);const t=Object.entries(r).reduce((s,[n,d])=>(d!==void 0&&(n==="price"||n==="purchasePrice"||n==="stock"||n==="returnStock"?d===""||d===null||isNaN(Number(d))||(s[n]=Number(d)):s[n]=d),s),{});if(!t.name){alert("Please fill in at least Name");return}I?(await se({...t,id:I}),alert("Product updated successfully!")):(await re(t),alert("Product saved successfully!")),await B(),G()}catch(t){console.error("Error saving product:",t),alert("Failed to save product")}};return e.jsxs(a,{sx:{minHeight:"100vh",bgcolor:"background.default",pb:10},children:[e.jsx(De,{position:"sticky",color:"default",elevation:0,sx:{bgcolor:"background.paper",borderBottom:1,borderColor:"divider"},children:e.jsxs(Ae,{children:[e.jsx(C,{onClick:()=>window.history.back(),edge:"start",children:e.jsx(Ne,{})}),e.jsx(o,{variant:"h6",component:"h1",sx:{flexGrow:1,textAlign:"center",pr:5,fontWeight:"bold"},children:I?"Edit Product":"Add Product"}),I&&e.jsx(v,{color:"inherit",onClick:G,children:"Cancel Edit"})]})}),e.jsx(F,{maxWidth:"sm",sx:{py:3,display:"flex",flexDirection:"column",gap:3},children:e.jsxs(a,{sx:{border:1,borderColor:"divider",borderRadius:3,overflow:"hidden",bgcolor:"background.paper"},children:[e.jsxs(a,{onClick:()=>D(!z),sx:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",p:2,bgcolor:"action.hover",transition:"background-color 0.2s","&:hover":{bgcolor:"action.selected"}},children:[e.jsxs(x,{direction:"row",spacing:1.5,alignItems:"center",children:[e.jsx(q,{color:"primary"}),e.jsx(o,{variant:"subtitle1",sx:{fontWeight:"bold"},children:I?"Edit Product Details":"Add New Product"})]}),e.jsx(C,{size:"small",sx:{transform:z?"rotate(180deg)":"none",transition:"transform 0.3s"},children:e.jsx(K,{})})]}),e.jsx(Ie,{in:z,children:e.jsxs(a,{sx:{p:2,display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(a,{children:[e.jsx(o,{variant:"subtitle2",sx:{mb:1,fontWeight:"bold",textTransform:"uppercase"},children:"Product Image"}),e.jsx(c,{fullWidth:!0,placeholder:"Paste image URL here...",value:r.src??"",onChange:t=>u("src",t.target.value),InputProps:{endAdornment:e.jsxs(y,{position:"end",children:[e.jsx(C,{onClick:()=>Q.current?.click(),edge:"end",children:ie?e.jsx(Se,{size:24}):e.jsx(Ue,{color:"primary"})}),e.jsx("input",{type:"file",hidden:!0,ref:Q,accept:"image/*",onChange:xe})]}),sx:{borderRadius:3}}}),e.jsx(a,{sx:{mt:2,height:160,borderRadius:3,border:"2px dashed",borderColor:"divider",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",bgcolor:"action.hover"},children:r.src?e.jsx(a,{component:"img",src:r.src,sx:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{sx:{fontSize:40,opacity:.5,mb:1}}),e.jsx(o,{variant:"caption",sx:{opacity:.7},children:"Image preview will appear here"})]})})]}),e.jsxs(x,{spacing:2,children:[e.jsxs(x,{direction:"row",spacing:2,children:[e.jsxs(a,{flex:1,children:[e.jsx(o,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Product Name"}),e.jsx(c,{fullWidth:!0,placeholder:"e.g. Protein Whey",value:r.name??"",onChange:t=>u("name",t.target.value)})]}),e.jsxs(a,{width:140,children:[e.jsx(o,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"SKU ID"}),e.jsx(c,{fullWidth:!0,placeholder:"PROD-001",value:r.sku||"",onChange:t=>u("sku",t.target.value)})]})]}),e.jsxs(a,{children:[e.jsx(o,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Category"}),e.jsxs(c,{select:!0,fullWidth:!0,value:r.category,onChange:t=>u("category",t.target.value),children:[e.jsx(b,{value:"",disabled:!0,children:"Select Category"}),U.filter(t=>t!=="All Items").map(t=>e.jsx(b,{value:t,children:t},t))]})]}),e.jsxs(a,{children:[e.jsx(o,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Detail"}),e.jsx(c,{fullWidth:!0,multiline:!0,minRows:3,placeholder:"Describe the product features...",value:r.detail??"",onChange:t=>u("detail",t.target.value)})]})]}),e.jsx(a,{sx:{my:1,borderTop:1,borderColor:"divider",borderStyle:"dashed"}}),e.jsxs(f,{container:!0,spacing:2,children:[e.jsxs(f,{size:6,children:[e.jsx(o,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Selling Price"}),e.jsx(c,{fullWidth:!0,type:"number",placeholder:"0.00",value:r.price??"",onChange:t=>u("price",t.target.value===""?void 0:Number(t.target.value)),InputProps:{startAdornment:e.jsx(y,{position:"start",children:"₹"})}})]}),e.jsxs(f,{size:6,children:[e.jsx(o,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Purchase Price"}),e.jsx(c,{fullWidth:!0,type:"number",placeholder:"0.00",value:r.purchasePrice??"",onChange:t=>u("purchasePrice",t.target.value===""?void 0:Number(t.target.value)),InputProps:{startAdornment:e.jsx(y,{position:"start",children:"₹"})}})]})]}),e.jsxs(f,{container:!0,spacing:2,children:[e.jsxs(f,{size:6,children:[e.jsx(o,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Stock Quantity"}),e.jsx(c,{fullWidth:!0,type:"number",placeholder:"0",value:r.stock??0,onChange:t=>u("stock",t.target.value===""?0:Number(t.target.value))})]}),e.jsxs(f,{size:6,children:[e.jsx(o,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Return Stock"}),e.jsx(c,{fullWidth:!0,type:"number",placeholder:"0",value:r.returnStock??0,onChange:t=>u("returnStock",t.target.value===""?0:Number(t.target.value))})]})]}),e.jsxs(a,{children:[e.jsxs(o,{variant:"subtitle2",sx:{mb:1.5,fontWeight:800,textTransform:"uppercase",letterSpacing:.5,color:"text.secondary",display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Pricing Rules",pe&&e.jsx(v,{size:"small",variant:"contained",color:"warning",onClick:me,startIcon:e.jsx(O,{fontSize:"small"}),sx:{borderRadius:2,textTransform:"none",px:1.5,height:28,fontSize:"0.7rem"},children:"Cleanup Invalid Rules"})]}),e.jsxs(f,{container:!0,spacing:2,children:[e.jsx(f,{size:6,children:e.jsxs(c,{select:!0,fullWidth:!0,label:"Tax Rule",value:r.taxRuleId||"",onChange:t=>u("taxRuleId",t.target.value),error:!!r.taxRuleId&&!p.some(t=>t.id===r.taxRuleId),helperText:r.taxRuleId&&!p.some(t=>t.id===r.taxRuleId)?"Rule deleted":"",children:[e.jsx(b,{value:"",children:e.jsx("em",{children:"None"})}),p.filter(t=>t.type==="tax").map(t=>e.jsxs(b,{value:t.id,children:[t.label," (",t.value,t.valueType==="percentage"?"%":"",")"]},t.id)),!!r.taxRuleId&&!p.some(t=>t.id===r.taxRuleId)&&e.jsx(b,{value:r.taxRuleId,disabled:!0,children:e.jsxs("em",{children:["Missing: ",r.taxRuleId]})})]})}),e.jsx(f,{size:6,children:e.jsxs(Oe,{fullWidth:!0,error:r.addonRuleIds?.some(t=>!p.some(s=>s.id===t)),children:[e.jsx(Ve,{children:"Add-on Costs"}),e.jsxs(Le,{multiple:!0,value:r.addonRuleIds||[],onChange:t=>{const s=t.target.value;u("addonRuleIds",typeof s=="string"?s.split(","):s)},input:e.jsx(Be,{label:"Add-on Costs"}),renderValue:t=>e.jsx(a,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(s=>{const n=p.find(d=>d.id===s);return e.jsx(Z,{label:n?.label||`Missing: ${s}`,size:"small",color:n?"default":"warning"},s)})}),children:[p.filter(t=>t.type==="addon").map(t=>e.jsxs(b,{value:t.id,children:[e.jsx(J,{checked:(r.addonRuleIds||[]).indexOf(t.id)>-1}),e.jsx(X,{primary:t.label,secondary:`${t.value}${t.valueType==="percentage"?"%":""}`})]},t.id)),r.addonRuleIds?.filter(t=>!p.some(s=>s.id===t)).map(t=>e.jsxs(b,{value:t,disabled:!0,sx:{fontStyle:"italic",opacity:.6},children:[e.jsx(J,{checked:!0}),e.jsx(X,{primary:`Missing: ${t}`})]},t))]})]})})]})]}),e.jsxs(x,{spacing:2,children:[e.jsxs(a,{children:[e.jsx(o,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Icon"}),e.jsx(c,{select:!0,fullWidth:!0,value:r.icon,onChange:t=>u("icon",t.target.value),InputProps:{startAdornment:e.jsx(y,{position:"start",children:te.find(t=>t.value===r.icon)?.icon})},children:te.map(t=>e.jsx(b,{value:t.value,children:e.jsxs(x,{direction:"row",alignItems:"center",spacing:1,children:[t.icon,e.jsx("span",{children:t.label})]})},t.value))})]}),e.jsxs(a,{children:[e.jsx(o,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Image Color"}),e.jsx(x,{direction:"row",spacing:1.5,sx:{overflowX:"auto",py:1},children:tt.map(t=>e.jsx(a,{onClick:()=>u("imageColor",t.value),sx:{width:40,height:40,borderRadius:"50%",bgcolor:t.color,border:t.value==="white"?"1px solid #e5e7eb":"none",cursor:"pointer",ring:r.imageColor===t.value?2:0,ringColor:"primary.main",ringOffset:2,boxShadow:1,transition:"all 0.2s",transform:r.imageColor===t.value?"scale(1.1)":"scale(1)"}},t.value))})]})]}),e.jsxs(W,{variant:"outlined",sx:{borderRadius:3,overflow:"hidden"},children:[e.jsxs(a,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px dashed",borderColor:"divider"},children:[e.jsxs(x,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(a,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"primary.light",color:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ee,{fontSize:"small"})}),e.jsx(o,{fontWeight:500,children:"On Sale"})]}),e.jsx(V,{checked:r.sale,onChange:t=>u("sale",t.target.checked)})]}),e.jsxs(a,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(x,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(a,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"primary.light",color:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Fe,{fontSize:"small"})}),e.jsx(o,{fontWeight:500,children:"New Arrival"})]}),e.jsx(V,{checked:r.isNew,onChange:t=>u("isNew",t.target.checked)})]}),e.jsxs(a,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",borderTop:"1px dashed",borderColor:"divider"},children:[e.jsxs(x,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(a,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"warning.light",color:"warning.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Me,{fontSize:"small"})}),e.jsxs(a,{children:[e.jsx(o,{fontWeight:500,children:"Complex Variant"}),e.jsx(o,{variant:"caption",color:"text.secondary",children:"Area-based pricing (x * y * price)"})]})]}),e.jsx(V,{checked:r.isComplexVariant,onChange:t=>u("isComplexVariant",t.target.checked)})]}),r.isComplexVariant&&e.jsx(a,{sx:{p:2,pt:0},children:e.jsx(c,{fullWidth:!0,size:"small",label:"Unit Name",placeholder:"e.g. sq. ft, meter, etc.",value:r.unitName||"",onChange:t=>u("unitName",t.target.value),InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(Je,{fontSize:"small"})})}})})]}),e.jsxs(a,{children:[e.jsx(o,{variant:"h6",sx:{mb:2,fontWeight:"bold"},children:"Available Sizes"}),e.jsxs(x,{spacing:2,children:[r.sizes?.map((t,s)=>e.jsxs(W,{variant:"outlined",sx:{p:2,borderRadius:3,bgcolor:"action.hover",position:"relative"},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(o,{variant:"subtitle2",sx:{fontWeight:800,color:"text.secondary",textTransform:"uppercase",letterSpacing:.5},children:["Variant #",s+1]}),e.jsx(C,{color:"error",onClick:()=>fe(s),size:"small",sx:{bgcolor:"error.light",color:"white","&:hover":{bgcolor:"error.main"},borderRadius:2},children:e.jsx(O,{fontSize:"small"})})]}),e.jsxs(x,{spacing:2,children:[e.jsx(c,{fullWidth:!0,label:"Size Label",placeholder:"e.g. Small, 1kg, etc.",value:t.label,onChange:n=>k(s,"label",n.target.value)}),e.jsx(c,{fullWidth:!0,label:"Purchase Price",placeholder:"0.00",type:"number",value:t.purchasePrice??0,onChange:n=>k(s,"purchasePrice",Number(n.target.value)),InputProps:{startAdornment:e.jsx(y,{position:"start",children:"₹"})}}),e.jsx(c,{fullWidth:!0,label:"Selling Price",placeholder:"0.00",type:"number",value:t.price,onChange:n=>k(s,"price",Number(n.target.value)),InputProps:{startAdornment:e.jsx(y,{position:"start",children:"₹"})}}),e.jsx(c,{fullWidth:!0,label:"Stock Quantity",placeholder:"0",type:"number",value:t.stock??0,onChange:n=>k(s,"stock",Number(n.target.value))}),e.jsx(c,{fullWidth:!0,label:"Return Stock",placeholder:"0",type:"number",value:t.returnStock??0,onChange:n=>k(s,"returnStock",Number(n.target.value))})]})]},s)),e.jsx(v,{variant:"outlined",startIcon:e.jsx(q,{}),onClick:ge,sx:{py:1.5,borderStyle:"dashed",borderWidth:2,borderRadius:3,"&:hover":{borderWidth:2}},children:"Add Size Variant"})]})]})]})})]})}),e.jsx(F,{maxWidth:"sm",sx:{pb:10},children:e.jsxs(a,{sx:{mt:4},children:[e.jsx(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:e.jsx(o,{variant:"h6",sx:{fontWeight:"bold"},children:"Manage Products"})}),e.jsx(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:e.jsx(c,{size:"small",placeholder:"Search name or SKU...",value:T,onChange:t=>de(t.target.value),InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(_e,{fontSize:"small",sx:{opacity:.5}})}),sx:{borderRadius:2,bgcolor:"background.paper"}},sx:{width:"100%"}})}),(()=>{const s=ne.filter(i=>{if(!T)return!0;const l=T.toLowerCase();return i.name.toLowerCase().includes(l)||i.sku&&i.sku.toLowerCase().includes(l)}).reduce((i,l)=>{const h=l.category||"Uncategorized";return i[h]||(i[h]=[]),i[h].push(l),i},{}),n=Object.keys(s).sort(),d=U.filter(i=>i!=="All Items"&&!s[i]).sort(),S=[...n,...d],g=[];return n.forEach(i=>{const l=[...s[i]].sort((E,Ce)=>E.name.localeCompare(Ce.name)),h=!!A[i];g.push({type:"header",cat:i,count:l.length,isExpanded:h}),h&&(l.forEach(E=>g.push({type:"product",product:E})),l.length===0&&g.push({type:"empty",cat:i}))}),d.length>0&&(g.push({type:"divider",label:"Empty Categories"}),d.forEach(i=>{const l=!!A[i];g.push({type:"header",cat:i,count:0,isExpanded:l}),l&&g.push({type:"empty",cat:i})})),e.jsxs(e.Fragment,{children:[S.length>0&&e.jsxs(a,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(v,{size:"small",variant:"outlined",onClick:()=>ue(S),sx:{borderRadius:2,textTransform:"none",fontWeight:"bold",fontSize:"0.75rem"},children:"Expand All"}),e.jsx(v,{size:"small",variant:"outlined",onClick:he,sx:{borderRadius:2,textTransform:"none",fontWeight:"bold",fontSize:"0.75rem"},children:"Collapse All"})]}),e.jsx(a,{sx:{width:"100%"},children:e.jsx(ze,{useWindowScroll:!0,increaseViewportBy:300,data:g,itemContent:(i,l)=>{if(l.type==="header")return e.jsx(a,{sx:{py:.5},children:e.jsxs(a,{onClick:()=>ce(l.cat),sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1.5,bgcolor:"action.selected",borderRadius:2,cursor:"pointer"},children:[e.jsxs(o,{variant:"subtitle1",sx:{fontWeight:"bold",display:"flex",alignItems:"center",gap:1},children:[l.cat,e.jsx(Z,{size:"small",label:l.count,sx:{fontWeight:"bold"}})]}),e.jsx(C,{size:"small",sx:{transform:l.isExpanded?"rotate(180deg)":"none",transition:"transform 0.3s"},children:e.jsx(K,{})})]})});if(l.type==="product"){const h=l.product;return e.jsx(a,{sx:{py:1},children:e.jsx(W,{variant:"outlined",sx:{p:2,borderRadius:2},children:e.jsxs(x,{direction:"row",spacing:2,alignItems:"center",children:[h.src?e.jsx(a,{component:"img",src:h.src,sx:{width:60,height:60,objectFit:"cover",borderRadius:2,bgcolor:"action.hover"}}):e.jsx(a,{sx:{width:60,height:60,borderRadius:2,bgcolor:"action.hover",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Y,{sx:{opacity:.3}})}),e.jsxs(a,{flex:1,children:[e.jsx(o,{fontWeight:600,children:h.name}),e.jsxs(o,{variant:"body2",color:"text.secondary",children:["₹",h.price]}),e.jsx(x,{direction:"row",spacing:1,alignItems:"center",children:e.jsx(o,{variant:"caption",color:"text.secondary",children:h.category})}),h.sku&&e.jsxs(o,{variant:"caption",color:"text.secondary",children:["SKU: ",h.sku]})]}),e.jsx(C,{size:"small",onClick:()=>je(h),children:e.jsx(Te,{})}),e.jsx(C,{size:"small",color:"error",onClick:()=>be(h.id),children:e.jsx(O,{})})]})})})}return l.type==="empty"?e.jsx(o,{variant:"body2",color:"text.secondary",sx:{fontStyle:"italic",px:1,py:1},children:"No products in this category."}):l.type==="divider"?e.jsxs(a,{sx:{display:"flex",alignItems:"center",my:3},children:[e.jsx(ee,{sx:{flex:1}}),e.jsx(o,{variant:"caption",sx:{px:2,fontWeight:"bold",color:"text.secondary",textTransform:"uppercase"},children:l.label}),e.jsx(ee,{sx:{flex:1}})]}):null}})})]})})()]})}),e.jsx(W,{sx:{position:"fixed",bottom:0,left:0,right:0,p:2,bgcolor:"background.paper",borderTop:1,borderColor:"divider",zIndex:10},elevation:4,children:e.jsx(F,{maxWidth:"sm",children:e.jsx(v,{fullWidth:!0,variant:"contained",size:"large",startIcon:e.jsx(He,{}),onClick:ye,sx:{height:56,borderRadius:3,fontSize:"1.1rem",fontWeight:"bold",boxShadow:2},children:I?"Update Product":"Save Product"})})}),e.jsxs($e,{open:le,onClose:()=>P(!1),PaperProps:{sx:{borderRadius:3,p:1}},children:[e.jsx(Qe,{sx:{fontWeight:"bold"},children:"Delete Product?"}),e.jsx(Ge,{children:e.jsx(qe,{children:"Are you sure you want to delete this product? This action is permanent and cannot be undone."})}),e.jsxs(Ke,{sx:{p:2},children:[e.jsx(v,{onClick:()=>P(!1),color:"inherit",sx:{fontWeight:"bold"},children:"Cancel"}),e.jsx(v,{onClick:ve,variant:"contained",color:"error",sx:{fontWeight:"bold",borderRadius:2},children:"Delete"})]})]})]})}export{zt as component};
