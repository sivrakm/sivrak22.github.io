import{r as n,j as e,C as $,O as G,P as H,Q,S as q}from"./index-Cfb1kZUX.js";import{u as J,A as V,T as X,a as Y}from"./productStore-DAfwWLy7.js";import{n as y,C,A as Z,a as ee,I as R,P as re,S as P,N as te,E as se,b as oe}from"./index.browser-D7GHBWpE.js";import{a as t,T as s,b as u,P as v}from"./Button-Dg8yrKBL.js";import{I as x}from"./IconButton-D5c2NXns.js";import{S as l,E as ie,C as ae}from"./ExpandMore-_fQAw9Ya.js";import{T as m,I as ne}from"./TextField-D99GoOLr.js";import{D as le}from"./Delete-1ROXbvY4.js";import{D as ce}from"./Dialog-EUAnWehl.js";import{D as de,a as he,b as xe,c as ge}from"./DialogTitle-ryfGSSSE.js";import"./useThemeProps-D1BUvn4E.js";import"./SwitchBase-SA0CaMN-.js";import"./Select-mqiLG2kn.js";import"./isMuiElement-CfRmxMJK.js";import"./Modal-BrIEvk04.js";function Re(){const{pushCategorytoDb:T,updateCategory:A,deleteCategory:E,categoryItems:z,fetchProducts:f}=J();n.useState(()=>{f()});const[h,w]=n.useState(null),[j,b]=n.useState(!1),[F,g]=n.useState(!1),[I,k]=n.useState(null),[o,p]=n.useState({name:"",sku:"",id:y(),category:"",detail:"",price:0,originalPrice:0,icon:"fitness_center",imageColor:"black",src:"",sale:!1,isNew:!0,sizes:[],categoryOnly:!0}),c=(r,i)=>{p(a=>({...a,[r]:i}))},[N,D]=n.useState(!1),S=n.useRef(null),U=async r=>{const i=r.target.files?.[0];if(i){D(!0);try{const a=G(H,`categories/${y()}_${i.name}`),d=await Q(a,i),K=await q(d.ref);p(M=>({...M,src:K}))}catch(a){console.error("Error uploading image: ",a),alert("Failed to upload image.")}finally{D(!1)}}},B=async()=>{try{const r=Object.entries(o).reduce((i,[a,d])=>(d!==void 0&&(typeof d=="string"?i[a]=d.trim():i[a]=d),i),{});if(r.category=r.name,console.log("Saving category...",r),!r.name||!r.detail){alert("Please fill all details");return}h?(await A(r),alert("Category updated successfully!")):(await T(r),alert("Category saved successfully!")),await f(),W()}catch(r){console.error("Error saving category:",r),alert("Failed to save category")}},O=r=>{p({...r,categoryOnly:!0}),w(r.id),b(!0),window.scrollTo({top:0,behavior:"smooth"})},L=r=>{k(r),g(!0)},_=async()=>{I&&(await E(I),await f(),g(!1),k(null))},W=()=>{p({name:"",sku:"",id:y(),category:"",detail:"",price:0,originalPrice:0,icon:"fitness_center",imageColor:"black",src:"",sale:!1,isNew:!0,sizes:[],categoryOnly:!0}),w(null),b(!1),window.scrollTo({top:0,behavior:"smooth"})};return e.jsxs(t,{sx:{minHeight:"100vh",bgcolor:"background.default",pb:10},children:[e.jsx(V,{position:"sticky",color:"default",elevation:0,sx:{bgcolor:"background.paper",borderBottom:1,borderColor:"divider"},children:e.jsxs(X,{children:[e.jsx(x,{onClick:()=>window.history.back(),edge:"start",children:e.jsx(Y,{})}),e.jsx(s,{variant:"h6",component:"h1",sx:{flexGrow:1,textAlign:"center",pr:5,fontWeight:"bold"},children:h?"Edit Category":"Add Category"}),h&&e.jsx(u,{color:"inherit",onClick:W,children:"Cancel Edit"})]})}),e.jsx(C,{maxWidth:"sm",sx:{py:3,display:"flex",flexDirection:"column",gap:3},children:e.jsxs(t,{sx:{border:1,borderColor:"divider",borderRadius:3,overflow:"hidden",bgcolor:"background.paper"},children:[e.jsxs(t,{onClick:()=>b(!j),sx:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",p:2,bgcolor:"action.hover",transition:"background-color 0.2s","&:hover":{bgcolor:"action.selected"}},children:[e.jsxs(l,{direction:"row",spacing:1.5,alignItems:"center",children:[e.jsx(Z,{color:"primary"}),e.jsx(s,{variant:"subtitle1",sx:{fontWeight:"bold"},children:h?"Edit Category Details":"Add New Category"})]}),e.jsx(x,{size:"small",sx:{transform:j?"rotate(180deg)":"none",transition:"transform 0.3s"},children:e.jsx(ie,{})})]}),e.jsx(ae,{in:j,children:e.jsxs(t,{sx:{p:2,display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(t,{children:[e.jsx(s,{variant:"subtitle2",sx:{mb:1,fontWeight:"bold",textTransform:"uppercase"},children:"Category Image"}),e.jsx(m,{fullWidth:!0,placeholder:"Paste image URL or upload...",value:o.src??"",onChange:r=>c("src",r.target.value),InputProps:{endAdornment:e.jsxs(ne,{position:"end",children:[e.jsx(x,{onClick:()=>S.current?.click(),edge:"end",children:N?e.jsx($,{size:24}):e.jsx(ee,{color:"primary"})}),e.jsx("input",{type:"file",hidden:!0,ref:S,accept:"image/*",onChange:U})]}),sx:{borderRadius:3}}}),e.jsx(t,{sx:{mt:2,height:160,borderRadius:3,border:"2px dashed",borderColor:"divider",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",bgcolor:"action.hover"},children:o.src?e.jsx(t,{component:"img",src:o.src,sx:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsxs(e.Fragment,{children:[e.jsx(R,{sx:{fontSize:40,opacity:.5,mb:1}}),e.jsx(s,{variant:"caption",sx:{opacity:.7},children:"Image preview will appear here"})]})})]}),e.jsxs(l,{spacing:2,children:[e.jsxs(l,{direction:"row",spacing:2,children:[e.jsxs(t,{flex:1,children:[e.jsx(s,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Category Name"}),e.jsx(m,{fullWidth:!0,placeholder:"Category Label",value:o.name??"",onChange:r=>{c("name",r.target.value),c("category",r.target.value)}})]}),e.jsxs(t,{width:140,children:[e.jsx(s,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"SKU ID"}),e.jsx(m,{fullWidth:!0,placeholder:"CAT-001",value:o.sku??"",onChange:r=>c("sku",r.target.value)})]})]}),e.jsxs(t,{children:[e.jsx(s,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Detail"}),e.jsx(m,{fullWidth:!0,multiline:!0,minRows:3,placeholder:"Describe the category features...",value:o.detail??"",onChange:r=>c("detail",r.target.value)})]})]}),e.jsx(t,{sx:{my:1,borderTop:1,borderColor:"divider",borderStyle:"dashed"}}),e.jsxs(v,{variant:"outlined",sx:{borderRadius:3,overflow:"hidden"},children:[e.jsxs(t,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px dashed",borderColor:"divider"},children:[e.jsxs(l,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(t,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"primary.light",color:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(re,{fontSize:"small"})}),e.jsx(s,{fontWeight:500,children:"On Sale"})]}),e.jsx(P,{checked:o.sale??!1,onChange:r=>c("sale",r.target.checked)})]}),e.jsxs(t,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(l,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(t,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"primary.light",color:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(te,{fontSize:"small"})}),e.jsx(s,{fontWeight:500,children:"New Arrival"})]}),e.jsx(P,{checked:o.isNew??!0,onChange:r=>c("isNew",r.target.checked)})]})]})]})})]})}),e.jsx(C,{maxWidth:"sm",sx:{pb:10},children:e.jsxs(t,{sx:{mt:4},children:[e.jsx(s,{variant:"h6",sx:{mb:2,fontWeight:"bold"},children:"Manage Categories"}),e.jsx(l,{spacing:2,children:z.map(r=>e.jsx(v,{variant:"outlined",sx:{p:2,borderRadius:2},children:e.jsxs(l,{direction:"row",spacing:2,alignItems:"center",children:[r.src?e.jsx(t,{component:"img",src:r.src,sx:{width:60,height:60,objectFit:"cover",borderRadius:2,bgcolor:"action.hover"}}):e.jsx(t,{sx:{width:60,height:60,borderRadius:2,bgcolor:"action.hover",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(R,{sx:{opacity:.3}})}),e.jsxs(t,{flex:1,children:[e.jsx(s,{fontWeight:600,children:r.name}),e.jsx(l,{direction:"row",spacing:1,alignItems:"center",children:e.jsx(s,{variant:"caption",color:"text.secondary",children:r.detail})}),r.sku&&e.jsxs(s,{variant:"caption",color:"text.secondary",children:["SKU: ",r.sku]})]}),e.jsx(x,{size:"small",onClick:()=>O(r),children:e.jsx(se,{})}),e.jsx(x,{size:"small",color:"error",onClick:()=>L(r.id),children:e.jsx(le,{})})]})},r.id))})]})}),e.jsx(v,{sx:{position:"fixed",bottom:0,left:0,right:0,p:2,bgcolor:"background.paper",borderTop:1,borderColor:"divider",zIndex:10},elevation:4,children:e.jsx(C,{maxWidth:"sm",children:e.jsx(u,{fullWidth:!0,variant:"contained",size:"large",startIcon:e.jsx(oe,{}),onClick:B,sx:{height:56,borderRadius:3,fontSize:"1.1rem",fontWeight:"bold",boxShadow:2},children:h?"Update Category":"Save Category"})})}),e.jsxs(ce,{open:F,onClose:()=>g(!1),PaperProps:{sx:{borderRadius:3,p:1}},children:[e.jsx(de,{sx:{fontWeight:"bold"},children:"Delete Category?"}),e.jsx(he,{children:e.jsx(xe,{children:"Are you sure you want to delete this category? This action is permanent and cannot be undone."})}),e.jsxs(ge,{sx:{p:2},children:[e.jsx(u,{onClick:()=>g(!1),color:"inherit",sx:{fontWeight:"bold"},children:"Cancel"}),e.jsx(u,{onClick:_,variant:"contained",color:"error",sx:{fontWeight:"bold",borderRadius:2},children:"Delete"})]})]})]})}export{Re as component};
