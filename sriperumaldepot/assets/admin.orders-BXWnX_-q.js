import{a as X,u as G,r as a,j as e,C as K,x as Q,y as h,A as V,D as Z,E as _,z as ee,L as j,M as T,N as re}from"./index-DtX5KMym.js";import{p as oe}from"./printInvoice-Cj1u0MpQ.js";import{O as te}from"./OrderItem-D2GW6Cg9.js";import{O as se,a as ne,A as ie,R as ae,c as le}from"./orderCalculations-BNK5Cyxm.js";import{B as t,T as l,a as n}from"./Button-ZxXk5NXE.js";import{I as y}from"./IconButton-BtwwtOow.js";import{A as ce}from"./ArrowBack-q2JD_40Z.js";import{S as de}from"./Search-BKxuWLiJ.js";import{S as m}from"./Stack-DliPFEgh.js";import{C as pe}from"./Card-BI_onguj.js";import{A as me}from"./Avatar-C8fpOm4B.js";import{E as R}from"./ExpandMore-qT6ar1FV.js";import{C as xe}from"./Collapse-CfiXN74g.js";import{D as ue}from"./dividerClasses-uNOcrwxV.js";import{D as he,a as ge,b as fe}from"./DialogTitle-DefX13gx.js";import{D as be}from"./DialogContentText-DMtPedQz.js";import{C as je}from"./CheckCircle-JKrKFUcS.js";import{C as ye,I as Ce,H as ve}from"./Inventory2-BYrutS6x.js";import{L as Se}from"./LocalShipping-BznEunq_.js";import"./ShoppingCart-CL8rEfc8.js";import"./Divider-B1FYCkTC.js";import"./QuantitySelector-D8TfKOwS.js";import"./Add-BdPpStYo.js";import"./TextField-eoPkSaiM.js";import"./isMuiElement-1F15ohEj.js";import"./FormControlLabel-BVGJZrL6.js";import"./Checkbox-BUmFVTHj.js";const g=ee`
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
`;function Ve(){const I=X(),C=G(r=>r.user),[v,z]=a.useState([]),[A,S]=a.useState(!0),[i,E]=a.useState("All"),[f,L]=a.useState(null),[P,x]=a.useState(!1),[D,w]=a.useState(null),[W,k]=a.useState(!1),[c,B]=a.useState(null),$=["All","Processing","Delivered","Cancelled"],u=async()=>{if(!C){S(!1);return}try{const r=Q(h,"orders"),o=V(r,Z("timestamp","desc")),d=(await _(o)).docs.map(p=>({id:p.id,...p.data()}));z(d)}catch(r){console.error("Error fetching orders:",r)}finally{S(!1)}};a.useEffect(()=>{u()},[C]);const O=v.filter(r=>i==="All"?!0:(r.status==="pending"?"Processing":r.status).toLowerCase()===i.toLowerCase()),q=r=>{switch(r.toLowerCase()){case"pending":case"processing":return{label:"Processing",icon:e.jsx(ve,{fontSize:"small"}),color:"warning.main",bgcolor:"rgba(237, 108, 2, 0.1)",borderColor:"rgba(237, 108, 2, 0.2)"};case"shipped":return{label:"Shipped",icon:e.jsx(Se,{fontSize:"small"}),color:"info.main",bgcolor:"rgba(2, 136, 209, 0.1)",borderColor:"rgba(2, 136, 209, 0.2)"};case"delivered":return{label:"Delivered",icon:e.jsx(Ce,{fontSize:"small"}),color:"success.main",bgcolor:"rgba(46, 125, 50, 0.1)",borderColor:"rgba(46, 125, 50, 0.2)"};case"cancelled":return{label:"Cancelled",icon:e.jsx(ye,{fontSize:"small"}),color:"error.main",bgcolor:"rgba(211, 47, 47, 0.1)",borderColor:"rgba(211, 47, 47, 0.2)"};default:return{label:"Completed",icon:e.jsx(je,{fontSize:"small"}),color:"text.secondary",bgcolor:"action.hover",borderColor:"divider"}}},b=(r,o)=>{try{const s=j(h,"orders",r);T(s,{status:o}),u()}catch(s){console.error("Error updating order status:",s),alert("Failed to update order status = "+r)}},H=async()=>{if(D)try{const r=j(h,"orders",D);await re(r),x(!1),w(null),alert("Order deleted successfully"),u()}catch(r){console.error("Error deleting order:",r),alert("Failed to delete order")}},M=r=>{w(r),x(!0)},F=r=>{if(!r)return"Just now";const o=r.toDate(),d=new Date().getTime()-o.getTime(),p=Math.floor(d/(1e3*60*60*24));return p===0?`Today, ${o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:p===1?`Yesterday, ${o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:o.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},N=r=>{L(f===r?null:r)},U=r=>{const o=v.find(s=>s.id===r);oe(o)},Y=r=>{B(r),k(!0)},J=async r=>{if(c)try{const o=le(r,c.manualAddons,c.deliveryAmount),s=j(h,"orders",c.id);await T(s,o),alert("Return processed successfully"),u()}catch(o){throw console.error("Error processing return:",o),o}};return e.jsxs(t,{sx:{pb:10,bgcolor:"background.default",minHeight:"100vh",color:"text.primary"},children:[e.jsx(t,{sx:{position:"sticky",top:0,zIndex:1100,bgcolor:"background.default",borderBottom:1,borderColor:"divider"},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2,height:60},children:[e.jsx(y,{sx:{ml:-1},onClick:()=>I({to:"/shop"}),children:e.jsx(ce,{})}),e.jsxs(l,{variant:"h6",sx:{fontWeight:"bold"},children:["Estimate"," History"]}),e.jsx(y,{sx:{mr:-1},children:e.jsx(de,{})})]})}),e.jsxs(t,{sx:{p:2},children:[e.jsx(t,{sx:{display:"flex",gap:1.5,overflowX:"auto",p:2,mb:2,"&::-webkit-scrollbar":{display:"none"},animation:`${g} 0.6s ease-out forwards`},children:$.map(r=>e.jsx(n,{variant:i===r?"contained":"outlined",onClick:()=>E(r),sx:{flexShrink:0,borderRadius:50,textTransform:"none",fontWeight:"bold",fontSize:"0.875rem",px:3,py:1,bgcolor:i===r?"primary.main":"background.paper",color:i===r?"black":"text.secondary",borderColor:i===r?"primary.main":"divider",boxShadow:i===r?"0 4px 12px rgba(242, 215, 13, 0.2)":"none","&:hover":{bgcolor:i===r?"primary.main":"action.hover",borderColor:i===r?"primary.main":"divider"}},children:r},r))}),A?e.jsx(t,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(K,{})}):O.length===0?e.jsx(t,{sx:{textAlign:"center",py:8,animation:`${g} 0.6s ease-out forwards`},children:e.jsx(l,{color:"text.secondary",children:"No orders found."})}):e.jsx(m,{spacing:2,sx:{animation:`${g} 0.6s ease-out forwards`,animationDelay:"0.1s"},children:O.map(r=>{const o=q(r.status);return e.jsx(pe,{sx:{p:2,borderRadius:3,border:1,borderColor:"divider",boxShadow:"none",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",transition:"all 0.2s","&:active":{transform:"scale(0.98)"}},onClick:()=>N(r.id),children:e.jsxs(t,{sx:{width:"100%"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(me,{sx:{width:48,height:48,bgcolor:o.bgcolor,color:o.color,border:1,borderColor:o.borderColor},children:o.icon}),e.jsxs(t,{children:[e.jsxs(l,{variant:"body2",sx:{fontWeight:"bold"},children:["Estimate"," #",r.id.slice(0,5).toUpperCase()]}),e.jsx(l,{variant:"caption",sx:{color:"text.secondary",mt:.5,display:"block"},children:F(r.timestamp)})]})]}),e.jsxs(t,{sx:{textAlign:"right",display:"flex",alignItems:"center",gap:1},children:[e.jsxs(t,{children:[e.jsxs(l,{variant:"body2",sx:{fontWeight:"bold"},children:["â‚¹",r.total.toLocaleString()]}),e.jsx(t,{sx:{display:"inline-block",mt:.5,px:1.5,py:.25,borderRadius:10,bgcolor:o.bgcolor,color:o.color,fontSize:"0.625rem",fontWeight:"bold",textTransform:"uppercase",letterSpacing:.5},children:o.label})]}),e.jsx(y,{size:"small",sx:{transform:f===r.id?"rotate(180deg)":"none",transition:"transform 0.3s"},children:e.jsx(R,{})})]})]}),e.jsxs(xe,{in:f===r.id,timeout:"auto",unmountOnExit:!0,children:[e.jsx(t,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:e.jsx(se,{order:r})}),e.jsx(t,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:e.jsx(ne,{shippingDetails:r.shippingDetails||{}})}),e.jsxs(t,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:[e.jsxs(l,{variant:"caption",sx:{fontWeight:"bold",color:"text.secondary",mb:1.5,display:"block",textTransform:"uppercase",letterSpacing:.5},children:["Estimate"," Items"]}),e.jsx(m,{spacing:2,children:r.items?.map((s,d)=>e.jsx(te,{item:s},d))}),e.jsxs(m,{direction:"row",spacing:1,sx:{mt:2},children:[e.jsx(n,{size:"small",variant:"outlined",color:"success",onClick:()=>b(r.id,"Delivered"),children:"Delivered"}),e.jsx(n,{size:"small",variant:"outlined",color:"error",onClick:()=>b(r.id,"Cancelled"),children:"Cancelled"}),e.jsx(n,{size:"small",variant:"outlined",color:"error",onClick:()=>b(r.id,"pending"),children:"Processing"})]})]}),e.jsx(t,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:e.jsxs(m,{direction:"row",spacing:1,sx:{mt:2},justifyContent:"space-between",children:[e.jsx(n,{size:"small",variant:"contained",color:"success",onClick:()=>U(r.id),children:"Print"}),e.jsxs(m,{direction:"row",spacing:1,children:[e.jsx(n,{size:"small",variant:"outlined",color:"warning",startIcon:e.jsx(ie,{}),onClick:()=>Y(r),children:"Return"}),e.jsx(n,{size:"small",variant:"outlined",color:"error",onClick:()=>M(r.id),children:"Delete"})]})]})})]})]})},r.id)})}),e.jsx(t,{sx:{mt:4,textAlign:"center",animation:`${g} 0.6s ease-out forwards`,animationDelay:"0.3s"},children:e.jsx(n,{size:"small",endIcon:e.jsx(R,{}),sx:{color:"primary.main",fontWeight:"bold",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:1,"&:hover":{bgcolor:"transparent",color:"primary.dark"}},children:"Load More"})})]}),e.jsxs(ue,{open:P,onClose:()=>x(!1),PaperProps:{sx:{borderRadius:3,p:1}},children:[e.jsxs(he,{sx:{fontWeight:"bold"},children:["Delete ","Estimate","?"]}),e.jsx(ge,{children:e.jsx(be,{children:"Are you sure you want to delete this order? This action is permanent and cannot be undone."})}),e.jsxs(fe,{sx:{p:2},children:[e.jsx(n,{onClick:()=>x(!1),color:"inherit",sx:{fontWeight:"bold"},children:"Cancel"}),e.jsx(n,{onClick:H,variant:"contained",color:"error",sx:{fontWeight:"bold",borderRadius:2},children:"Delete"})]})]}),e.jsx(ae,{open:W,onClose:()=>k(!1),order:c,onSave:J})]})}export{Ve as component};
