import{f as G,j as e,i as Te,r as j,B as i,I,h as a,S as x,E as ie,l as ne,C as Ne,a5 as A,ak as Ae,al as De,am as Ee,an as Oe}from"./index-Cp2I37WV.js";import{u as S}from"./productStore-CdKEN6r_.js";import{u as Be}from"./pricingStore-DJNGm8Ee.js";import{n as k}from"./index.browser-vcSNLBTf.js";import{Y as Fe}from"./index-AUmU2T_b.js";import{A as Ve,T as Ue,a as Le}from"./ArrowBackIosNew-8xJ-BITj.js";import{B as p}from"./Button-BhddC0uT.js";import{C as H}from"./Container-DYBXSZ3B.js";import{A as ae}from"./AddCircle-Dd1LKIVw.js";import{T as u,F as Q,S as _,O as $,i as Me}from"./TextField-DFh5Z3SN.js";import{I as y}from"./InputAdornment-Dc3k0wVX.js";import{C as He}from"./CloudUpload-XP1Bokep.js";import{I as le,P as Qe,N as _e}from"./Percent-lllQ6TS1.js";import{M as g}from"./MenuItem-DSxzA0Hh.js";import{C as D}from"./Checkbox-ByfKq9bR.js";import{L as E}from"./ListItemText-BqhCjFKZ.js";import{C as O}from"./Chip-C_nwfqmD.js";import{G as m}from"./Grid-DFPvDSQB.js";import{D as K}from"./Delete-Cfiz7Tsf.js";import{S as B}from"./Switch-CNjfn5-X.js";import{S as $e}from"./Straighten-DTSXDzOY.js";import{N as Ke}from"./NotificationsActive-D8kY9REI.js";import{S as oe}from"./Search-BDBvXvmT.js";import{E as Ge}from"./Edit-CmY8vNg2.js";import{D as de}from"./Divider-BmF7nJuL.js";import{S as qe}from"./Save-Bb6eZ_Hi.js";import{D as Ye,a as Xe,b as Je}from"./DialogTitle-C1XPoAzT.js";import{D as Ze}from"./DialogContentText-Z6gPO8G6.js";import{D as et}from"./DialogActions-B-je9ZVc.js";import{F as tt}from"./FitnessCenter-BSJWDetB.js";import{S as rt}from"./ShoppingBag-BnEcDpTX.js";import"./isMuiElement-C4u7QS8z.js";import"./listItemTextClasses-cceYQpcq.js";import"./dividerClasses-DniQLY7G.js";import"./SwitchBase-CJSetpRX.js";const st=G(e.jsx("path",{d:"M3 17h18v-2H3zm0 3h18v-1H3zm0-7h18v-3H3zm0-9v4h18V4z"})),it=G([e.jsx("path",{d:"m12 12.9-2.13 2.09c-.56.56-.87 1.29-.87 2.07C9 18.68 10.35 20 12 20s3-1.32 3-2.94c0-.78-.31-1.52-.87-2.07z"},"0"),e.jsx("path",{d:"m16 6-.44.55C14.38 8.02 12 7.19 12 5.3V2S4 6 4 13c0 2.92 1.56 5.47 3.89 6.86-.56-.79-.89-1.76-.89-2.8 0-1.32.52-2.56 1.47-3.5L12 10.1l3.53 3.47c.95.93 1.47 2.17 1.47 3.5 0 1.02-.31 1.96-.85 2.75 1.89-1.15 3.29-3.06 3.71-5.3.66-3.55-1.07-6.9-3.86-8.52"},"1")]),nt=G(e.jsx("path",{d:"M20 10V8h-4V4h-2v4h-4V4H8v4H4v2h4v4H4v2h4v4h2v-4h4v4h2v-4h4v-2h-4v-4zm-6 4h-4v-4h4z"})),ce=[{value:"tag",label:"Tag",icon:e.jsx(nt,{})},{value:"fitness_center",label:"Dumbbell",icon:e.jsx(tt,{})},{value:"local_fire_department",label:"Fire",icon:e.jsx(it,{})},{value:"shopping_bag",label:"Bag",icon:e.jsx(rt,{})}],at=[{value:"black",color:"#000000"},{value:"white",color:"#ffffff"},{value:"red",color:"#ef4444"},{value:"blue",color:"#3b82f6"},{value:"yellow",color:"#f2b90d"}];function Mt(){const ue=S(t=>t.pushProducttoDb),he=S(t=>t.updateProduct),xe=S(t=>t.products),q=S(t=>t.fetchProducts),pe=S(t=>t.deleteProduct),Y=S(t=>t.categories),W=S(t=>t.categoryItems),{rules:f,fetchRules:ge}=Be(),{suppliers:F,fetchSuppliers:me}=Te();j.useState(()=>{q(),ge(),me()});const[w,X]=j.useState(null),[fe,J]=j.useState(!1),[V,U]=j.useState(!1),[je,T]=j.useState(!1),[Z,ee]=j.useState(null),[L,M]=j.useState({}),[N,te]=j.useState(""),be=t=>{M(r=>({...r,[t]:!r[t]}))},ve=t=>{const r={...L};t.forEach(n=>{r[n]=!0}),M(r)},ye=()=>{M({})},re=j.useRef(null),Ce=async t=>{const r=t.target.files?.[0];if(r){J(!0);try{const n=Ae(De,`products/${k()}_${r.name}`),o={customMetadata:{imgRefId:String(s.imgRefId),productName:String(s.name||"unnamed")}},R=await Ee(n,r,o),b=await Oe(R.ref);C(c=>({...c,src:b}))}catch(n){console.error("Error uploading image: ",n),alert("Failed to upload image.")}finally{J(!1)}}},[s,C]=j.useState({name:"",sku:"",id:k(),imgRefId:k(),category:"",categoryId:"",detail:"",price:void 0,icon:"fitness_center",imageColor:"black",src:"",sale:!1,isNew:!0,sizes:[],categoryOnly:!1,taxRuleId:"",addonRuleIds:[],isComplexVariant:!1,unitName:"",purchasePrice:void 0,stock:0,returnStock:0,stockTrigger:!1,triggerBelow:void 0,triggerQty:void 0,triggerSupplierId:""}),Ie=(()=>{if(!s.taxRuleId&&(!s.addonRuleIds||s.addonRuleIds.length===0))return!1;const t=f.map(n=>n.id);return!!(s.taxRuleId&&!t.includes(s.taxRuleId)||s.addonRuleIds?.some(n=>!t.includes(n)))})(),Se=()=>{const t=f.map(n=>n.id),r={...s};s.taxRuleId&&!t.includes(s.taxRuleId)&&(r.taxRuleId=""),s.addonRuleIds&&s.addonRuleIds.length>0&&(r.addonRuleIds=s.addonRuleIds.filter(n=>t.includes(n))),C(r)},l=(t,r)=>{C(n=>({...n,[t]:r}))},z=(t,r,n)=>{const o=[...s.sizes||[]];o[t]={...o[t],[r]:n},C(R=>({...R,sizes:o}))},we=()=>{C(t=>({...t,sizes:[...t.sizes||[],{label:"",price:0,stock:0,returnStock:0,purchasePrice:0}]}))},Re=t=>{C(r=>({...r,sizes:r.sizes?.filter((n,o)=>o!==t)}))},ke=t=>{C({...t,imgRefId:t.imgRefId||k()}),X(t.id),U(!0),window.scrollTo({top:0,behavior:"smooth"})},We=t=>{ee(t),T(!0)},ze=async()=>{Z&&(await pe(Z),T(!1),ee(null))},se=()=>{C({name:"",sku:"",id:k(),imgRefId:k(),category:"",categoryId:"",detail:"",price:void 0,icon:"fitness_center",imageColor:"black",src:"",sale:!1,isNew:!0,sizes:[],categoryOnly:!1,isComplexVariant:!1,unitName:"",purchasePrice:void 0,stock:0,returnStock:0,supplierIds:[],secondaryCategoryIds:[],stockTrigger:!1,triggerBelow:void 0,triggerQty:void 0,triggerSupplierId:""}),X(null),U(!1),window.scrollTo({top:0,behavior:"smooth"})},Pe=async()=>{try{console.log("Saving product...",s);const t=Object.entries(s).reduce((r,[n,o])=>(o!==void 0&&(n==="price"||n==="purchasePrice"||n==="stock"||n==="returnStock"?o===""||o===null||isNaN(Number(o))||(r[n]=Number(o)):r[n]=o),r),{});if(!t.name){alert("Please fill in at least Name");return}w?(await he({...t,id:w}),alert("Product updated successfully!")):(await ue(t),alert("Product saved successfully!")),await q(),se()}catch(t){console.error("Error saving product:",t),alert("Failed to save product")}};return e.jsxs(i,{sx:{minHeight:"100vh",bgcolor:"background.default",pb:10},children:[e.jsx(Ve,{position:"sticky",color:"default",elevation:0,sx:{bgcolor:"background.paper",borderBottom:1,borderColor:"divider"},children:e.jsxs(Ue,{children:[e.jsx(I,{onClick:()=>window.history.back(),edge:"start",children:e.jsx(Le,{})}),e.jsx(a,{variant:"h6",component:"h1",sx:{flexGrow:1,textAlign:"center",pr:5,fontWeight:"bold"},children:w?"Edit Product":"Add Product"}),w&&e.jsx(p,{color:"inherit",onClick:se,children:"Cancel Edit"})]})}),e.jsx(H,{maxWidth:"sm",sx:{py:3,display:"flex",flexDirection:"column",gap:3},children:e.jsxs(i,{sx:{border:1,borderColor:"divider",borderRadius:3,overflow:"hidden",bgcolor:"background.paper"},children:[e.jsxs(i,{onClick:()=>U(!V),sx:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",p:2,bgcolor:"action.hover",transition:"background-color 0.2s","&:hover":{bgcolor:"action.selected"}},children:[e.jsxs(x,{direction:"row",spacing:1.5,alignItems:"center",children:[e.jsx(ae,{color:"primary"}),e.jsx(a,{variant:"subtitle1",sx:{fontWeight:"bold"},children:w?"Edit Product Details":"Add New Product"})]}),e.jsx(I,{size:"small",sx:{transform:V?"rotate(180deg)":"none",transition:"transform 0.3s"},children:e.jsx(ie,{})})]}),e.jsx(ne,{in:V,children:e.jsxs(i,{sx:{p:2,display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(i,{children:[e.jsx(a,{variant:"subtitle2",sx:{mb:1,fontWeight:"bold",textTransform:"uppercase"},children:"Product Image"}),e.jsx(u,{fullWidth:!0,placeholder:"Paste image URL here...",value:s.src??"",onChange:t=>l("src",t.target.value),InputProps:{endAdornment:e.jsxs(y,{position:"end",children:[e.jsx(I,{onClick:()=>re.current?.click(),edge:"end",children:fe?e.jsx(Ne,{size:24}):e.jsx(He,{color:"primary"})}),e.jsx("input",{type:"file",hidden:!0,ref:re,accept:"image/*",onChange:Ce})]}),sx:{borderRadius:3}}}),e.jsx(i,{sx:{mt:2,height:160,borderRadius:3,border:"2px dashed",borderColor:"divider",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",bgcolor:"action.hover"},children:s.src?e.jsx(i,{component:"img",src:s.src,sx:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsxs(e.Fragment,{children:[e.jsx(le,{sx:{fontSize:40,opacity:.5,mb:1}}),e.jsx(a,{variant:"caption",sx:{opacity:.7},children:"Image preview will appear here"})]})})]}),e.jsxs(x,{spacing:2,children:[e.jsxs(x,{direction:"row",spacing:2,children:[e.jsxs(i,{flex:1,children:[e.jsx(a,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Product Name"}),e.jsx(u,{fullWidth:!0,placeholder:"e.g. Protein Whey",value:s.name??"",onChange:t=>l("name",t.target.value)})]}),e.jsxs(i,{width:140,children:[e.jsx(a,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"SKU ID"}),e.jsx(u,{fullWidth:!0,placeholder:"PROD-001",value:s.sku||"",onChange:t=>l("sku",t.target.value)})]})]}),e.jsxs(i,{children:[e.jsx(a,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Category"}),e.jsxs(u,{select:!0,fullWidth:!0,value:s.category,onChange:t=>{const r=t.target.value;l("category",r);const n=W.find(o=>o.name===r);n&&l("categoryId",n.id)},children:[e.jsx(g,{value:"",disabled:!0,children:"Select Category"}),Y.filter(t=>t!=="All Items").map(t=>e.jsx(g,{value:t,children:t},t))]})]}),e.jsxs(i,{children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(a,{variant:"subtitle2",sx:{fontWeight:600},children:"Secondary Categories"}),(s.secondaryCategoryIds||[]).length>0&&e.jsx(p,{size:"small",onClick:()=>l("secondaryCategoryIds",[]),sx:{textTransform:"none",py:0,minWidth:"auto",fontWeight:"bold"},children:"Clear"})]}),e.jsx(Q,{fullWidth:!0,size:"small",children:e.jsx(_,{multiple:!0,value:s.secondaryCategoryIds||[],onChange:t=>{const r=t.target.value;l("secondaryCategoryIds",typeof r=="string"?r.split(","):r)},input:e.jsx($,{}),MenuProps:{PaperProps:{style:{maxHeight:"50vh"}},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}},renderValue:t=>e.jsx(i,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(r=>{const n=W.find(o=>o.id===r);return e.jsx(O,{label:n?.name||r,size:"small"},r)})}),children:W.filter(t=>t.name!=="All Items"&&t.id!==s.categoryId).map(t=>e.jsxs(g,{value:String(t.id),children:[e.jsx(D,{checked:(s.secondaryCategoryIds||[]).indexOf(String(t.id))>-1}),e.jsx(E,{primary:t.name})]},t.id))})})]}),e.jsxs(i,{children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(a,{variant:"subtitle2",sx:{fontWeight:600},children:"Suppliers"}),(s.supplierIds||[]).length>0&&e.jsx(p,{size:"small",onClick:()=>l("supplierIds",[]),sx:{textTransform:"none",py:0,minWidth:"auto",fontWeight:"bold"},children:"Clear"})]}),e.jsx(Q,{fullWidth:!0,size:"small",children:e.jsx(_,{multiple:!0,value:s.supplierIds||[],onChange:t=>{const r=t.target.value;l("supplierIds",typeof r=="string"?r.split(","):r)},input:e.jsx($,{}),MenuProps:{PaperProps:{style:{maxHeight:"50vh"}},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}},renderValue:t=>e.jsx(i,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(r=>{const n=F.find(o=>o.id===r);return e.jsx(O,{label:n?.name||r,size:"small"},r)})}),children:F.map(t=>e.jsxs(g,{value:t.id,children:[e.jsx(D,{checked:(s.supplierIds||[]).indexOf(t.id)>-1}),e.jsx(E,{primary:t.name,secondary:t.contacts?.[0]?.name})]},t.id))})})]}),e.jsxs(i,{children:[e.jsx(a,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Detail"}),e.jsx(u,{fullWidth:!0,multiline:!0,minRows:3,placeholder:"Describe the product features...",value:s.detail??"",onChange:t=>l("detail",t.target.value)})]})]}),e.jsx(i,{sx:{my:1,borderTop:1,borderColor:"divider",borderStyle:"dashed"}}),e.jsxs(m,{container:!0,spacing:2,children:[e.jsxs(m,{size:6,children:[e.jsx(a,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Selling Price"}),e.jsx(u,{fullWidth:!0,type:"number",placeholder:"0.00",value:s.price??"",onChange:t=>l("price",t.target.value===""?void 0:Number(t.target.value)),InputProps:{startAdornment:e.jsx(y,{position:"start",children:"₹"})}})]}),e.jsxs(m,{size:6,children:[e.jsx(a,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Purchase Price"}),e.jsx(u,{fullWidth:!0,type:"number",placeholder:"0.00",value:s.purchasePrice??"",onChange:t=>l("purchasePrice",t.target.value===""?void 0:Number(t.target.value)),InputProps:{startAdornment:e.jsx(y,{position:"start",children:"₹"})}})]})]}),e.jsxs(m,{container:!0,spacing:2,children:[e.jsxs(m,{size:6,children:[e.jsx(a,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Stock Quantity"}),e.jsx(u,{fullWidth:!0,type:"number",placeholder:"0",value:s.stock??0,onChange:t=>l("stock",t.target.value===""?0:Number(t.target.value))})]}),e.jsxs(m,{size:6,children:[e.jsx(a,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Return Stock"}),e.jsx(u,{fullWidth:!0,type:"number",placeholder:"0",value:s.returnStock??0,onChange:t=>l("returnStock",t.target.value===""?0:Number(t.target.value))})]})]}),e.jsxs(i,{children:[e.jsxs(a,{variant:"subtitle2",sx:{mb:1.5,fontWeight:800,textTransform:"uppercase",letterSpacing:.5,color:"text.secondary",display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Pricing Rules",Ie&&e.jsx(p,{size:"small",variant:"contained",color:"warning",onClick:Se,startIcon:e.jsx(K,{fontSize:"small"}),sx:{borderRadius:2,textTransform:"none",px:1.5,height:28,fontSize:"0.7rem"},children:"Cleanup Invalid Rules"})]}),e.jsxs(m,{container:!0,spacing:2,children:[e.jsxs(m,{size:12,children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(a,{variant:"subtitle2",sx:{fontWeight:600},children:"Tax Rule"}),s.taxRuleId&&e.jsx(p,{size:"small",onClick:()=>l("taxRuleId",""),sx:{textTransform:"none",py:0,minWidth:"auto",fontWeight:"bold"},children:"Clear"})]}),e.jsxs(u,{select:!0,fullWidth:!0,value:s.taxRuleId||"",onChange:t=>l("taxRuleId",t.target.value),error:!!s.taxRuleId&&!f.some(t=>t.id===s.taxRuleId),helperText:s.taxRuleId&&!f.some(t=>t.id===s.taxRuleId)?"Rule deleted":"",children:[e.jsx(g,{value:"",children:e.jsx("em",{children:"None"})}),f.filter(t=>t.type==="tax").map(t=>e.jsxs(g,{value:t.id,children:[t.label," (",t.value,t.valueType==="percentage"?"%":"",")"]},t.id)),!!s.taxRuleId&&!f.some(t=>t.id===s.taxRuleId)&&e.jsx(g,{value:s.taxRuleId,disabled:!0,children:e.jsxs("em",{children:["Missing: ",s.taxRuleId]})})]})]}),e.jsxs(m,{size:12,children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(a,{variant:"subtitle2",sx:{fontWeight:600},children:"Add-on Costs"}),(s.addonRuleIds||[]).length>0&&e.jsx(p,{size:"small",onClick:()=>l("addonRuleIds",[]),sx:{textTransform:"none",py:0,minWidth:"auto",fontWeight:"bold"},children:"Clear"})]}),e.jsxs(Q,{fullWidth:!0,error:s.addonRuleIds?.some(t=>!f.some(r=>r.id===t)),children:[e.jsx(Me,{children:"Add-on Costs"}),e.jsxs(_,{multiple:!0,value:s.addonRuleIds||[],onChange:t=>{const r=t.target.value;l("addonRuleIds",typeof r=="string"?r.split(","):r)},input:e.jsx($,{label:"Add-on Costs"}),renderValue:t=>e.jsx(i,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(r=>{const n=f.find(o=>o.id===r);return e.jsx(O,{label:n?.label||`Missing: ${r}`,size:"small",color:n?"default":"warning"},r)})}),children:[f.filter(t=>t.type==="addon").map(t=>e.jsxs(g,{value:t.id,children:[e.jsx(D,{checked:(s.addonRuleIds||[]).indexOf(t.id)>-1}),e.jsx(E,{primary:t.label,secondary:`${t.value}${t.valueType==="percentage"?"%":""}`})]},t.id)),s.addonRuleIds?.filter(t=>!f.some(r=>r.id===t)).map(t=>e.jsxs(g,{value:t,disabled:!0,sx:{fontStyle:"italic",opacity:.6},children:[e.jsx(D,{checked:!0}),e.jsx(E,{primary:`Missing: ${t}`})]},t))]})]})]})]})]}),e.jsxs(x,{spacing:2,children:[e.jsxs(i,{children:[e.jsx(a,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Icon"}),e.jsx(u,{select:!0,fullWidth:!0,value:s.icon,onChange:t=>l("icon",t.target.value),InputProps:{startAdornment:e.jsx(y,{position:"start",children:ce.find(t=>t.value===s.icon)?.icon})},children:ce.map(t=>e.jsx(g,{value:t.value,children:e.jsxs(x,{direction:"row",alignItems:"center",spacing:1,children:[t.icon,e.jsx("span",{children:t.label})]})},t.value))})]}),e.jsxs(i,{children:[e.jsx(a,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Image Color"}),e.jsx(x,{direction:"row",spacing:1.5,sx:{overflowX:"auto",py:1},children:at.map(t=>e.jsx(i,{onClick:()=>l("imageColor",t.value),sx:{width:40,height:40,borderRadius:"50%",bgcolor:t.color,border:t.value==="white"?"1px solid #e5e7eb":"none",cursor:"pointer",ring:s.imageColor===t.value?2:0,ringColor:"primary.main",ringOffset:2,boxShadow:1,transition:"all 0.2s",transform:s.imageColor===t.value?"scale(1.1)":"scale(1)"}},t.value))})]})]}),e.jsxs(A,{variant:"outlined",sx:{borderRadius:3,overflow:"hidden"},children:[e.jsxs(i,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px dashed",borderColor:"divider"},children:[e.jsxs(x,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(i,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"primary.light",color:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Qe,{fontSize:"small"})}),e.jsx(a,{fontWeight:500,children:"On Sale"})]}),e.jsx(B,{checked:s.sale,onChange:t=>l("sale",t.target.checked)})]}),e.jsxs(i,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(x,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(i,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"primary.light",color:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(_e,{fontSize:"small"})}),e.jsx(a,{fontWeight:500,children:"New Arrival"})]}),e.jsx(B,{checked:s.isNew,onChange:t=>l("isNew",t.target.checked)})]}),e.jsxs(i,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",borderTop:"1px dashed",borderColor:"divider"},children:[e.jsxs(x,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(i,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"warning.light",color:"warning.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx($e,{fontSize:"small"})}),e.jsxs(i,{children:[e.jsx(a,{fontWeight:500,children:"Complex Variant"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Area-based pricing (x * y * price)"})]})]}),e.jsx(B,{checked:s.isComplexVariant,onChange:t=>l("isComplexVariant",t.target.checked)})]}),s.isComplexVariant&&e.jsx(i,{sx:{p:2,pt:0},children:e.jsx(u,{fullWidth:!0,size:"small",label:"Unit Name",placeholder:"e.g. sq. ft, meter, etc.",value:s.unitName||"",onChange:t=>l("unitName",t.target.value),InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(st,{fontSize:"small"})})}})}),e.jsxs(i,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",borderTop:"1px dashed",borderColor:"divider"},children:[e.jsxs(x,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(i,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"primary.light",color:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ke,{fontSize:"small"})}),e.jsx(a,{fontWeight:500,children:"Stock Trigger"})]}),e.jsx(B,{checked:s.stockTrigger||!1,onChange:t=>l("stockTrigger",t.target.checked)})]}),e.jsx(ne,{in:s.stockTrigger,children:e.jsxs(i,{sx:{p:2,pt:0},children:[e.jsxs(m,{container:!0,spacing:2,children:[e.jsx(m,{size:6,children:e.jsx(u,{fullWidth:!0,size:"small",label:"Trigger Below",type:"number",value:s.triggerBelow??"",onChange:t=>l("triggerBelow",t.target.value===""?void 0:Number(t.target.value))})}),e.jsx(m,{size:6,children:e.jsx(u,{fullWidth:!0,size:"small",label:"Trigger Qty",type:"number",value:s.triggerQty??"",onChange:t=>l("triggerQty",t.target.value===""?void 0:Number(t.target.value))})})]}),e.jsx(i,{sx:{mt:2},children:e.jsxs(u,{select:!0,fullWidth:!0,size:"small",label:"Trigger Supplier",value:s.triggerSupplierId||"",onChange:t=>l("triggerSupplierId",t.target.value),children:[e.jsx(g,{value:"",children:e.jsx("em",{children:"None"})}),F.filter(t=>(s.supplierIds||[]).includes(t.id)).map(t=>e.jsx(g,{value:t.id,children:t.name},t.id))]})})]})})]}),e.jsxs(i,{children:[e.jsx(a,{variant:"h6",sx:{mb:2,fontWeight:"bold"},children:"Available Sizes"}),e.jsxs(x,{spacing:2,children:[s.sizes?.map((t,r)=>e.jsxs(A,{variant:"outlined",sx:{p:2,borderRadius:3,bgcolor:"action.hover",position:"relative"},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(a,{variant:"subtitle2",sx:{fontWeight:800,color:"text.secondary",textTransform:"uppercase",letterSpacing:.5},children:["Variant #",r+1]}),e.jsx(I,{color:"error",onClick:()=>Re(r),size:"small",sx:{bgcolor:"error.light",color:"white","&:hover":{bgcolor:"error.main"},borderRadius:2},children:e.jsx(K,{fontSize:"small"})})]}),e.jsxs(x,{spacing:2,children:[e.jsx(u,{fullWidth:!0,label:"Size Label",placeholder:"e.g. Small, 1kg, etc.",value:t.label,onChange:n=>z(r,"label",n.target.value)}),e.jsx(u,{fullWidth:!0,label:"Purchase Price",placeholder:"0.00",type:"number",value:t.purchasePrice??0,onChange:n=>z(r,"purchasePrice",Number(n.target.value)),InputProps:{startAdornment:e.jsx(y,{position:"start",children:"₹"})}}),e.jsx(u,{fullWidth:!0,label:"Selling Price",placeholder:"0.00",type:"number",value:t.price,onChange:n=>z(r,"price",Number(n.target.value)),InputProps:{startAdornment:e.jsx(y,{position:"start",children:"₹"})}}),e.jsx(u,{fullWidth:!0,label:"Stock Quantity",placeholder:"0",type:"number",value:t.stock??0,onChange:n=>z(r,"stock",Number(n.target.value))}),e.jsx(u,{fullWidth:!0,label:"Return Stock",placeholder:"0",type:"number",value:t.returnStock??0,onChange:n=>z(r,"returnStock",Number(n.target.value))})]})]},r)),e.jsx(p,{variant:"outlined",startIcon:e.jsx(ae,{}),onClick:we,sx:{py:1.5,borderStyle:"dashed",borderWidth:2,borderRadius:3,"&:hover":{borderWidth:2}},children:"Add Size Variant"})]})]})]})})]})}),e.jsx(H,{maxWidth:"sm",sx:{pb:10},children:e.jsxs(i,{sx:{mt:4},children:[e.jsx(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:e.jsx(a,{variant:"h6",sx:{fontWeight:"bold"},children:"Manage Products"})}),e.jsx(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:e.jsx(u,{size:"small",placeholder:"Search name or SKU...",value:N,onChange:t=>te(t.target.value),InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(oe,{fontSize:"small",sx:{opacity:.5}})}),sx:{borderRadius:2,bgcolor:"background.paper"}},sx:{width:"100%"}})}),e.jsx(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:e.jsx(u,{size:"small",placeholder:"Search name or SKU...",value:N,onChange:t=>te(t.target.value),InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(oe,{fontSize:"small",sx:{opacity:.5}})}),sx:{borderRadius:2,bgcolor:"background.paper"}},sx:{width:"100%"}})}),(()=>{const r=xe.filter(c=>{if(!N)return!0;const d=N.toLowerCase();return c.name.toLowerCase().includes(d)||c.sku&&c.sku.toLowerCase().includes(d)}).reduce((c,d)=>{let h="Uncategorized";if(d.categoryId){const v=W.find(P=>P.id===d.categoryId);v&&(h=v.name)}return c[h]||(c[h]=[]),c[h].push(d),c},{}),n=Object.keys(r).sort(),o=Y.filter(c=>c!=="All Items"&&!r[c]).sort(),R=[...n,...o],b=[];return n.forEach(c=>{const d=[...r[c]].sort((v,P)=>v.name.localeCompare(P.name)),h=!!L[c];b.push({type:"header",cat:c,count:d.length,isExpanded:h}),h&&(d.forEach(v=>b.push({type:"product",product:v})),d.length===0&&b.push({type:"empty",cat:c}))}),o.length>0&&(b.push({type:"divider",label:"Empty Categories"}),o.forEach(c=>{const d=!!L[c];b.push({type:"header",cat:c,count:0,isExpanded:d}),d&&b.push({type:"empty",cat:c})})),e.jsxs(e.Fragment,{children:[R.length>0&&e.jsxs(i,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(p,{size:"small",variant:"outlined",onClick:()=>ve(R),sx:{borderRadius:2,textTransform:"none",fontWeight:"bold",fontSize:"0.75rem"},children:"Expand All"}),e.jsx(p,{size:"small",variant:"outlined",onClick:ye,sx:{borderRadius:2,textTransform:"none",fontWeight:"bold",fontSize:"0.75rem"},children:"Collapse All"})]}),e.jsx(i,{sx:{width:"100%"},children:e.jsx(Fe,{useWindowScroll:!0,increaseViewportBy:300,data:b,itemContent:(c,d)=>{if(d.type==="header")return e.jsx(i,{sx:{py:.5},children:e.jsxs(i,{onClick:()=>be(d.cat),sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1.5,bgcolor:"action.selected",borderRadius:2,cursor:"pointer"},children:[e.jsxs(a,{variant:"subtitle1",sx:{fontWeight:"bold",display:"flex",alignItems:"center",gap:1},children:[d.cat,e.jsx(O,{size:"small",label:d.count,sx:{fontWeight:"bold"}})]}),e.jsx(I,{size:"small",sx:{transform:d.isExpanded?"rotate(180deg)":"none",transition:"transform 0.3s"},children:e.jsx(ie,{})})]})});if(d.type==="product"){const h=d.product;return e.jsx(i,{sx:{py:1},children:e.jsx(A,{variant:"outlined",sx:{p:2,borderRadius:2},children:e.jsxs(x,{direction:"row",spacing:2,alignItems:"center",children:[h.src?e.jsx(i,{component:"img",src:h.src,sx:{width:60,height:60,objectFit:"cover",borderRadius:2,bgcolor:"action.hover"}}):e.jsx(i,{sx:{width:60,height:60,borderRadius:2,bgcolor:"action.hover",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(le,{sx:{opacity:.3}})}),e.jsxs(i,{flex:1,children:[e.jsx(a,{fontWeight:600,children:h.name}),e.jsxs(a,{variant:"body2",color:"text.secondary",children:["₹",h.price]}),e.jsx(x,{direction:"row",spacing:1,alignItems:"center",children:e.jsx(a,{variant:"caption",color:"text.secondary",children:(()=>{if(h.categoryId){const v=W.find(P=>P.id===h.categoryId);if(v)return v.name}return"Uncategorized"})()})}),h.sku&&e.jsxs(a,{variant:"caption",color:"text.secondary",children:["SKU: ",h.sku]})]}),e.jsx(I,{size:"small",onClick:()=>ke(h),children:e.jsx(Ge,{})}),e.jsx(I,{size:"small",color:"error",onClick:()=>We(h.id),children:e.jsx(K,{})})]})})})}return d.type==="empty"?e.jsx(a,{variant:"body2",color:"text.secondary",sx:{fontStyle:"italic",px:1,py:1},children:"No products in this category."}):d.type==="divider"?e.jsxs(i,{sx:{display:"flex",alignItems:"center",my:3},children:[e.jsx(de,{sx:{flex:1}}),e.jsx(a,{variant:"caption",sx:{px:2,fontWeight:"bold",color:"text.secondary",textTransform:"uppercase"},children:d.label}),e.jsx(de,{sx:{flex:1}})]}):null}})})]})})()]})}),e.jsx(A,{sx:{position:"fixed",bottom:0,left:0,right:0,p:2,bgcolor:"background.paper",borderTop:1,borderColor:"divider",zIndex:1400},elevation:4,children:e.jsx(H,{maxWidth:"sm",children:e.jsx(p,{fullWidth:!0,variant:"contained",size:"large",startIcon:e.jsx(qe,{}),onClick:Pe,sx:{height:56,borderRadius:3,fontSize:"1.1rem",fontWeight:"bold",boxShadow:2},children:w?"Update Product":"Save Product"})})}),e.jsxs(Ye,{open:je,onClose:()=>T(!1),PaperProps:{sx:{borderRadius:3,p:1}},children:[e.jsx(Xe,{sx:{fontWeight:"bold"},children:"Delete Product?"}),e.jsx(Je,{children:e.jsx(Ze,{children:"Are you sure you want to delete this product? This action is permanent and cannot be undone."})}),e.jsxs(et,{sx:{p:2},children:[e.jsx(p,{onClick:()=>T(!1),color:"inherit",sx:{fontWeight:"bold"},children:"Cancel"}),e.jsx(p,{onClick:ze,variant:"contained",color:"error",sx:{fontWeight:"bold",borderRadius:2},children:"Delete"})]})]})]})}export{Mt as component};
