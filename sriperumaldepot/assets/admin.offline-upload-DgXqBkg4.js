import{a3 as ne,a4 as re,r as f,a5 as ie,a6 as le,z as M,D as k,F as z,j as t,H as N,J as H,L as A,h as b,M as W,K as D,a7 as ce,f as de,b as pe,B as j,Z as F,S as P,l as ue,I as fe,C as xe,n as J,o as _,q as he,s as me,v as ge,a8 as be,w as ye,y as ve}from"./index-Dg6OSMVy.js";import{H as je}from"./Header-CvAsREaK.js";import{P as Ce}from"./Page-Bty_NVZI.js";import{C as E}from"./CloudUpload-CpzwS5Qp.js";import{B as $}from"./Button-DK2hI-ka.js";import{A as Te}from"./Alert-DqzrpwJn.js";import{C as we}from"./CardContent-foe8WI7a.js";import{C}from"./Chip-B3gwcAKH.js";import{C as K}from"./CheckCircle-DtFTexqj.js";import{D as Se}from"./Divider-CdYamF3_.js";import{P as Re}from"./Person-CC6Wk_sR.js";import{P as Me}from"./Phone-CXd2-JgR.js";import{S as ke}from"./ShoppingBag-Dg5FyH16.js";import{D as V}from"./Delete-QIIdIStH.js";import"./Grid-Bo2RbQY_.js";import"./isMuiElement-DXVAVI3f.js";import"./dividerClasses-Ct_9BTYH.js";function ze(e,a,o,r,c){const[n,l]=f.useState(()=>c&&o?o(e).matches:r?r(e).matches:a);return le(()=>{if(!o)return;const i=o(e),p=()=>{l(i.matches)};return p(),i.addEventListener("change",p),()=>{i.removeEventListener("change",p)}},[e,o]),n}const Ne={...ie},se=Ne.useSyncExternalStore;function He(e,a,o,r,c){const n=f.useCallback(()=>a,[a]),l=f.useMemo(()=>{if(c&&o)return()=>o(e).matches;if(r!==null){const{matches:u}=r(e);return()=>u}return n},[n,e,r,c,o]),[i,p]=f.useMemo(()=>{if(o===null)return[n,()=>()=>{}];const u=o(e);return[()=>u.matches,h=>(u.addEventListener("change",h),()=>{u.removeEventListener("change",h)})]},[n,o,e]);return se(p,i,l)}function oe(e={}){const{themeId:a}=e;return function(r,c={}){let n=ne();n&&a&&(n=n[a]||n);const l=typeof window<"u"&&typeof window.matchMedia<"u",{defaultMatches:i=!1,matchMedia:p=l?window.matchMedia:null,ssrMatchMedia:g=null,noSsr:u=!1}=re({name:"MuiUseMediaQuery",props:c,theme:n});let h=typeof r=="function"?r(n):r;return h=h.replace(/^@media( ?)/m,""),h.includes("print")&&console.warn(["MUI: You have provided a `print` query to the `useMediaQuery` hook.","Using the print media query to modify print styles can lead to unexpected results.","Consider using the `displayPrint` field in the `sx` prop instead.","More information about `displayPrint` on our docs: https://mui.com/system/display/#display-in-print."].join(`
`)),(se!==void 0?He:ze)(h,i,p,g,u)}}oe();function Ae(e){return M("MuiAlertTitle",e)}k("MuiAlertTitle",["root"]);const De=e=>{const{classes:a}=e;return A({root:["root"]},Ae,a)},Ie=N(b,{name:"MuiAlertTitle",slot:"Root"})(W(({theme:e})=>({fontWeight:e.typography.fontWeightMedium,marginTop:-2}))),Ue=f.forwardRef(function(a,o){const r=z({props:a,name:"MuiAlertTitle"}),{className:c,...n}=r,l=r,i=De(l);return t.jsx(Ie,{gutterBottom:!0,component:"div",ownerState:l,ref:o,className:H(i.root,c),...n})}),ae=f.createContext();function $e(e){return M("MuiTable",e)}k("MuiTable",["root","stickyHeader"]);const Pe=e=>{const{classes:a,stickyHeader:o}=e;return A({root:["root",o&&"stickyHeader"]},$e,a)},We=N("table",{name:"MuiTable",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:o}=e;return[a.root,o.stickyHeader&&a.stickyHeader]}})(W(({theme:e})=>({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":{...e.typography.body2,padding:e.spacing(2),color:(e.vars||e).palette.text.secondary,textAlign:"left",captionSide:"bottom"},variants:[{props:({ownerState:a})=>a.stickyHeader,style:{borderCollapse:"separate"}}]}))),X="table",Oe=f.forwardRef(function(a,o){const r=z({props:a,name:"MuiTable"}),{className:c,component:n=X,padding:l="normal",size:i="medium",stickyHeader:p=!1,...g}=r,u={...r,component:n,padding:l,size:i,stickyHeader:p},h=Pe(u),S=f.useMemo(()=>({padding:l,size:i,stickyHeader:p}),[l,i,p]);return t.jsx(ae.Provider,{value:S,children:t.jsx(We,{as:n,role:n===X?null:"table",ref:o,className:H(h.root,c),ownerState:u,...g})})}),O=f.createContext();function Be(e){return M("MuiTableBody",e)}k("MuiTableBody",["root"]);const Ee=e=>{const{classes:a}=e;return A({root:["root"]},Be,a)},Le=N("tbody",{name:"MuiTableBody",slot:"Root"})({display:"table-row-group"}),Qe={variant:"body"},Y="tbody",Fe=f.forwardRef(function(a,o){const r=z({props:a,name:"MuiTableBody"}),{className:c,component:n=Y,...l}=r,i={...r,component:n},p=Ee(i);return t.jsx(O.Provider,{value:Qe,children:t.jsx(Le,{className:H(p.root,c),as:n,ref:o,role:n===Y?null:"rowgroup",ownerState:i,...l})})});function Je(e){return M("MuiTableCell",e)}const _e=k("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),Ke=e=>{const{classes:a,variant:o,align:r,padding:c,size:n,stickyHeader:l}=e,i={root:["root",o,l&&"stickyHeader",r!=="inherit"&&`align${D(r)}`,c!=="normal"&&`padding${D(c)}`,`size${D(n)}`]};return A(i,Je,a)},Ve=N("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:o}=e;return[a.root,a[o.variant],a[`size${D(o.size)}`],o.padding!=="normal"&&a[`padding${D(o.padding)}`],o.align!=="inherit"&&a[`align${D(o.align)}`],o.stickyHeader&&a.stickyHeader]}})(W(({theme:e})=>({...e.typography.body2,display:"table-cell",verticalAlign:"inherit",borderBottom:e.vars?`1px solid ${e.vars.palette.TableCell.border}`:`1px solid
    ${e.palette.mode==="light"?e.lighten(e.alpha(e.palette.divider,1),.88):e.darken(e.alpha(e.palette.divider,1),.68)}`,textAlign:"left",padding:16,variants:[{props:{variant:"head"},style:{color:(e.vars||e).palette.text.primary,lineHeight:e.typography.pxToRem(24),fontWeight:e.typography.fontWeightMedium}},{props:{variant:"body"},style:{color:(e.vars||e).palette.text.primary}},{props:{variant:"footer"},style:{color:(e.vars||e).palette.text.secondary,lineHeight:e.typography.pxToRem(21),fontSize:e.typography.pxToRem(12)}},{props:{size:"small"},style:{padding:"6px 16px",[`&.${_e.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}}},{props:{padding:"checkbox"},style:{width:48,padding:"0 0 0 4px"}},{props:{padding:"none"},style:{padding:0}},{props:{align:"left"},style:{textAlign:"left"}},{props:{align:"center"},style:{textAlign:"center"}},{props:{align:"right"},style:{textAlign:"right",flexDirection:"row-reverse"}},{props:{align:"justify"},style:{textAlign:"justify"}},{props:({ownerState:a})=>a.stickyHeader,style:{position:"sticky",top:0,zIndex:2,backgroundColor:(e.vars||e).palette.background.default}}]}))),y=f.forwardRef(function(a,o){const r=z({props:a,name:"MuiTableCell"}),{align:c="inherit",className:n,component:l,padding:i,scope:p,size:g,sortDirection:u,variant:h,...S}=r,v=f.useContext(ae),T=f.useContext(O),I=T&&T.variant==="head";let s;l?s=l:s=I?"th":"td";let d=p;s==="td"?d=void 0:!d&&I&&(d="col");const m=h||T&&T.variant,x={...r,align:c,component:s,padding:i||(v&&v.padding?v.padding:"normal"),size:g||(v&&v.size?v.size:"medium"),sortDirection:u,stickyHeader:m==="head"&&v&&v.stickyHeader,variant:m},w=Ke(x);let R=null;return u&&(R=u==="asc"?"ascending":"descending"),t.jsx(Ve,{as:s,ref:o,className:H(w.root,n),"aria-sort":R,scope:d,ownerState:x,...S})});function Xe(e){return M("MuiTableContainer",e)}k("MuiTableContainer",["root"]);const Ye=e=>{const{classes:a}=e;return A({root:["root"]},Xe,a)},Ze=N("div",{name:"MuiTableContainer",slot:"Root"})({width:"100%",overflowX:"auto"}),qe=f.forwardRef(function(a,o){const r=z({props:a,name:"MuiTableContainer"}),{className:c,component:n="div",...l}=r,i={...r,component:n},p=Ye(i);return t.jsx(Ze,{ref:o,as:n,className:H(p.root,c),ownerState:i,...l})});function Ge(e){return M("MuiTableHead",e)}k("MuiTableHead",["root"]);const et=e=>{const{classes:a}=e;return A({root:["root"]},Ge,a)},tt=N("thead",{name:"MuiTableHead",slot:"Root"})({display:"table-header-group"}),st={variant:"head"},Z="thead",ot=f.forwardRef(function(a,o){const r=z({props:a,name:"MuiTableHead"}),{className:c,component:n=Z,...l}=r,i={...r,component:n},p=et(i);return t.jsx(O.Provider,{value:st,children:t.jsx(tt,{as:n,className:H(p.root,c),ref:o,role:n===Z?null:"rowgroup",ownerState:i,...l})})});function at(e){return M("MuiTableRow",e)}const q=k("MuiTableRow",["root","selected","hover","head","footer"]),nt=e=>{const{classes:a,selected:o,hover:r,head:c,footer:n}=e;return A({root:["root",o&&"selected",r&&"hover",c&&"head",n&&"footer"]},at,a)},rt=N("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:o}=e;return[a.root,o.head&&a.head,o.footer&&a.footer]}})(W(({theme:e})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${q.hover}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${q.selected}`]:{backgroundColor:e.alpha((e.vars||e).palette.primary.main,(e.vars||e).palette.action.selectedOpacity),"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.primary.main,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`)}}}))),G="tr",ee=f.forwardRef(function(a,o){const r=z({props:a,name:"MuiTableRow"}),{className:c,component:n=G,hover:l=!1,selected:i=!1,...p}=r,g=f.useContext(O),u={...r,component:n,hover:l,selected:i,head:g&&g.variant==="head",footer:g&&g.variant==="footer"},h=nt(u);return t.jsx(rt,{as:n,ref:o,className:H(h.root,c),role:n===G?null:"row",ownerState:u,...p})}),it=oe({themeId:ce}),te=de(t.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}));function Rt(){const[e,a]=f.useState(!1),[o,r]=f.useState([]),[c,n]=f.useState(!1),l=pe(),i=it(l.breakpoints.down("sm")),p=s=>!s.items||!Array.isArray(s.items)?"Missing or invalid items array":typeof s.total!="number"?"Missing or invalid total price":!s.shippingDetails||!s.shippingDetails.phoneNumber?"Missing shipping details or phone number":null,g=async s=>{if(!s)return!1;const d=ge(J(_,"orders"),ye("offlineId","==",s),be(1));return!(await ve(d)).empty},u=async s=>{const d=s.target.files;if(!d||d.length===0)return;const m=[];for(let x=0;x<d.length;x++){const w=d[x];try{const R=await w.text(),U=JSON.parse(R),L=p(U);let B=L?"invalid":"valid",Q=L||void 0;B==="valid"&&U.offlineId&&await g(U.offlineId)&&(B="duplicate",Q="This order has already been synced."),m.push({fileName:w.name,data:U,status:B,error:Q})}catch{m.push({fileName:w.name,data:null,status:"invalid",error:"Failed to parse JSON"})}}r(x=>[...x,...m]),n(!0),s.target.value=""},h=async()=>{a(!0);const s=J(_,"orders"),d=[...o];for(let m=0;m<d.length;m++){const x=d[m];if(x.status==="valid")try{if(x.data.offlineId&&await g(x.data.offlineId)){d[m]={...x,status:"duplicate",error:"Already synced."};continue}const{id:w,...R}=x.data;await he(s,{...R,timestamp:me(),offlineTimestamp:x.data.timestamp||new Date().toISOString(),isOfflineUpload:!0}),d[m]={...x,status:"success"}}catch(w){d[m]={...x,status:"error",error:w.message}}}r(d),a(!1)},S=s=>{r(d=>d.filter((m,x)=>x!==s)),o.length<=1&&n(!1)},v=()=>{r([]),n(!1)},T=o.filter(s=>s.status==="valid").length,I=o.filter(s=>s.status==="success").length;return t.jsxs(j,{sx:{bgcolor:"background.default",minHeight:"100vh",pb:5},children:[t.jsx(je,{title:"Offline Order Sync"}),t.jsx(Ce,{children:t.jsxs(j,{sx:{p:2},children:[t.jsx(b,{variant:"h5",sx:{mb:1,fontWeight:"bold"},children:"Sync Offline Orders"}),t.jsx(b,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Upload the .json files generated while placing orders in offline mode."}),c?t.jsxs(P,{spacing:2,children:[t.jsxs(Te,{severity:"info",variant:"outlined",sx:{borderRadius:2},children:[t.jsxs(Ue,{sx:{fontWeight:"bold"},children:[o.length," Order(s) Loaded"]}),T>0?`${T} valid orders ready for sync.`:"No valid orders found in the selected files.",I>0&&` | ${I} successfully uploaded!`]}),i?t.jsx(P,{spacing:2,children:o.map((s,d)=>t.jsx(ue,{sx:{borderRadius:3,border:1,borderColor:"divider",boxShadow:"none"},children:t.jsxs(we,{sx:{p:2,"&:last-child":{pb:2}},children:[t.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1.5},children:[t.jsxs(j,{children:[t.jsx(b,{variant:"caption",color:"text.secondary",sx:{textTransform:"uppercase",letterSpacing:1},children:s.fileName}),t.jsxs(b,{variant:"h6",sx:{fontWeight:"bold"},children:["₹",s.data?.total||0]})]}),t.jsxs(j,{children:[s.status==="valid"&&t.jsx(C,{label:"Ready",color:"info",size:"small"}),s.status==="invalid"&&t.jsx(C,{label:"Invalid",color:"error",size:"small"}),s.status==="duplicate"&&t.jsx(C,{label:"Duplicate",color:"warning",size:"small",title:s.error}),s.status==="success"&&t.jsx(C,{label:"Sync OK",color:"success",size:"small",icon:t.jsx(K,{sx:{fontSize:"1rem !important"}})}),s.status==="error"&&t.jsx(C,{label:"Failed",color:"error",size:"small",icon:t.jsx(te,{sx:{fontSize:"1rem !important"}})})]})]}),t.jsx(Se,{sx:{mb:1.5}}),t.jsxs(P,{spacing:1,children:[t.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(Re,{sx:{fontSize:16,color:"text.secondary"}}),t.jsx(b,{variant:"body2",children:s.data?.shippingDetails?.firstName||"N/A"})]}),t.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(Me,{sx:{fontSize:16,color:"text.secondary"}}),t.jsx(b,{variant:"body2",children:s.data?.shippingDetails?.phoneNumber||"N/A"})]}),t.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(ke,{sx:{fontSize:16,color:"text.secondary"}}),t.jsxs(b,{variant:"body2",children:[s.data?.items?.length||0," Items"]})]})]}),(s.status==="invalid"||s.status==="error")&&t.jsxs(b,{variant:"caption",color:"error",sx:{mt:1,display:"block"},children:["Error: ",s.error]}),s.status!=="success"&&s.status!=="error"&&t.jsx(j,{sx:{mt:2,display:"flex",justifyContent:"flex-end"},children:t.jsx($,{size:"small",color:"error",startIcon:t.jsx(V,{}),onClick:()=>S(d),disabled:e,children:"Remove"})})]})},d))}):t.jsx(qe,{component:F,sx:{borderRadius:3,border:1,borderColor:"divider",boxShadow:"none"},children:t.jsxs(Oe,{children:[t.jsx(ot,{sx:{bgcolor:"action.hover"},children:t.jsxs(ee,{children:[t.jsx(y,{sx:{fontWeight:"bold"},children:"File / ID"}),t.jsx(y,{sx:{fontWeight:"bold"},children:"Customer"}),t.jsx(y,{sx:{fontWeight:"bold"},children:"Items"}),t.jsx(y,{sx:{fontWeight:"bold"},children:"Total"}),t.jsx(y,{sx:{fontWeight:"bold"},children:"Status"}),t.jsx(y,{sx:{fontWeight:"bold"},align:"right",children:"Action"})]})}),t.jsx(Fe,{children:o.map((s,d)=>t.jsxs(ee,{children:[t.jsxs(y,{children:[t.jsx(b,{variant:"body2",sx:{fontWeight:500},children:s.fileName}),t.jsx(b,{variant:"caption",color:"text.secondary",children:s.data?.timestamp?new Date(s.data.timestamp).toLocaleString():"N/A"})]}),t.jsxs(y,{children:[s.data?.shippingDetails?.firstName||"N/A",t.jsx(b,{variant:"caption",display:"block",color:"text.secondary",children:s.data?.shippingDetails?.phoneNumber})]}),t.jsx(y,{children:s.data?.items?.length||0}),t.jsxs(y,{sx:{fontWeight:"bold"},children:["₹",s.data?.total?.toLocaleString()||0]}),t.jsxs(y,{children:[s.status==="valid"&&t.jsx(C,{label:"Ready",color:"info",variant:"outlined",size:"small"}),s.status==="invalid"&&t.jsx(C,{label:"Invalid",color:"error",variant:"outlined",size:"small",title:s.error}),s.status==="duplicate"&&t.jsx(C,{label:"Duplicate",color:"warning",variant:"outlined",size:"small",title:s.error}),s.status==="success"&&t.jsx(C,{label:"Synced",color:"success",size:"small",icon:t.jsx(K,{})}),s.status==="error"&&t.jsx(C,{label:"Failed",color:"error",size:"small",icon:t.jsx(te,{}),title:s.error})]}),t.jsx(y,{align:"right",children:s.status!=="success"&&t.jsx(fe,{color:"error",size:"small",onClick:()=>S(d),disabled:e,children:t.jsx(V,{})})})]},d))})]})}),t.jsxs(P,{direction:i?"column":"row",spacing:2,justifyContent:"space-between",sx:{mt:2},children:[t.jsx($,{variant:"outlined",color:"inherit",onClick:v,disabled:e,fullWidth:i,sx:{borderRadius:10,textTransform:"none"},children:"Cancel & Clear"}),t.jsxs(j,{sx:{display:"flex",gap:2},children:[t.jsxs($,{variant:"outlined",component:"label",disabled:e,fullWidth:i,sx:{borderRadius:10,textTransform:"none"},children:["Add More Files",t.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".json",onChange:u})]}),t.jsx($,{variant:"contained",color:"primary",onClick:h,disabled:e||T===0,fullWidth:i,startIcon:e?t.jsx(xe,{size:20,color:"inherit"}):t.jsx(E,{}),sx:{borderRadius:10,px:4,textTransform:"none",fontWeight:"bold"},children:e?"Syncing...":`Sync ${T} Orders`})]})]})]}):t.jsxs(F,{sx:{p:6,textAlign:"center",border:"2px dashed",borderColor:"primary.main",borderRadius:4,bgcolor:"rgba(25, 118, 210, 0.02)",transition:"all 0.3s","&:hover":{bgcolor:"rgba(25, 118, 210, 0.05)",borderColor:"primary.dark"}},children:[t.jsx(E,{sx:{fontSize:80,color:"primary.main",mb:2,opacity:.8}}),t.jsx(b,{variant:"h6",sx:{mb:1,fontWeight:"bold"},children:"Ready to upload"}),t.jsx(b,{variant:"body2",sx:{mb:4,color:"text.secondary",maxWidth:300,mx:"auto"},children:"Drag and drop your order files here or click the button below to browse."}),t.jsxs($,{variant:"contained",component:"label",size:"large",startIcon:t.jsx(E,{}),sx:{borderRadius:10,px:4,py:1.5,textTransform:"none",fontSize:"1rem",fontWeight:"bold"},children:["Browse Files",t.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".json",onChange:u})]})]})]})})]})}export{Rt as component};
