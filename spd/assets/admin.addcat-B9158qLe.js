import{r as l,o as x,j as e,B as s,I as p,h as i,S as c,E as X,l as Z,C as ee,a7 as I,am as te,an as re,ao as se,ap as oe}from"./index-CBou6moi.js";import{u as ie}from"./productStore-SIWeptSc.js";import{u as ae}from"./pricingStore-CjE7w1mK.js";import{Y as ne}from"./index-DWku4nr_.js";import{A as le,T as de,a as ce}from"./ArrowBackIosNew-CIbvTB3E.js";import{B as f}from"./Button-BflV7euM.js";import{C as w}from"./Container-DtrslpOQ.js";import{A as xe}from"./AddCircle-cTCxnp_u.js";import{T as h,F as he,i as me,S as pe,O as ue}from"./TextField-RXHFbKtb.js";import{I as E}from"./InputAdornment-DpBsnqo5.js";import{C as ge}from"./CloudUpload-ticYINSt.js";import{I as P,P as fe,N as je}from"./Percent-C7_2zPTU.js";import{G as R}from"./Grid-IWINzjQb.js";import{M as S}from"./MenuItem-CGHN6H8j.js";import{C as be}from"./Checkbox-BKxSD9Yg.js";import{L as ye}from"./ListItemText-BtKz7UBn.js";import{C as Ce}from"./Chip-BXUFp7Xu.js";import{S as F}from"./Switch-DDTesXnY.js";import{S as ve}from"./Search-DEj_P3US.js";import{E as Ie}from"./Edit-FTKVc5Ef.js";import{D as we}from"./Delete-DRnHzxX1.js";import{S as Re}from"./Save-BYobhu1a.js";import{D as Se,a as ke,b as De}from"./DialogTitle-f2PvcPNk.js";import{D as We}from"./DialogContentText-QZEy0qxP.js";import{D as Te}from"./DialogActions-BLBSxaJt.js";import"./isMuiElement-fD2fXW9_.js";import"./listItemTextClasses-CNe8SJtV.js";import"./dividerClasses-aUSE17Cl.js";import"./SwitchBase-C11Fma45.js";function at(){const{pushCategorytoDb:N,updateCategory:B,deleteCategory:U,categoryItems:L,fetchProducts:j}=ie(),{rules:b,fetchRules:O}=ae();l.useEffect(()=>{j(),O()},[]);const[m,k]=l.useState(null),[y,C]=l.useState(!1),[M,u]=l.useState(!1),[D,W]=l.useState(null),[v,_]=l.useState(""),[o,g]=l.useState({name:"",sku:"",id:x(),imgRefId:x(),category:"",detail:"",price:0,icon:"fitness_center",imageColor:"black",src:"",sale:!1,isNew:!0,sizes:[],categoryOnly:!0,taxRuleId:"",addonRuleIds:[]}),n=(t,r)=>{g(a=>({...a,[t]:r}))},[$,T]=l.useState(!1),A=l.useRef(null),G=async t=>{const r=t.target.files?.[0];if(r){T(!0);try{const a=te(re,`categories/${x()}_${r.name}`),d={customMetadata:{imgRefId:String(o.imgRefId),categoryName:String(o.name||"unnamed")}},q=await se(a,r,d),H=await oe(q.ref);g(J=>({...J,src:H}))}catch(a){console.error("Error uploading image: ",a),alert("Failed to upload image.")}finally{T(!1)}}},K=async()=>{try{const t=Object.entries(o).reduce((r,[a,d])=>(d!==void 0&&(typeof d=="string"?r[a]=d.trim():r[a]=d),r),{});if(t.category=t.name,console.log("Saving category...",t),!t.name||!t.detail){alert("Please fill all details");return}m?(await B(t),alert("Category updated successfully!")):(await N(t),alert("Category saved successfully!")),await j(),z()}catch(t){console.error("Error saving category:",t),alert("Failed to save category")}},Q=t=>{g({...t,categoryOnly:!0,imgRefId:t.imgRefId||x()}),k(t.id),C(!0),window.scrollTo({top:0,behavior:"smooth"})},V=t=>{W(t),u(!0)},Y=async()=>{D&&(await U(D),await j(),u(!1),W(null))},z=()=>{g({name:"",sku:"",id:x(),imgRefId:x(),category:"",detail:"",price:0,icon:"fitness_center",imageColor:"black",src:"",sale:!1,isNew:!0,sizes:[],categoryOnly:!0,taxRuleId:"",addonRuleIds:[]}),k(null),C(!1),window.scrollTo({top:0,behavior:"smooth"})};return e.jsxs(s,{sx:{minHeight:"100vh",bgcolor:"background.default",pb:10},children:[e.jsx(le,{position:"sticky",color:"default",elevation:0,sx:{bgcolor:"background.paper",borderBottom:1,borderColor:"divider"},children:e.jsxs(de,{children:[e.jsx(p,{onClick:()=>window.history.back(),edge:"start",children:e.jsx(ce,{})}),e.jsx(i,{variant:"h6",component:"h1",sx:{flexGrow:1,textAlign:"center",pr:5,fontWeight:"bold"},children:m?"Edit Category":"Add Category"}),m&&e.jsx(f,{color:"inherit",onClick:z,children:"Cancel Edit"})]})}),e.jsx(w,{maxWidth:"sm",sx:{py:3,display:"flex",flexDirection:"column",gap:3},children:e.jsxs(s,{sx:{border:1,borderColor:"divider",borderRadius:3,overflow:"hidden",bgcolor:"background.paper"},children:[e.jsxs(s,{onClick:()=>C(!y),sx:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",p:2,bgcolor:"action.hover",transition:"background-color 0.2s","&:hover":{bgcolor:"action.selected"}},children:[e.jsxs(c,{direction:"row",spacing:1.5,alignItems:"center",children:[e.jsx(xe,{color:"primary"}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:"bold"},children:m?"Edit Category Details":"Add New Category"})]}),e.jsx(p,{size:"small",sx:{transform:y?"rotate(180deg)":"none",transition:"transform 0.3s"},children:e.jsx(X,{})})]}),e.jsx(Z,{in:y,children:e.jsxs(s,{sx:{p:2,display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(s,{children:[e.jsx(i,{variant:"subtitle2",sx:{mb:1,fontWeight:"bold",textTransform:"uppercase"},children:"Category Image"}),e.jsx(h,{fullWidth:!0,placeholder:"Paste image URL or upload...",value:o.src??"",onChange:t=>n("src",t.target.value),InputProps:{endAdornment:e.jsxs(E,{position:"end",children:[e.jsx(p,{onClick:()=>A.current?.click(),edge:"end",children:$?e.jsx(ee,{size:24}):e.jsx(ge,{color:"primary"})}),e.jsx("input",{type:"file",hidden:!0,ref:A,accept:"image/*",onChange:G})]}),sx:{borderRadius:3}}}),e.jsx(s,{sx:{mt:2,height:160,borderRadius:3,border:"2px dashed",borderColor:"divider",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",bgcolor:"action.hover"},children:o.src?e.jsx(s,{component:"img",src:o.src,sx:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsxs(e.Fragment,{children:[e.jsx(P,{sx:{fontSize:40,opacity:.5,mb:1}}),e.jsx(i,{variant:"caption",sx:{opacity:.7},children:"Image preview will appear here"})]})})]}),e.jsxs(c,{spacing:2,children:[e.jsxs(c,{direction:"row",spacing:2,children:[e.jsxs(s,{flex:1,children:[e.jsx(i,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Category Name"}),e.jsx(h,{fullWidth:!0,placeholder:"Category Label",value:o.name??"",onChange:t=>{n("name",t.target.value),n("category",t.target.value)}})]}),e.jsxs(s,{width:140,children:[e.jsx(i,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"SKU ID"}),e.jsx(h,{fullWidth:!0,placeholder:"CAT-001",value:o.sku??"",onChange:t=>n("sku",t.target.value)})]})]}),e.jsxs(s,{children:[e.jsx(i,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"Detail"}),e.jsx(h,{fullWidth:!0,multiline:!0,minRows:3,placeholder:"Describe the category features...",value:o.detail??"",onChange:t=>n("detail",t.target.value)})]})]}),e.jsx(s,{sx:{my:1,borderTop:1,borderColor:"divider",borderStyle:"dashed"}}),e.jsxs(R,{container:!0,spacing:2,children:[e.jsx(R,{size:6,children:e.jsxs(h,{select:!0,fullWidth:!0,label:"Default Tax Rule",value:o.taxRuleId||"",onChange:t=>n("taxRuleId",t.target.value),children:[e.jsx(S,{value:"",children:e.jsx("em",{children:"None"})}),b.filter(t=>t.type==="tax").map(t=>e.jsxs(S,{value:t.id,children:[t.label," (",t.value,t.valueType==="percentage"?"%":"",")"]},t.id))]})}),e.jsx(R,{size:6,children:e.jsxs(he,{fullWidth:!0,children:[e.jsx(me,{children:"Default Add-on Costs"}),e.jsx(pe,{multiple:!0,value:o.addonRuleIds||[],onChange:t=>{const r=t.target.value;n("addonRuleIds",typeof r=="string"?r.split(","):r)},input:e.jsx(ue,{label:"Default Add-on Costs"}),renderValue:t=>e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(r=>{const a=b.find(d=>d.id===r);return e.jsx(Ce,{label:a?.label||r,size:"small"},r)})}),children:b.filter(t=>t.type==="addon").map(t=>e.jsxs(S,{value:t.id,children:[e.jsx(be,{checked:(o.addonRuleIds||[]).indexOf(t.id)>-1}),e.jsx(ye,{primary:t.label,secondary:`${t.value}${t.valueType==="percentage"?"%":""}`})]},t.id))})]})})]}),e.jsxs(I,{variant:"outlined",sx:{borderRadius:3,overflow:"hidden"},children:[e.jsxs(s,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px dashed",borderColor:"divider"},children:[e.jsxs(c,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(s,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"primary.light",color:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(fe,{fontSize:"small"})}),e.jsx(i,{fontWeight:500,children:"On Sale"})]}),e.jsx(F,{checked:o.sale??!1,onChange:t=>n("sale",t.target.checked)})]}),e.jsxs(s,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(c,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(s,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"primary.light",color:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(je,{fontSize:"small"})}),e.jsx(i,{fontWeight:500,children:"New Arrival"})]}),e.jsx(F,{checked:o.isNew??!0,onChange:t=>n("isNew",t.target.checked)})]})]})]})})]})}),e.jsx(w,{maxWidth:"sm",sx:{pb:10},children:e.jsxs(s,{sx:{mt:4},children:[e.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:e.jsx(i,{variant:"h6",sx:{fontWeight:"bold"},children:"Manage Categories"})}),e.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:e.jsx(h,{size:"small",placeholder:"Search name or SKU...",value:v,onChange:t=>_(t.target.value),InputProps:{startAdornment:e.jsx(E,{position:"start",children:e.jsx(ve,{fontSize:"small",sx:{opacity:.5}})}),sx:{borderRadius:2,bgcolor:"background.paper"}},sx:{width:"100%"}})}),e.jsx(s,{sx:{width:"100%"},children:e.jsx(ne,{useWindowScroll:!0,increaseViewportBy:300,data:L.filter(t=>{if(!v)return!0;const r=v.toLowerCase();return t.name.toLowerCase().includes(r)||t.sku&&t.sku.toLowerCase().includes(r)}),itemContent:(t,r)=>e.jsx(s,{sx:{py:1},children:e.jsx(I,{variant:"outlined",sx:{p:2,borderRadius:2},children:e.jsxs(c,{direction:"row",spacing:2,alignItems:"center",children:[r.src?e.jsx(s,{component:"img",src:r.src,sx:{width:60,height:60,objectFit:"cover",borderRadius:2,bgcolor:"action.hover"}}):e.jsx(s,{sx:{width:60,height:60,borderRadius:2,bgcolor:"action.hover",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(P,{sx:{opacity:.3}})}),e.jsxs(s,{flex:1,children:[e.jsx(i,{fontWeight:600,children:r.name}),e.jsx(c,{direction:"row",spacing:1,alignItems:"center",children:e.jsx(i,{variant:"caption",color:"text.secondary",children:r.detail})}),r.sku&&e.jsxs(i,{variant:"caption",color:"text.secondary",children:["SKU: ",r.sku]})]}),e.jsx(p,{size:"small",onClick:()=>Q(r),children:e.jsx(Ie,{})}),e.jsx(p,{size:"small",color:"error",onClick:()=>V(r.id),children:e.jsx(we,{})})]})},r.id)})})})]})}),e.jsx(I,{sx:{position:"fixed",bottom:0,left:0,right:0,p:2,bgcolor:"background.paper",borderTop:1,borderColor:"divider",zIndex:10},elevation:4,children:e.jsx(w,{maxWidth:"sm",children:e.jsx(f,{fullWidth:!0,variant:"contained",size:"large",startIcon:e.jsx(Re,{}),onClick:K,sx:{height:56,borderRadius:3,fontSize:"1.1rem",fontWeight:"bold",boxShadow:2},children:m?"Update Category":"Save Category"})})}),e.jsxs(Se,{open:M,onClose:()=>u(!1),PaperProps:{sx:{borderRadius:3,p:1}},children:[e.jsx(ke,{sx:{fontWeight:"bold"},children:"Delete Category?"}),e.jsx(De,{children:e.jsx(We,{children:"Are you sure you want to delete this category? This action is permanent and cannot be undone."})}),e.jsxs(Te,{sx:{p:2},children:[e.jsx(f,{onClick:()=>u(!1),color:"inherit",sx:{fontWeight:"bold"},children:"Cancel"}),e.jsx(f,{onClick:Y,variant:"contained",color:"error",sx:{fontWeight:"bold",borderRadius:2},children:"Delete"})]})]})]})}export{at as component};
