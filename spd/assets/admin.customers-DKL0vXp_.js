import{f as j,j as e,n as Y,r as h,B as c,I as u,h as x,S as b,E as Z,l as $,a7 as q}from"./index-CBou6moi.js";import{Y as U}from"./index-DWku4nr_.js";import{A as _,T as J,a as K}from"./ArrowBackIosNew-CIbvTB3E.js";import{C as X}from"./Container-DtrslpOQ.js";import{A as ee}from"./AddCircle-cTCxnp_u.js";import{G as o}from"./Grid-IWINzjQb.js";import{T as n}from"./TextField-RXHFbKtb.js";import{I as r}from"./InputAdornment-DpBsnqo5.js";import{P as te}from"./Person-Ppu-bxkp.js";import{B as se}from"./Business-7pyVT6yB.js";import{P as L}from"./Phone-CMIUrlWo.js";import{M as A}from"./Mail-DsOhcTLt.js";import{L as W}from"./LocationOn-CDKi7nvV.js";import{B as g}from"./Button-BflV7euM.js";import{S as oe}from"./Save-BYobhu1a.js";import{S as ie}from"./Search-DEj_P3US.js";import{C as D}from"./Chip-BXUFp7Xu.js";import{E as ne}from"./Edit-FTKVc5Ef.js";import{D as re}from"./Delete-DRnHzxX1.js";import{D as ae,a as le,b as de}from"./DialogTitle-f2PvcPNk.js";import{D as ce}from"./DialogContentText-QZEy0qxP.js";import{D as xe}from"./DialogActions-BLBSxaJt.js";import"./isMuiElement-fD2fXW9_.js";const k=j(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 16H8v-2h8zm0-4H8v-2h8zm-3-5V3.5L18.5 9z"})),he=j(e.jsx("path",{d:"M15 11V5l-3-3-3 3v2H3v14h18V11zm-8 8H5v-2h2zm0-4H5v-2h2zm0-4H5V9h2zm6 8h-2v-2h2zm0-4h-2v-2h2zm0-4h-2V9h2zm0-4h-2V5h2zm6 12h-2v-2h2zm0-4h-2v-2h2z"})),pe=j(e.jsx("path",{d:"M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2M7.64 15H6.49v-4.5l-.9.66-.58-.89L6.77 9h.87zm5.86 0H9.61v-1.02c1.07-1.07 1.77-1.77 2.13-2.15.4-.42.54-.69.54-1.06 0-.4-.31-.72-.81-.72-.52 0-.8.39-.9.72l-1.01-.42c.01-.02.18-.76 1-1.15.69-.33 1.48-.2 1.95.03.86.44.91 1.24.91 1.48 0 .64-.31 1.26-.92 1.86-.25.25-.72.71-1.4 1.39l.03.05h2.37zm5.25-.85c-.08.13-.56.85-1.76.85-.04 0-1.6.08-2.05-1.51l1.03-.41c.03.1.19.86 1.02.86.41 0 .89-.28.89-.77 0-.55-.48-.79-1.04-.79h-.5v-1h.46c.33 0 .88-.14.88-.72 0-.39-.31-.65-.75-.65-.5 0-.74.32-.85.64l-.99-.41C15.2 9.9 15.68 9 16.94 9c1.09 0 1.54.64 1.62.75.33.5.28 1.16.02 1.57-.15.22-.32.38-.52.48v.07c.28.11.51.28.68.52.37.52.33 1.27.01 1.76"})),me=j(e.jsx("path",{d:"M18 17H6v-2h12zm0-4H6v-2h12zm0-4H6V7h12zM3 22l1.5-1.5L6 22l1.5-1.5L9 22l1.5-1.5L12 22l1.5-1.5L15 22l1.5-1.5L18 22l1.5-1.5L21 22V2l-1.5 1.5L18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2 4.5 3.5 3 2z"}));function Oe(){const{customers:M,loading:P,fetchCustomers:H,addCustomer:R,updateCustomer:E,deleteCustomer:T}=Y();h.useEffect(()=>{H()},[]);const[p,y]=h.useState(null),[f,C]=h.useState(!1),[O,m]=h.useState(!1),[z,I]=h.useState(null),[a,B]=h.useState(""),[i,v]=h.useState({name:"",organisation:"",phone:"",email:"",address:"",city:"",zip:"",gstin:"",notes:""}),l=(t,s)=>{v(S=>({...S,[t]:s}))},N=async()=>{if(!i.name||!i.phone){alert("Name and Phone are required");return}try{p?await E({id:p,cid:p,...i}):await R(i),w()}catch(t){console.error("Error saving customer:",t),alert("Failed to save customer")}},V=t=>{const{id:s,createdAt:S,...d}=t;v({name:d.name||"",organisation:d.organisation||"",phone:d.phone||"",email:d.email||"",address:d.address||"",city:d.city||"",zip:d.zip||"",gstin:d.gstin||"",notes:d.notes||""}),y(s),C(!0),window.scrollTo({top:0,behavior:"smooth"})},F=t=>{I(t),m(!0)},G=async()=>{z&&(await T(z),m(!1),I(null))},w=()=>{v({name:"",organisation:"",phone:"",email:"",address:"",city:"",zip:"",gstin:"",notes:""}),y(null),C(!1),window.scrollTo({top:0,behavior:"smooth"})},Q=M.filter(t=>t.name.toLowerCase().includes(a.toLowerCase())||t.organisation?.toLowerCase().includes(a.toLowerCase())||t.phone.includes(a)||t.email?.toLowerCase().includes(a.toLowerCase())||t.gstin?.toLowerCase().includes(a.toLowerCase())||t.city?.toLowerCase().includes(a.toLowerCase())||t.zip?.toLowerCase().includes(a.toLowerCase())||t.cid?.toLowerCase().includes(a.toLowerCase()));return e.jsxs(c,{sx:{minHeight:"100vh",bgcolor:"background.default",pb:10},children:[e.jsx(_,{position:"sticky",color:"default",elevation:0,sx:{bgcolor:"background.paper",borderBottom:1,borderColor:"divider"},children:e.jsxs(J,{children:[e.jsx(u,{onClick:()=>window.history.back(),edge:"start",children:e.jsx(K,{})}),e.jsx(x,{variant:"h6",component:"h1",sx:{flexGrow:1,textAlign:"center",pr:5,fontWeight:"bold"},children:"Manage Customers"})]})}),e.jsxs(X,{maxWidth:"md",sx:{py:3,display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(c,{sx:{border:1,borderColor:"divider",borderRadius:3,overflow:"hidden",bgcolor:"background.paper"},children:[e.jsxs(c,{onClick:()=>C(!f),sx:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",p:2,bgcolor:"action.hover",transition:"background-color 0.2s","&:hover":{bgcolor:"action.selected"}},children:[e.jsxs(b,{direction:"row",spacing:1.5,alignItems:"center",children:[e.jsx(ee,{color:"primary"}),e.jsx(x,{variant:"subtitle1",sx:{fontWeight:"bold"},children:p?"Edit Customer":"Add New Customer"})]}),e.jsx(u,{size:"small",sx:{transform:f?"rotate(180deg)":"none",transition:"transform 0.3s"},children:e.jsx(Z,{})})]}),e.jsx($,{in:f,children:e.jsxs(c,{sx:{p:3,display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(o,{container:!0,spacing:2,children:[e.jsx(o,{size:{xs:12,sm:6},children:e.jsx(n,{fullWidth:!0,label:"Customer Name",value:i.name,onChange:t=>l("name",t.target.value),InputProps:{startAdornment:e.jsx(r,{position:"start",children:e.jsx(te,{opacity:.5})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(o,{size:{xs:12,sm:6},children:e.jsx(n,{fullWidth:!0,label:"Organisation Name",value:i.organisation,onChange:t=>l("organisation",t.target.value),InputProps:{startAdornment:e.jsx(r,{position:"start",children:e.jsx(se,{opacity:.5})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(o,{size:{xs:12,sm:6},children:e.jsx(n,{fullWidth:!0,label:"Phone Number",value:i.phone,onChange:t=>l("phone",t.target.value),InputProps:{startAdornment:e.jsx(r,{position:"start",children:e.jsx(L,{opacity:.5})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(o,{size:{xs:12,sm:6},children:e.jsx(n,{fullWidth:!0,label:"Email Address",value:i.email,onChange:t=>l("email",t.target.value),InputProps:{startAdornment:e.jsx(r,{position:"start",children:e.jsx(A,{opacity:.5})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(o,{size:{xs:12,sm:4},children:e.jsx(n,{fullWidth:!0,label:"GSTIN",value:i.gstin,onChange:t=>l("gstin",t.target.value),InputProps:{startAdornment:e.jsx(r,{position:"start",children:e.jsx(me,{opacity:.5})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(o,{size:{xs:12,sm:4},children:e.jsx(n,{fullWidth:!0,label:"City",value:i.city,onChange:t=>l("city",t.target.value),InputProps:{startAdornment:e.jsx(r,{position:"start",children:e.jsx(he,{opacity:.5})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(o,{size:{xs:12,sm:4},children:e.jsx(n,{fullWidth:!0,label:"Zip Code",value:i.zip,onChange:t=>l("zip",t.target.value),InputProps:{startAdornment:e.jsx(r,{position:"start",children:e.jsx(pe,{opacity:.5})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(o,{size:12,children:e.jsx(n,{fullWidth:!0,label:"Street Address",multiline:!0,rows:2,value:i.address,onChange:t=>l("address",t.target.value),InputProps:{startAdornment:e.jsx(r,{position:"start",sx:{alignSelf:"flex-start",mt:1},children:e.jsx(W,{opacity:.5})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(o,{size:12,children:e.jsx(n,{fullWidth:!0,label:"Internal Notes",multiline:!0,rows:2,value:i.notes,onChange:t=>l("notes",t.target.value),InputProps:{startAdornment:e.jsx(r,{position:"start",sx:{alignSelf:"flex-start",mt:1},children:e.jsx(k,{opacity:.5})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})})]}),e.jsxs(b,{direction:"row",spacing:2,children:[e.jsx(g,{fullWidth:!0,variant:"contained",size:"large",startIcon:e.jsx(oe,{}),onClick:N,sx:{borderRadius:2,height:48},children:p?"Update Customer":"Save Customer"}),p&&e.jsx(g,{variant:"outlined",color:"inherit",onClick:w,sx:{borderRadius:2,px:4},children:"Cancel"})]})]})})]}),e.jsxs(c,{children:[e.jsx(n,{size:"small",fullWidth:!0,placeholder:"Search by name, organisation, phone, city...",value:a,onChange:t=>B(t.target.value),InputProps:{startAdornment:e.jsx(r,{position:"start",children:e.jsx(ie,{sx:{opacity:.5}})}),sx:{borderRadius:2,bgcolor:"background.paper",mb:2}}}),e.jsx(U,{useWindowScroll:!0,data:Q,itemContent:(t,s)=>e.jsx(q,{sx:{p:2,mb:2,borderRadius:2},variant:"outlined",children:e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(c,{sx:{flex:1,minWidth:0},children:[e.jsxs(b,{direction:"row",spacing:1,alignItems:"center",sx:{mb:1,flexWrap:"wrap",gap:1},children:[e.jsx(D,{label:s.cid||"----",size:"small",sx:{bgcolor:"primary.main",color:"black",fontWeight:900,borderRadius:1,height:24,fontSize:"0.75rem",flexShrink:0}}),e.jsx(x,{variant:"h6",fontWeight:"bold",sx:{color:"primary.main",lineHeight:1.2,display:"flex",alignItems:"center"},children:s.name}),s.organisation&&e.jsxs(x,{variant:"subtitle2",sx:{color:"text.secondary",fontWeight:"medium"},children:["• ",s.organisation]}),s.gstin&&e.jsx(D,{label:`GST: ${s.gstin}`,size:"small",variant:"outlined",sx:{height:20,fontSize:"0.65rem",fontWeight:"bold",ml:"auto"}})]}),e.jsxs(o,{container:!0,spacing:1,children:[e.jsx(o,{size:{xs:12,sm:6},children:e.jsxs(x,{variant:"caption",sx:{display:"flex",alignItems:"center",gap:1,fontWeight:600},children:[e.jsx(L,{sx:{fontSize:14,opacity:.6}})," ",s.phone]})}),s.email&&e.jsx(o,{size:{xs:12,sm:6},children:e.jsxs(x,{variant:"caption",sx:{display:"flex",alignItems:"center",gap:1,color:"text.secondary"},children:[e.jsx(A,{sx:{fontSize:14,opacity:.6}})," ",s.email]})}),e.jsx(o,{size:12,children:e.jsxs(x,{variant:"caption",sx:{display:"flex",alignItems:"center",gap:1,color:"text.secondary",fontStyle:"italic"},children:[e.jsx(W,{sx:{fontSize:14,opacity:.6}}),s.address||"No street address",(s.city||s.zip)&&` • ${[s.city,s.zip].filter(Boolean).join(", ")}`]})}),s.notes&&e.jsx(o,{size:12,children:e.jsxs(x,{variant:"caption",sx:{display:"flex",alignItems:"flex-start",gap:1,color:"text.secondary",mt:.5},children:[e.jsx(k,{sx:{fontSize:14,opacity:.6,mt:.2}})," ",s.notes]})})]})]}),e.jsxs(c,{sx:{display:"flex",gap:.5},children:[e.jsx(u,{size:"small",onClick:()=>V(s),children:e.jsx(ne,{fontSize:"small"})}),e.jsx(u,{size:"small",color:"error",onClick:()=>F(s.id),children:e.jsx(re,{fontSize:"small"})})]})]})},s.id),components:{List:({children:t,...s})=>e.jsxs(c,{...s,children:[t,P&&e.jsx(x,{align:"center",sx:{py:2},children:"Loading..."})]})}})]})]}),e.jsxs(ae,{open:O,onClose:()=>m(!1),children:[e.jsx(le,{children:"Delete Customer?"}),e.jsx(de,{children:e.jsx(ce,{children:"This action cannot be undone. All information for this customer will be removed."})}),e.jsxs(xe,{children:[e.jsx(g,{onClick:()=>m(!1),children:"Cancel"}),e.jsx(g,{onClick:G,color:"error",variant:"contained",children:"Delete"})]})]})]})}export{Oe as component};
