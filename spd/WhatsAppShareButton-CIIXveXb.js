import{J as T,K as W,r as m,L as O,j as o,N as w,O as A,Q as F,f as V,ac as H,U as J,a3 as at,P as I,V as G,c as nt,a2 as it,n as lt,B as S,k as ct,h as v,S as ut}from"./index-SpP8DWQw.js";import{D as K,a as Y,b as Z}from"./DialogTitle-CwsgyE-M.js";import{S as M}from"./Search-BWnn7XH3.js";import{a as _,f as dt,c as pt,u as ft,T as ht,L as xt}from"./TextField-MmvaxMQp.js";import{I as mt}from"./InputAdornment-Dvyl87ic.js";import{B as k}from"./Button-DGEDUHi2.js";import{L as gt}from"./ListItem-x0GMwo09.js";import{D as X}from"./DialogActions-BpG21hdT.js";import{Q as yt}from"./QuantitySelector-lNEfAcls.js";import{F as B}from"./ListItemAvatar-Daf1WsTl.js";import{S as bt}from"./SwitchBase-JJBpehKz.js";import{C as Ct}from"./Checkbox-TNbwaxjZ.js";import{W as Rt}from"./WhatsApp-B0m1_bJg.js";function vt(t){return T("MuiFormGroup",t)}W("MuiFormGroup",["root","row","error"]);const St=t=>{const{classes:r,row:c,error:n}=t;return F({root:["root",c&&"row",n&&"error"]},vt,r)},jt=w("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:c}=t;return[r.root,c.row&&r.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),Pt=m.forwardRef(function(r,c){const n=O({props:r,name:"MuiFormGroup"}),{className:d,row:g=!1,...h}=n,x=_(),y=dt({props:n,muiFormControl:x,states:["error"]}),b={...n,row:g,error:y.error},a=St(b);return o.jsx(jt,{className:A(a.root,d),ownerState:b,ref:c,...h})}),kt=V(o.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),wt=V(o.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"})),It=w("span",{name:"MuiRadioButtonIcon",shouldForwardProp:H})({position:"relative",display:"flex"}),$t=w(kt,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),Dt=w(wt,{name:"MuiRadioButtonIcon"})(J(({theme:t})=>({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}}]})));function tt(t){const{checked:r=!1,classes:c={},fontSize:n}=t,d={...t,checked:r};return o.jsxs(It,{className:c.root,ownerState:d,children:[o.jsx($t,{fontSize:n,className:c.background,ownerState:d}),o.jsx(Dt,{fontSize:n,className:c.dot,ownerState:d})]})}const ot=m.createContext(void 0);function Lt(){return m.useContext(ot)}function Tt(t){return T("MuiRadio",t)}const q=W("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),Wt=t=>{const{classes:r,color:c,size:n}=t,d={root:["root",`color${I(c)}`,n!=="medium"&&`size${I(n)}`]};return{...r,...F(d,Tt,r)}},At=w(bt,{shouldForwardProp:t=>H(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:c}=t;return[r.root,c.size!=="medium"&&r[`size${I(c.size)}`],r[`color${I(c.color)}`]]}})(J(({theme:t})=>({color:(t.vars||t).palette.text.secondary,[`&.${q.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.alpha((t.vars||t).palette.action.active,(t.vars||t).palette.action.hoverOpacity)}}},...Object.entries(t.palette).filter(G()).map(([r])=>({props:{color:r,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.alpha((t.vars||t).palette[r].main,(t.vars||t).palette.action.hoverOpacity)}}})),...Object.entries(t.palette).filter(G()).map(([r])=>({props:{color:r,disabled:!1},style:{[`&.${q.checked}`]:{color:(t.vars||t).palette[r].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function Ft(t,r){return typeof r=="object"&&r!==null?t===r:String(t)===String(r)}const Nt=o.jsx(tt,{checked:!0}),Qt=o.jsx(tt,{}),U=m.forwardRef(function(r,c){const n=O({props:r,name:"MuiRadio"}),{checked:d,checkedIcon:g=Nt,color:h="primary",icon:x=Qt,name:y,onChange:b,size:a="medium",className:C,disabled:u,disableRipple:p=!1,slots:e={},slotProps:l={},inputProps:f,...i}=n,s=_();let R=u;s&&typeof R>"u"&&(R=s.disabled),R??=!1;const j={...n,disabled:R,disableRipple:p,color:h,size:a},N=Wt(j),P=Lt();let $=d;const et=pt(b,P&&P.onChange);let D=y;P&&(typeof $>"u"&&($=Ft(P.value,n.value)),typeof D>"u"&&(D=P.name));const L=l.input??f,[st,rt]=at("root",{ref:c,elementType:At,className:A(N.root,C),shouldForwardComponentProp:!0,externalForwardedProps:{slots:e,slotProps:l,...i},getSlotProps:Q=>({...Q,onChange:(z,...E)=>{Q.onChange?.(z,...E),et(z,...E)}}),ownerState:j,additionalProps:{type:"radio",icon:m.cloneElement(x,{fontSize:x.props.fontSize??a}),checkedIcon:m.cloneElement(g,{fontSize:g.props.fontSize??a}),disabled:R,name:D,checked:$,slots:e,slotProps:{input:typeof L=="function"?L(j):L}}});return o.jsx(st,{...rt,classes:N})});function zt(t){return T("MuiRadioGroup",t)}W("MuiRadioGroup",["root","row","error"]);const Et=t=>{const{classes:r,row:c,error:n}=t;return F({root:["root",c&&"row",n&&"error"]},zt,r)},Gt=m.forwardRef(function(r,c){const{actions:n,children:d,className:g,defaultValue:h,name:x,onChange:y,value:b,...a}=r,C=m.useRef(null),u=Et(r),[p,e]=ft({controlled:b,default:h,name:"RadioGroup"});m.useImperativeHandle(n,()=>({focus:()=>{let s=C.current.querySelector("input:not(:disabled):checked");s||(s=C.current.querySelector("input:not(:disabled)")),s&&s.focus()}}),[]);const l=nt(c,C),f=it(x),i=m.useMemo(()=>({name:f,onChange(s){e(s.target.value),y&&y(s,s.target.value)},value:p}),[f,y,e,p]);return o.jsx(ot.Provider,{value:i,children:o.jsx(Pt,{role:"radiogroup",ref:l,className:A(u.root,g),...a,children:d})})}),to=({open:t,onClose:r,onSelect:c})=>{const[n,d]=m.useState(""),[g,h]=m.useState([]),{customers:x,fetchCustomers:y}=lt();m.useEffect(()=>{t&&y()},[t,y]),m.useEffect(()=>{const a=n.toLowerCase().trim();if(!a){h(x);return}const u=x.map(p=>{let e=0;const l=(p.cid||"").toLowerCase(),f=(p.name||"").toLowerCase(),i=(p.organisation||"").toLowerCase(),s=(p.phone||"").toLowerCase(),R=(p.gstin||"").toLowerCase(),j=(p.address||"").toLowerCase();return l===a?e+=100:l.includes(a)&&(e+=80),f===a?e+=100:f.includes(a)&&(e+=80),i===a?e+=100:i.includes(a)&&(e+=80),s===a?e+=60:s.includes(a)&&(e+=40),R===a?e+=50:R.includes(a)&&(e+=30),j.includes(a)&&(e+=20),{customer:p,score:e}}).filter(p=>p.score>0).sort((p,e)=>e.score-p.score).map(p=>p.customer);h(u)},[n,x]);const b=()=>{d(""),h([]),r()};return o.jsxs(K,{open:t,onClose:b,maxWidth:"xs",fullWidth:!0,PaperProps:{sx:{borderRadius:4,bgcolor:"background.paper"}},children:[o.jsxs(Y,{sx:{fontWeight:"bold",display:"flex",alignItems:"center",gap:1},children:[o.jsx(M,{color:"primary"})," Lookup Customer"]}),o.jsxs(Z,{children:[o.jsxs(S,{sx:{mt:1,mb:2,display:"flex",gap:1},children:[o.jsx(ht,{size:"small",fullWidth:!0,label:"Search by Customer CID, Name, Phone...",variant:"outlined",value:n,onChange:a=>d(a.target.value),autoFocus:!0,placeholder:"Type to search...",InputProps:{startAdornment:o.jsx(mt,{position:"start",children:o.jsx(M,{color:"action"})})}}),o.jsx(k,{variant:"contained",onClick:()=>{},sx:{borderRadius:2,px:3,fontWeight:"bold"},children:"Search"})]}),o.jsxs(xt,{sx:{pt:0},children:[g.map(a=>o.jsx(gt,{component:"button",onClick:()=>{c(a),b()},sx:{borderRadius:3,mb:1,border:1,borderColor:"divider",textAlign:"left",display:"block",p:1.5,"&:hover":{bgcolor:"action.hover"},width:"100%",cursor:"pointer",bgcolor:"transparent"},children:o.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[o.jsx(ct,{sx:{bgcolor:"primary.main",color:"black",width:40,height:40,fontSize:"0.8rem",fontWeight:"bold"},children:a.cid}),o.jsxs(S,{sx:{flex:1,minWidth:0},children:[o.jsx(v,{variant:"body2",sx:{fontWeight:"bold"},children:a.name}),o.jsxs(v,{variant:"caption",color:"text.secondary",noWrap:!0,sx:{display:"block"},children:[a.organisation&&`${a.organisation} • `," ",a.phone]})]})]})},a.id)),n&&g.length===0&&o.jsx(v,{variant:"caption",color:"text.secondary",align:"center",sx:{display:"block",py:2},children:g.length===0&&n?"No customer found":"Search by CID, Name, or Phone to start"})]})]}),o.jsx(X,{sx:{p:2},children:o.jsx(k,{onClick:b,fullWidth:!0,color:"inherit",children:"Cancel"})})]})},oo=({open:t,onClose:r,onSave:c,order:n})=>{const[d,g]=m.useState("full"),[h,x]=m.useState({}),[y,b]=m.useState({}),[a,C]=m.useState(!1);m.useEffect(()=>{if(t&&n?.items){g("full");const e={},l={};n.items.forEach((f,i)=>{const s=f.quantity-(f.returnedQuantity||0);e[i]=!1,l[i]=f.isComplexVariant?s:Math.min(1,s)}),x(e),b(l)}},[t,n]);const u=e=>{x(l=>({...l,[e]:!l[e]}))},p=async()=>{C(!0);try{const e=n.items.map((l,f)=>{let i=0;return d==="full"?i=l.quantity-(l.returnedQuantity||0):h[f]&&(i=y[f]||0),i>0?{...l,returnedQuantity:(l.returnedQuantity||0)+i}:l});await c(e),r()}catch(e){console.error("Error saving return:",e),alert("Failed to save return details")}finally{C(!1)}};return n?o.jsxs(K,{open:t,onClose:r,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3}},children:[o.jsx(Y,{sx:{fontWeight:"bold"},children:"Process Return"}),o.jsxs(Z,{dividers:!0,children:[o.jsxs(S,{sx:{mb:3},children:[o.jsx(v,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"RETURN TYPE"}),o.jsxs(Gt,{value:d,onChange:e=>g(e.target.value),sx:{flexDirection:"row",gap:2},children:[o.jsx(B,{value:"full",control:o.jsx(U,{}),label:o.jsx(v,{variant:"body2",sx:{fontWeight:600},children:"Full Return"})}),o.jsx(B,{value:"partial",control:o.jsx(U,{}),label:o.jsx(v,{variant:"body2",sx:{fontWeight:600},children:"Partial Return"})})]})]}),d==="partial"&&o.jsxs(S,{children:[o.jsx(v,{variant:"subtitle2",color:"text.secondary",sx:{mb:2},children:"SELECT ITEMS & QUANTITIES"}),o.jsx(ut,{spacing:2,children:n.items.map((e,l)=>{const f=e.quantity-(e.returnedQuantity||0);return f<=0?null:o.jsx(S,{sx:{p:1.5,borderRadius:2,border:1,borderColor:h[l]?"primary.main":"divider",bgcolor:h[l]?"primary.main08":"transparent"},children:o.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[o.jsx(Ct,{checked:!!h[l],onChange:()=>u(l),size:"small"}),o.jsxs(S,{sx:{flex:1,minWidth:0},children:[o.jsx(v,{variant:"body2",sx:{fontWeight:"bold"},noWrap:!0,children:e.name}),o.jsxs(v,{variant:"caption",color:"text.secondary",children:["Available to return: ",f]})]}),e.isComplexVariant?o.jsxs(v,{variant:"body2",sx:{fontWeight:"bold",bgcolor:"action.hover",px:1.5,py:.5,borderRadius:2},children:[y[l]," ",e.unitName]}):o.jsx(yt,{quantity:y[l]||1,onQuantityChange:i=>{x(s=>({...s,[l]:!0})),b(s=>({...s,[l]:i}))},min:1,max:f,compact:!0})]})},l)})})]}),d==="full"&&o.jsx(S,{sx:{py:2,textAlign:"center",bgcolor:"action.hover",borderRadius:2},children:o.jsx(v,{variant:"body2",color:"text.secondary",children:"All eligible items will be marked as fully returned."})})]}),o.jsxs(X,{sx:{p:2.5},children:[o.jsx(k,{onClick:r,color:"inherit",sx:{fontWeight:"bold"},children:"Cancel"}),o.jsx(k,{onClick:p,variant:"contained",color:"primary",disabled:a||d==="partial"&&!Object.values(h).some(e=>e),sx:{fontWeight:"bold",borderRadius:2,px:3},children:a?"Processing...":"Confirm Return"})]})]}):null},eo=(t,r=[],c=0)=>{const n=i=>i.selectedSize?.price||i.price||i.buyPrice||0,d=t.reduce((i,s)=>i+n(s)*s.quantity,0),g=t.reduce((i,s)=>i+(s.taxAmount||0)*s.quantity,0),h=t.reduce((i,s)=>i+(s.addonAmount||0)*s.quantity,0),x=t.reduce((i,s)=>{const R=s.quantity-(s.returnedQuantity||0);return i+n(s)*R},0),y=t.reduce((i,s)=>{const R=s.quantity-(s.returnedQuantity||0);return i+(s.taxAmount||0)*R},0),b=t.reduce((i,s)=>{const R=s.quantity-(s.returnedQuantity||0);return i+(s.addonAmount||0)*R},0),a=t.length>0&&x===0,C=r.reduce((i,s)=>i+s.amount,0),u=a?0:C,p=a?0:c,e=x+y+b+u+p,f=d+g+h+C+c-e;return{subtotal:d,tax:g,itemAddons:h,orderAddons:C,addons:h+C,deliveryAmount:c,total:e,returnedAmount:f,items:t}},so=({order:t,variant:r="outlined",color:c="success",size:n="small"})=>{const d=g=>{g.stopPropagation();const h=t.shippingDetails?.phoneNumber||"",x=window.prompt("Enter WhatsApp Number",h);if(x===null)return;const y=t.timestamp?.toDate?t.timestamp.toDate().toLocaleDateString():new Date().toLocaleDateString(),b=`${t.shippingDetails?.firstName||""} ${t.shippingDetails?.lastName||""}`.trim()||"Guest",a=`${t.shippingDetails?.address||""}, ${t.shippingDetails?.city||""} ${t.shippingDetails?.zip||""}`.replace(/^, /,"").trim();let u=`*Estimate ID:* #${t.id.slice(0,5).toUpperCase()}
`;u+=`*Date:* ${y}
`,u+=`*Status:* ${t.status}
`,u+=`--------------------------------
`,u+=`*Customer Details:*
`,u+=`Name: ${b}
`,u+=`Phone: ${t.shippingDetails?.phoneNumber||"N/A"}
`,a&&(u+=`Address: ${a}
`),u+=`--------------------------------
`,u+=`*Items:*
`,t.items.forEach((e,l)=>{const f=e.selectedSize?` (${e.selectedSize.label})`:"",i=(e.totalPrice||e.buyPrice)*e.quantity;if(u+=`${l+1}. ${e.name}${f}
`,u+=`   Qty: ${e.quantity} x ₹${(e.totalPrice||e.buyPrice).toLocaleString()} = ₹${i.toLocaleString()}
`,e.returnedQuantity&&e.returnedQuantity>0){const s=(e.totalPrice||e.buyPrice)*e.returnedQuantity;u+=`   ⚠️ RETURNED: ${e.returnedQuantity} (-₹${s.toLocaleString()})
`}}),u+=`--------------------------------
`,t.subtotal&&(u+=`Subtotal: ₹${t.subtotal.toLocaleString()}
`),t.tax&&(u+=`Tax: ₹${t.tax.toLocaleString()}
`),t.deliveryAmount&&(u+=`Delivery: ₹${t.deliveryAmount.toLocaleString()}
`),u+=`*Grand Total: ₹${t.total.toLocaleString()}*
`,u+=`--------------------------------
`,u+="Thank you for reaching out to us!";const p=`https://wa.me/${x}?text=${encodeURIComponent(u)}`;window.open(p,"_blank")};return o.jsx(k,{size:n,variant:r,color:c,startIcon:o.jsx(Rt,{}),onClick:d,children:"Share"})};export{to as C,oo as R,so as W,eo as c};
