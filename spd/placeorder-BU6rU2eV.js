import{f as $,j as e,r as a,a as He,u as Ge,n as Qe,B as r,I as Z,h as n,o as Je,k as Se,p as Xe,q as De,s as Ze,t as Ke,v as Ye,w as et,x as tt,A as rt}from"./index-SpP8DWQw.js";import{u as V}from"./cartStore-DMeaZ9WD.js";import{u as ot}from"./orderStore-D1dH3pS3.js";import{u as st}from"./pricingStore-DvOquYgO.js";import{u as nt}from"./deliveryStore-Dl6B2yfC.js";import{O as it}from"./OfflineDialog-ChtyHqtn.js";import{B as C}from"./Button-DGEDUHi2.js";import{T as x,L as We}from"./TextField-MmvaxMQp.js";import{I as K}from"./InputAdornment-Dvyl87ic.js";import{S as we}from"./Search-BWnn7XH3.js";import{G as k}from"./Grid-CdM14__b.js";import{F as Pe,L as at}from"./ListItemAvatar-Daf1WsTl.js";import{C as lt}from"./Checkbox-TNbwaxjZ.js";import{D as Y,a as ee,b as te}from"./DialogTitle-CwsgyE-M.js";import{D as dt}from"./Delete-DZXZVyCc.js";import{S as ct}from"./Switch-tGxytQzA.js";import{A as xt}from"./Add-BZpUlFdw.js";import{D as pt}from"./Divider-LsEKU9d1.js";import{D as re}from"./DialogActions-BpG21hdT.js";import{L as oe}from"./ListItem-x0GMwo09.js";import{L as Ae}from"./ListItemText-Cigt6mZy.js";import{P as ut}from"./Person-MNOZu-U6.js";import{P as ht}from"./Payments-D148_w1p.js";import{C as mt}from"./CheckCircle-DYz0gMor.js";import{S as bt}from"./ShoppingCart-X6RY4WkV.js";import"./DialogContentText-D_qyrgL9.js";import"./isMuiElement-Ddcs7kQk.js";import"./SwitchBase-JJBpehKz.js";import"./dividerClasses-CUrjvUQ9.js";import"./listItemTextClasses-DfDm7pH3.js";const ft=$(e.jsx("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2m0 14H4v-6h16zm0-10H4V6h16z"})),gt=$(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 17h-2v-2h2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25"})),yt=$(e.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1z"})),jt=$(e.jsx("path",{d:"M17 1.01 7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99M17 19H7V5h10z"})),vt={arrow_back:e.jsx(rt,{}),shopping_cart:e.jsx(bt,{}),check_circle:e.jsx(mt,{}),credit_card:e.jsx(ft,{}),help:e.jsx(gt,{}),lock:e.jsx(yt,{}),payments:e.jsx(ht,{}),upi:e.jsx(jt,{}),person:e.jsx(ut,{})},j=({name:v,filled:se=!1,className:b=""})=>e.jsx(e.Fragment,{children:vt[v]||null});function Kt(){const[v,se]=a.useState("upi"),[b,ze]=a.useState("instant"),[I,Ne]=a.useState(""),[_,ne]=a.useState(!1),P=He(),M=V(t=>t.items),Le=V(t=>t.getTotalItems),Re=V(t=>t.getTotalPrice),ie=V(t=>t.clearCart),Te=Ge(t=>t.user),ae=ot(t=>t.setLastOrder),{fetchDeliveryConfig:le,deliveryConfig:F}=st(),[Me,de]=a.useState(!1);a.useState(()=>{navigator.onLine||de(!0),le()});const[d,ce]=a.useState({firstName:"",orgName:"",address:"",zip:"",city:"",phoneNumber:""}),[A,xe]=a.useState([]),[z,pe]=a.useState(null),[Fe,q]=a.useState(!1),{deliveryPersons:S,fetchDeliveryPersons:Oe}=nt(),[h,ue]=a.useState(""),[Ue,N]=a.useState(!1),[O,L]=a.useState(""),{customers:he,fetchCustomers:Be}=Qe(),[Ee,U]=a.useState(!1),[R,me]=a.useState(""),[H,G]=a.useState([]);a.useEffect(()=>{Oe(),le(),Be()},[]);const[be,fe]=a.useState(""),[Q,ge]=a.useState(""),[J,Ve]=a.useState(!1),D=t=>o=>{ce({...d,[t]:o.target.value})},X=Re(),B=M.reduce((t,o)=>t+(o.taxAmount||0)*o.quantity,0),ye=M.reduce((t,o)=>t+(o.addonAmount||0)*o.quantity,0),je=A.reduce((t,o)=>t+o.amount,0),W=ye+je,E=z!==null?z:F.enabled?F.amount:0,f=X+B+W+E,ve=Le(),Ce=()=>{const t=S.filter(l=>l.status==="active");if(!O)return t;const o=O.toLowerCase();return t.map(l=>{let i=0;const s=(l.name||"").toLowerCase(),p=(l.phone||"").toLowerCase(),c=(l.vehicleNumber||"").toLowerCase();return s===o?i+=100:s.startsWith(o)?i+=50:s.includes(o)&&(i+=20),p===o?i+=90:p.startsWith(o)?i+=40:p.includes(o)&&(i+=15),c===o?i+=80:c.startsWith(o)?i+=30:c.includes(o)&&(i+=10),{driver:l,score:i}}).filter(l=>l.score>0).sort((l,i)=>i.score-l.score).map(l=>l.driver)},$e=async()=>{if(!_){ne(!0);try{const t=M.map(s=>({id:s.id,name:s.name,buyPrice:s.buyPrice,quantity:s.quantity,sku:s.sku||null,src:s.src||null,selectedSize:s.selectedSize||null,category:s.category||"Uncategorized",taxAmount:s.taxAmount||0,addonAmount:s.addonAmount||0,totalPrice:s.totalPrice||0,isComplexVariant:s.isComplexVariant||!1,unitName:s.unitName||null})),o={userId:Te?.uid||"guest",shippingDetails:{firstName:d.firstName||"",orgName:d.orgName||"",address:d.address||"",zip:d.zip||"",city:d.city||"",phoneNumber:d.phoneNumber||""},items:t,subtotal:X||0,tax:B||0,itemAddons:ye||0,orderAddons:je||0,addons:W||0,manualAddons:A||[],deliveryAmount:E||0,total:f||0,paymentMethod:v||"upi",orderType:b,payments:b==="instant"?[{amount:f||0,timestamp:new Date,method:v||"upi"}]:Number(I)>0?[{amount:Number(I),timestamp:new Date,method:v||"upi"}]:[],paidAmount:b==="instant"?f||0:Number(I||0),isClosed:b==="instant"||b==="delay"&&Number(I)>=f,status:"pending",timestamp:new Date,offlineId:crypto.randomUUID(),...h?{deliveryPersonId:h,deliveryPersonName:S.find(s=>s.id===h)?.name,deliveryPersonPhone:S.find(s=>s.id===h)?.phone,deliveryPersonVehicle:S.find(s=>s.id===h)?.vehicleNumber}:{}};if(!navigator.onLine){const s=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),p=URL.createObjectURL(s),c=document.createElement("a");c.href=p,c.download=`order_${f.toFixed(0)}_${ve}_${o.offlineId}.json`,c.click(),URL.revokeObjectURL(p),ae({...o,isOffline:!0}),ie(),P({to:"/orders"});return}const l=Xe(De,"orders"),i=await Ze(l,{...o,timestamp:Ke()});try{for(const s of t){const p=Ye(De,"products",String(s.id)),c=await et(p);if(c.exists()){const w=c.data(),g={};if(s.selectedSize){const u=w.sizes||[],y=u.findIndex(m=>m.label===s.selectedSize.label);if(y!==-1){let m=s.quantity;const T={...u[y]},ke=T.returnStock||0,Ie=Math.min(ke,m);T.returnStock=ke-Ie,m-=Ie,m>0&&(T.stock=(T.stock||0)-m),u[y]=T,g.sizes=u}}else{let u=s.quantity;const y=w.returnStock||0,m=Math.min(y,u);g.returnStock=y-m,u-=m,u>0&&(g.stock=(w.stock||0)-u)}Object.keys(g).length>0&&await tt(p,g)}}}catch(s){console.error("Error updating stock:",s)}ae({...o,id:i.id}),ie(),P({to:"/orders"})}catch(t){console.error("Error placing order:",t),alert("Failed to place order. Please try again.")}finally{ne(!1)}}},_e=()=>{const t=R.toLowerCase().trim();if(!t){G([]);return}const l=he.map(i=>{let s=0;const p=(i.cid||"").toLowerCase(),c=(i.name||"").toLowerCase(),w=(i.organisation||"").toLowerCase(),g=(i.phone||"").toLowerCase(),u=(i.gstin||"").toLowerCase(),y=(i.address||"").toLowerCase();return p===t?s+=100:p.includes(t)&&(s+=80),c===t?s+=100:c.includes(t)&&(s+=80),w===t?s+=100:w.includes(t)&&(s+=80),g===t?s+=60:g.includes(t)&&(s+=40),u===t?s+=50:u.includes(t)&&(s+=30),y.includes(t)&&(s+=20),{customer:i,score:s}}).filter(i=>i.score>0).sort((i,s)=>s.score-i.score).map(i=>i.customer);G(l)};a.useEffect(()=>{_e()},[R,he]);const qe=t=>{const o={firstName:t.name||"",orgName:t.organisation||"",address:t.address||"",zip:t.zip||"",city:t.city||"",phoneNumber:t.phone||""};ce(o),U(!1),me(""),G([])};return e.jsxs(r,{sx:{pb:30,bgcolor:"background.default",minHeight:"100vh",color:"text.primary",position:"relative"},children:[e.jsx(r,{sx:{position:"sticky",top:0,zIndex:1100,bgcolor:"background.default/90",backdropFilter:"blur(20px)",borderBottom:1,borderColor:"divider"},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2,height:64},children:[e.jsx(Z,{sx:{ml:-1,bgcolor:"action.hover"},onClick:()=>P({to:"/checkout"}),children:e.jsx(j,{name:"arrow_back"})}),e.jsx(n,{variant:"h6",sx:{fontWeight:"bold"},children:"Checkout"}),e.jsx(r,{sx:{width:40}})," "]})}),e.jsxs(r,{sx:{p:2,display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(r,{children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1.5},children:[e.jsxs(n,{variant:"caption",sx:{fontWeight:"bold",color:"text.secondary",textTransform:"uppercase",letterSpacing:1},children:["Estimate"," Summary"]}),e.jsx(C,{size:"small",onClick:()=>P({to:"/checkout"}),sx:{fontSize:"0.75rem",fontWeight:500,color:"info.main",minWidth:"auto",p:0,"&:hover":{color:"text.primary",bgcolor:"transparent"}},children:"Edit Cart"})]}),e.jsx(r,{sx:{bgcolor:"background.paper",borderRadius:3,border:1,borderColor:"divider",p:2,boxShadow:"none"},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(r,{sx:{display:"flex",ml:1.5},children:e.jsx(r,{sx:{width:48,height:48,bgcolor:"action.hover",borderRadius:2,border:2,borderColor:"background.paper",display:"flex",alignItems:"center",justifyContent:"center",zIndex:30,ml:-1.5},children:e.jsx(j,{name:"shopping_cart",className:"!text-xl text-text-secondary"})})}),e.jsxs(r,{sx:{flex:1,minWidth:0,display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsxs(n,{variant:"body2",style:{fontWeight:"bold",whiteSpace:"nowrap"},children:[ve," Items"]}),e.jsx(r,{style:{color:"text.secondary",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:M.map((t,o)=>e.jsxs(n,{variant:"body2",children:[t.quantity," x ",t.selectedSize?.label.slice(0,5),"..,",t.name.slice(0,10),".."]},`${t.id}-${t.selectedSize?.label||"default"}-${o}`))})]})]})}),e.jsxs(r,{sx:{mb:2.5,px:0,pt:2},children:[e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:1,mb:1.5},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{minWidth:100},children:"Subtotal"}),e.jsxs(n,{variant:"body2",color:"text.primary",sx:{fontWeight:500,textAlign:"right"},children:["₹",X.toFixed(2)]})]}),B>0&&e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{minWidth:100},children:"Tax"}),e.jsxs(n,{variant:"body2",color:"text.primary",sx:{fontWeight:500,textAlign:"right"},children:["₹",B.toFixed(2)]})]}),W!==0&&e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{minWidth:100},children:"Add-ons/Discounts"}),e.jsxs(n,{variant:"body2",color:W>0?"text.primary":"error.main",sx:{fontWeight:500,textAlign:"right"},children:[W<0?"-":"","₹",Math.abs(W).toFixed(2)]})]}),(E!==0||z!==null)&&e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{minWidth:100},children:"Delivery"}),e.jsxs(n,{variant:"body2",color:"text.primary",sx:{fontWeight:500,textAlign:"right"},children:["₹",E.toFixed(2)]})]})]}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pt:1.5,borderTop:"1px dashed",borderColor:"divider"},children:[e.jsx(n,{variant:"body1",sx:{fontWeight:"bold",minWidth:100},children:"Total"}),e.jsxs(n,{variant:"h6",sx:{fontWeight:"bold",color:"primary.main",textAlign:"right"},children:["₹",f.toFixed(2)]})]}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end",mt:1},children:e.jsx(C,{size:"small",onClick:()=>{z===null&&pe(F.enabled?F.amount:0),q(!0)},sx:{fontSize:"0.75rem",fontWeight:500,color:"primary.main",p:0},children:"Edit Pricing"})})]})]}),e.jsxs(r,{children:[e.jsx(n,{variant:"caption",sx:{fontWeight:"bold",color:"text.secondary",textTransform:"uppercase",letterSpacing:1,display:"block",mb:1.5},children:"Shipping Address"}),e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[e.jsxs(r,{sx:{mb:1},children:[e.jsx(n,{variant:"caption",sx:{fontWeight:"bold",color:"text.secondary",textTransform:"uppercase",letterSpacing:1,display:"block",mb:1.5},children:"Order Type"}),e.jsx(r,{sx:{display:"flex",gap:1.5},children:["instant","delay"].map(t=>{const o=b===t;return e.jsx(r,{component:"button",onClick:()=>ze(t),sx:{flex:1,p:1.5,borderRadius:3,border:o?2:1,borderColor:o?"primary.main":"divider",bgcolor:o?"rgba(242, 215, 13, 0.1)":"background.paper",color:o?"text.primary":"text.secondary",fontWeight:"bold",textTransform:"capitalize",cursor:"pointer",transition:"all 0.2s","&:active":{transform:"scale(0.95)"}},children:t},t)})})]}),b==="delay"&&e.jsx(r,{sx:{mb:1,animation:"fadeIn 0.3s ease-out"},children:e.jsx(x,{label:"Initial Payment Amount",type:"number",variant:"filled",fullWidth:!0,placeholder:"0.00",value:I,onChange:t=>Ne(t.target.value),sx:{"& .MuiFilledInput-root":{borderRadius:3,bgcolor:"rgba(76, 175, 80, 0.05)",border:1,borderColor:"success.light"},"& .MuiInputLabel-root":{color:"success.main"}},InputProps:{disableUnderline:!0,startAdornment:e.jsx(K,{position:"start",children:"₹"})},helperText:`Balance Due: ₹${(f-Number(I||0)).toFixed(2)}`})}),e.jsxs(r,{sx:{mb:1},children:[e.jsx(n,{variant:"caption",sx:{fontWeight:"bold",color:"text.secondary",textTransform:"uppercase",letterSpacing:1,display:"block",mb:1.5},children:"Assign Driver"}),e.jsxs(r,{component:"button",onClick:()=>N(!0),sx:{width:"100%",p:2,borderRadius:3,border:1,borderColor:"divider",bgcolor:"background.paper",textAlign:"left",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",transition:"all 0.2s","&:hover":{bgcolor:"action.hover"}},children:[e.jsxs(r,{children:[e.jsx(n,{variant:"body2",sx:{fontWeight:"bold",color:h?"text.primary":"text.secondary"},children:h?S.find(t=>t.id===h)?.name:"Select Delivery Person"}),h&&e.jsx(n,{variant:"caption",color:"text.secondary",children:S.find(t=>t.id===h)?.vehicleNumber||"No Vehicle"})]}),e.jsx(j,{name:"person",filled:!!h})]})]}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1.5},children:[e.jsx(n,{variant:"caption",sx:{fontWeight:"bold",color:"text.secondary",textTransform:"uppercase",letterSpacing:1},children:"Customer Details"}),e.jsx(C,{size:"small",variant:"outlined",startIcon:e.jsx(we,{}),onClick:()=>U(!0),sx:{borderRadius:2,fontSize:"0.65rem",py:.2},children:"Lookup CID"})]}),e.jsxs(k,{container:!0,spacing:1.5,children:[e.jsx(k,{size:12,children:e.jsx(x,{label:"First Name",variant:"filled",fullWidth:!0,value:d.firstName,onChange:D("firstName"),sx:{"& .MuiFilledInput-root":{borderRadius:3,bgcolor:"background.paper",border:1,borderColor:"divider"},"& .MuiInputLabel-root":{color:"text.secondary"}},InputProps:{disableUnderline:!0}})}),e.jsx(k,{size:12,children:e.jsx(x,{label:"Organization Name",variant:"filled",fullWidth:!0,value:d.orgName,onChange:D("orgName"),sx:{"& .MuiFilledInput-root":{borderRadius:3,bgcolor:"background.paper",border:1,borderColor:"divider"},"& .MuiInputLabel-root":{color:"text.secondary"}},InputProps:{disableUnderline:!0}})}),e.jsx(k,{size:12,children:e.jsx(x,{label:"Phone Number",variant:"filled",fullWidth:!0,placeholder:"+91 99999 99999",value:d.phoneNumber,onChange:D("phoneNumber"),sx:{"& .MuiFilledInput-root":{borderRadius:3,bgcolor:"background.paper",border:1,borderColor:"divider"},"& .MuiInputLabel-root":{color:"text.secondary"}},InputProps:{disableUnderline:!0}})})]}),e.jsx(x,{label:"Address",variant:"filled",fullWidth:!0,value:d.address,onChange:D("address"),sx:{"& .MuiFilledInput-root":{borderRadius:3,bgcolor:"background.paper",border:1,borderColor:"divider"},"& .MuiInputLabel-root":{color:"text.secondary"}},InputProps:{disableUnderline:!0}}),e.jsxs(k,{container:!0,spacing:1.5,children:[e.jsx(k,{size:4,children:e.jsx(x,{label:"Zip Code",variant:"filled",fullWidth:!0,value:d.zip,onChange:D("zip"),sx:{"& .MuiFilledInput-root":{borderRadius:3,bgcolor:"background.paper",border:1,borderColor:"divider"},"& .MuiInputLabel-root":{color:"text.secondary"}},InputProps:{disableUnderline:!0}})}),e.jsx(k,{size:8,children:e.jsx(x,{label:"City",variant:"filled",fullWidth:!0,value:d.city,onChange:D("city"),sx:{"& .MuiFilledInput-root":{borderRadius:3,bgcolor:"background.paper",border:1,borderColor:"divider"},"& .MuiInputLabel-root":{color:"text.secondary"}},InputProps:{disableUnderline:!0}})})]})]})]}),e.jsxs(r,{children:[e.jsx(n,{variant:"caption",sx:{fontWeight:"bold",color:"text.secondary",textTransform:"uppercase",letterSpacing:1,display:"block",mb:1.5},children:"Payment Method"}),e.jsx(r,{sx:{display:"flex",gap:1.5,mb:2,overflowX:"auto",pb:.5},children:["upi","payments"].map(t=>{const o=v===t,l={upi:"UPI",payments:"Cash"};return e.jsxs(r,{component:"button",onClick:()=>se(t),sx:{flex:1,minWidth:110,p:1.5,borderRadius:3,border:o?2:1,borderColor:o?"primary.main":"divider",bgcolor:o?"rgba(103, 103, 103, 0.1)":"background.paper",display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-between",height:80,position:"relative",transition:"all 0.2s","&:active":{transform:"scale(0.95)"}},children:[o&&e.jsx(r,{sx:{position:"absolute",top:8,right:8,color:"primary.main"},children:e.jsx(j,{name:"check_circle",filled:!0})}),e.jsx(r,{sx:{color:o?"primary.main":"text.secondary"},children:e.jsx(j,{name:t})}),e.jsx(n,{variant:"caption",sx:{fontWeight:o?"bold":"medium",color:o?"text.primary":"text.secondary"},children:l[t]})]},t)})}),v==="upi"&&e.jsxs(r,{sx:{bgcolor:"background.paper",borderRadius:3,border:1,borderColor:"divider",p:2,display:"flex",flexDirection:"column",gap:1.5},children:[e.jsx(x,{label:"UPI ID",variant:"filled",fullWidth:!0,placeholder:"username@bank",defaultValue:"mystore@a123bank",disabled:!0,sx:{"& .MuiFilledInput-root":{borderRadius:3,bgcolor:"action.hover",border:1,borderColor:"divider"},"& .MuiInputLabel-root":{color:"text.secondary"}},InputProps:{disableUnderline:!0,endAdornment:e.jsx(K,{position:"end",children:e.jsx(j,{name:"upi",className:"text-text-disabled"})})}}),e.jsx(n,{variant:"caption",color:"text.secondary",sx:{px:.5},children:"Securely pay using your favorite UPI app (GPay, PhonePe, Paytm, etc)."})]}),e.jsx(r,{sx:{display:"flex",alignItems:"center",mt:2},children:e.jsx(Pe,{control:e.jsx(lt,{defaultChecked:!0,sx:{color:"text.secondary","&.Mui-checked":{color:"primary.main"}}}),label:e.jsx(n,{variant:"body2",color:"text.secondary",children:"Save this VPA for future purchases"})})})]})]}),e.jsx(r,{sx:{position:"fixed",bottom:0,left:0,right:0,bgcolor:"background.paper",borderTop:1,borderColor:"divider",p:3,pb:4,borderTopLeftRadius:24,borderTopRightRadius:24,boxShadow:"0 -8px 30px rgba(0,0,0,0.1)",zIndex:1e3},children:e.jsxs(C,{variant:"contained",color:"primary",fullWidth:!0,size:"large",sx:{borderRadius:4,py:2,variant:"contained",color:"primary",fontSize:"1rem",fontWeight:"bold",textTransform:"none",boxShadow:"0 8px 20px -4px rgba(242, 238, 13, 0.3)",display:"flex",justifyContent:"center",gap:1.5},onClick:$e,disabled:_,children:[e.jsx(j,{name:"lock"}),_?"Processing...":`Place Estimate • Rs ${f.toFixed(2)}`]})}),e.jsxs(Y,{open:Fe,onClose:()=>q(!1),maxWidth:"xs",fullWidth:!0,PaperProps:{sx:{borderRadius:4,bgcolor:"background.paper"}},children:[e.jsx(ee,{sx:{fontWeight:"bold"},children:"Edit Pricing"}),e.jsx(te,{children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsx(n,{variant:"subtitle2",sx:{fontWeight:"bold",color:"text.secondary"},children:"Addons / Discounts"}),e.jsx(r,{sx:{display:"flex",flexDirection:"column",gap:1},children:A.map((t,o)=>e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",bgcolor:"action.hover",p:1,borderRadius:2},children:[e.jsx(n,{variant:"body2",children:t.label}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(n,{variant:"body2",sx:{fontWeight:"bold"},children:["₹",t.amount.toFixed(2)]}),e.jsx(Z,{size:"small",color:"error",onClick:()=>xe(A.filter((l,i)=>i!==o)),children:e.jsx(dt,{fontSize:"small"})})]})]},o))}),e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(r,{sx:{display:"flex",gap:1},children:e.jsx(x,{label:"Description(optional)",variant:"outlined",size:"small",fullWidth:!0,value:be,onChange:t=>fe(t.target.value)})}),e.jsx(r,{sx:{display:"flex",gap:1},children:e.jsx(x,{label:"Amount",type:"number",variant:"outlined",size:"small",fullWidth:!0,value:Q,onChange:t=>ge(t.target.value)})}),e.jsx(r,{sx:{display:"flex",gap:1,justifyContent:"center"},children:e.jsx(Pe,{control:e.jsx(ct,{size:"small",checked:J,onChange:t=>Ve(t.target.checked),color:"error"}),label:e.jsx(n,{variant:"caption",color:J?"error":"text.secondary",children:"Treat as Discount"})})}),e.jsx(Z,{color:"primary",sx:{border:"2px solid #ccc",borderRadius:2},onClick:()=>{if(Q){const t=be||`manual-${Je(5)}`,o=Number(Q)*(J?-1:1);xe([...A,{label:t,amount:o}]),fe(""),ge("")}},children:e.jsx(xt,{})})]}),e.jsx(pt,{sx:{my:1}}),e.jsx(n,{variant:"subtitle2",sx:{fontWeight:"bold",color:"text.secondary"},children:"Delivery Charge"}),e.jsx(x,{label:"Delivery Amount",type:"number",variant:"outlined",fullWidth:!0,value:z??0,onChange:t=>pe(Number(t.target.value)),helperText:"Set to 0 to remove delivery charge"})]})}),e.jsx(re,{sx:{p:2},children:e.jsx(C,{onClick:()=>q(!1),fullWidth:!0,variant:"contained",sx:{borderRadius:3,py:1.5,fontWeight:"bold"},children:"Done"})})]}),e.jsxs(Y,{open:Ee,onClose:()=>U(!1),maxWidth:"xs",fullWidth:!0,PaperProps:{sx:{borderRadius:4,bgcolor:"background.paper"}},children:[e.jsxs(ee,{sx:{fontWeight:"bold",display:"flex",alignItems:"center",gap:1},children:[e.jsx(we,{color:"primary"})," Lookup Customer"]}),e.jsxs(te,{children:[e.jsx(r,{sx:{mt:1,mb:2},children:e.jsx(x,{size:"small",fullWidth:!0,label:"Search by Customer CID",variant:"outlined",value:R,onChange:t=>me(t.target.value),autoFocus:!0,placeholder:"Type CID (e.g. AB12)"})}),e.jsxs(We,{sx:{pt:0},children:[H.map(t=>e.jsx(oe,{component:"button",onClick:()=>qe(t),sx:{borderRadius:3,mb:1,border:1,borderColor:"divider",textAlign:"left",display:"block",p:1.5,"&:hover":{bgcolor:"action.hover"},width:"100%",cursor:"pointer",bgcolor:"transparent"},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(Se,{sx:{bgcolor:"primary.main",color:"black",width:40,height:40,fontSize:"0.8rem",fontWeight:"bold"},children:t.cid}),e.jsxs(r,{sx:{flex:1,minWidth:0},children:[e.jsx(n,{variant:"body2",sx:{fontWeight:"bold"},children:t.name}),e.jsxs(n,{variant:"caption",color:"text.secondary",noWrap:!0,sx:{display:"block"},children:[t.organisation&&`${t.organisation} • `," ",t.phone]})]})]})},t.id)),R&&H.length===0&&e.jsx(n,{variant:"caption",color:"text.secondary",align:"center",sx:{display:"block",py:2},children:H.length===0&&R?"No customer found with this CID":"Search by CID to start"})]})]}),e.jsx(re,{sx:{p:2},children:e.jsx(C,{onClick:()=>U(!1),fullWidth:!0,color:"inherit",children:"Cancel"})})]}),e.jsx(it,{open:Me,onContinue:()=>de(!1),onNavigateAway:()=>P({to:"/shop"})}),e.jsxs(Y,{open:Ue,onClose:()=>{N(!1),L("")},PaperProps:{sx:{borderRadius:3,maxWidth:400,width:"90%"}},children:[e.jsx(ee,{sx:{fontWeight:"bold"},children:"Assign Driver"}),e.jsxs(te,{sx:{p:0},children:[e.jsx(r,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:e.jsx(x,{fullWidth:!0,size:"small",placeholder:"Search name, phone, or vehicle...",value:O,onChange:t=>L(t.target.value),InputProps:{startAdornment:e.jsx(K,{position:"start",children:e.jsx(j,{name:"search"})}),sx:{borderRadius:2}}})}),e.jsxs(We,{sx:{py:0,maxHeight:400,overflow:"auto"},children:[e.jsx(oe,{component:"div",onClick:()=>{ue(""),N(!1),L("")},sx:{cursor:"pointer","&:hover":{bgcolor:"action.hover"},borderBottom:1,borderColor:"divider",py:1.5},children:e.jsx(Ae,{primary:"None (Clear)",primaryTypographyProps:{color:"text.secondary"}})}),Ce().map(t=>e.jsxs(oe,{component:"div",onClick:()=>{ue(t.id),N(!1),L("")},sx:{cursor:"pointer","&:hover":{bgcolor:"action.hover"},borderBottom:1,borderColor:"divider",py:2},children:[e.jsx(at,{children:e.jsx(Se,{sx:{bgcolor:"primary.main",color:"black"},children:t.name.charAt(0).toUpperCase()})}),e.jsx(Ae,{primary:t.name,secondary:`${t.vehicleNumber||"No vehicle"} • ${t.phone}`,primaryTypographyProps:{fontWeight:"bold"}})]},t.id)),Ce().length===0&&e.jsx(r,{sx:{p:4,textAlign:"center"},children:e.jsx(n,{variant:"body2",color:"text.secondary",children:O?"No matching drivers found.":"No active drivers found."})})]})]}),e.jsx(re,{sx:{p:2},children:e.jsx(C,{onClick:()=>{N(!1),L("")},color:"inherit",sx:{fontWeight:"bold"},children:"Cancel"})})]})]})}export{Kt as component};
