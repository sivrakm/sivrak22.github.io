import{z as w,v as g,q as d,ab as m,x as y,p as u,s as D,H as I}from"./index-SpP8DWQw.js";const v=w(r=>({categories:[],activeCategory:"All Items",products:[],categoryItems:[],isLoading:!1,error:null,setActiveCategory:o=>r({activeCategory:o}),fetchProducts:async()=>{r({isLoading:!0,error:null});try{if(!navigator.onLine)throw new Error("Offline");const o=u(d,"products"),e=(await I(o)).docs.map(a=>({...a.data(),id:a.id})),c=await h();r({categoryItems:c}),r({categories:["All Items",...c.map(a=>a.name)]}),r({products:e,isLoading:!1})}catch(o){console.log("Online fetch failed or offline, trying fallback:",o);try{const t=await fetch("offline_catalog.json");if(!t.ok)throw new Error("Offline catalog not found");const e=await t.json(),c=e.products||[],a=e.categories||[];r({categoryItems:a}),r({categories:["All Items",...a.map(n=>n.name)]}),r({products:c,isLoading:!1})}catch(t){console.error("Error fetching products:",t),r({error:o.message||"Failed to load products",isLoading:!1})}}},pushProducttoDb:async o=>{const t=u(d,"products");await D(t,o)},updateProduct:async o=>{const{id:t,...e}=o;if(!t||typeof t!="string"){console.error("Cannot update product without a valid Firestore ID string:",t);return}const c=g(d,"products",t);await y(c,e),r(a=>({products:a.products.map(n=>n.id===t?{...n,...e}:n)}))},deleteProduct:async o=>{const t=String(o),e=g(d,"products",t);await m(e),r(c=>({products:c.products.filter(a=>a.id!==o)}))},pushCategorytoDb:async o=>{const t=u(d,"categories");await D(t,o)},updateCategory:async o=>{const{id:t,...e}=o;if(!t||typeof t!="string"){console.error("Cannot update category without a valid Firestore ID string:",t);return}const c=g(d,"categories",t);await y(c,e),r(a=>{const n=a.categoryItems.map(s=>s.id===t?{...s,...e}:s),i=a.products.map(s=>s.id===t?{...s,...e}:s),l=a.categoryItems.find(s=>s.id===t)?.name,p=e.name;let f=a.categories;return l&&p&&l!==p&&(f=a.categories.map(s=>s===l?p:s)),{categoryItems:n,products:i,categories:f}})},deleteCategory:async o=>{const t=String(o),e=g(d,"categories",t);await m(e),r(c=>{const n=c.categoryItems.find(i=>i.id===o)?.name;return{categoryItems:c.categoryItems.filter(i=>i.id!==o),products:c.products.filter(i=>i.id!==o),categories:c.categories.filter(i=>i!==n)}})}})),h=async()=>{const r=u(d,"categories");return(await I(r)).docs.map(e=>({...e.data(),id:e.id}))};export{v as u};
