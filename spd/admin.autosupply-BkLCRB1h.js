import{f as L,j as e,i as Q,r as d,B as i,I as U,h as a,k as I,S as p,a7 as k}from"./index-SpP8DWQw.js";import{u as G}from"./productStore-Du4HY6l3.js";import{Y as O}from"./index-DYS6evUV.js";import{A as _,T as M,a as H}from"./ArrowBackIosNew-jin2UP-n.js";import{C as K}from"./Container-BNd65LSi.js";import{N as Y}from"./NotificationsActive-BPcnFlEK.js";import{I as F}from"./Inventory2-CD10EZLx.js";import{L as q}from"./LocalShipping-CwmZBZtX.js";import{C as g}from"./Chip-x4b9dzV_.js";import{B as f}from"./Button-DGEDUHi2.js";import{D as J}from"./Divider-LsEKU9d1.js";import{C as V}from"./Checkbox-TNbwaxjZ.js";import{W as X}from"./Warning-BJ5Jyeou.js";import{T as Z,L as ee}from"./TextField-MmvaxMQp.js";import{D as te,a as re,b as se}from"./DialogTitle-CwsgyE-M.js";import{L as oe}from"./ListItem-x0GMwo09.js";import{P as ne}from"./Person-MNOZu-U6.js";import{G as b}from"./Grid-CdM14__b.js";import{W as ie}from"./WhatsApp-B0m1_bJg.js";import{E as ae}from"./Email-Bi6tCZpJ.js";import"./dividerClasses-CUrjvUQ9.js";import"./SwitchBase-JJBpehKz.js";import"./isMuiElement-Ddcs7kQk.js";const le=L(e.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}));function Te(){const{products:C,fetchProducts:w}=G(),{suppliers:c,fetchSuppliers:W}=Q(),[u,R]=d.useState(new Set),[x,j]=d.useState({}),[z,y]=d.useState(!1),[m,A]=d.useState(null);d.useEffect(()=>{w(),W()},[]);const l=C.filter(t=>t.stockTrigger&&(t.stock||0)+(t.returnStock||0)<(t.triggerBelow||0));d.useEffect(()=>{const t={...x};let r=!1;l.forEach(s=>{s.id&&x[s.id]===void 0&&(t[s.id]=s.triggerQty||0,r=!0)}),r&&j(t)},[l]);const D=t=>{const r=new Set(u);r.has(t)?r.delete(t):r.add(t),R(r)},T=(t,r)=>{j(s=>({...s,[t]:r}))},P=t=>{A(t),y(!0)},S=t=>{const r=c.find(n=>n.id===t),s=l.filter(n=>(n.triggerSupplierId||"unassigned")===t&&u.has(n.id));if(s.length===0)return null;let o=`*Restock Summary - ${r?.name}*

`;return s.forEach(n=>{o+=`â€¢ ${n.name} (SKU: ${n.sku||"N/A"})
`,o+=`  Qty: ${x[n.id]||n.triggerQty}

`}),o+="_Generated via SPD_",{text:o,items:s}},E=t=>{const r=S(m);if(!r)return;const s=t.phone||"",o=encodeURIComponent(r.text);window.open(`https://wa.me/${s.replace(/\D/g,"")}?text=${o}`,"_blank")},$=t=>{const r=S(m);if(!r)return;const s=t.email||"",o=encodeURIComponent(`Restock - ${new Date().toLocaleDateString()}`),n=encodeURIComponent(r.text.replace(/\*/g,""));window.location.href=`mailto:${s}?subject=${o}&body=${n}`},v=l.reduce((t,r)=>{const s=r.triggerSupplierId||"unassigned";return t[s]||(t[s]=[]),t[s].push(r),t},{}),B=Object.keys(v).sort((t,r)=>{if(t==="unassigned")return 1;if(r==="unassigned")return-1;const s=c.find(n=>n.id===t)?.name||"",o=c.find(n=>n.id===r)?.name||"";return s.localeCompare(o)}),h=[];return B.forEach(t=>{const r=v[t],s=c.find(o=>o.id===t);h.push({type:"header",supplierName:s?.name||"No Specific Supplier",supplierId:t,count:r.length}),r.forEach(o=>{h.push({type:"product",product:o})})}),e.jsxs(i,{sx:{minHeight:"100vh",bgcolor:"background.default",pb:10},children:[e.jsx(_,{position:"sticky",color:"default",elevation:0,sx:{bgcolor:"background.paper",borderBottom:1,borderColor:"divider"},children:e.jsxs(M,{children:[e.jsx(U,{onClick:()=>window.history.back(),edge:"start",children:e.jsx(H,{})}),e.jsx(a,{variant:"h6",component:"h1",sx:{flexGrow:1,textAlign:"center",pr:5,fontWeight:"bold"},children:"Ez-stock List"})]})}),e.jsxs(K,{maxWidth:"sm",sx:{py:3},children:[e.jsxs(i,{sx:{mb:3,p:2,bgcolor:"primary.light",borderRadius:3,display:"flex",alignItems:"center",gap:2,color:"primary.contrastText"},children:[e.jsx(I,{sx:{bgcolor:"white",color:"primary.main"},children:e.jsx(Y,{})}),e.jsxs(i,{children:[e.jsxs(a,{variant:"subtitle1",sx:{fontWeight:"bold"},children:[l.length," Products Need Restocking"]}),e.jsx(a,{variant:"caption",children:"Select items and send orders to suppliers."})]})]}),l.length===0?e.jsxs(i,{sx:{textAlign:"center",py:10},children:[e.jsx(F,{sx:{fontSize:60,opacity:.2,mb:2}}),e.jsx(a,{color:"text.secondary",children:"All products are within safe stock levels."})]}):e.jsx(O,{useWindowScroll:!0,data:h,itemContent:(t,r)=>{if(r.type==="header"){const s=l.some(o=>(o.triggerSupplierId||"unassigned")===r.supplierId&&u.has(o.id));return e.jsxs(i,{sx:{mt:3,mb:1,px:1},children:[e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(p,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(q,{sx:{color:"text.secondary",fontSize:"1.2rem"}}),e.jsxs(a,{variant:"subtitle2",sx:{fontWeight:"bold",textTransform:"uppercase",letterSpacing:1,color:"text.secondary"},children:[r.supplierName,e.jsx(g,{size:"small",label:r.count,sx:{ml:1,height:20,fontSize:"0.65rem",fontWeight:"bold"}})]})]}),r.supplierId!=="unassigned"&&e.jsx(f,{size:"small",variant:"contained",startIcon:e.jsx(le,{}),disabled:!s,onClick:()=>P(r.supplierId),sx:{borderRadius:2,textTransform:"none",fontWeight:"bold"},children:"Send"})]}),e.jsx(J,{sx:{mt:1}})]})}if(r.type==="product"){const s=r.product,o=(s.stock||0)+(s.returnStock||0),n=u.has(s.id);return e.jsxs(i,{sx:{py:.75,display:"flex",alignItems:"center",gap:1},children:[e.jsx(V,{checked:n,onChange:()=>D(s.id),size:"small"}),e.jsx(k,{variant:"outlined",sx:{p:2,borderRadius:3,border:1,borderColor:n?"primary.main":"divider",flex:1,bgcolor:n?"action.hover":"background.paper",transition:"all 0.2s"},children:e.jsxs(p,{direction:"row",spacing:2,alignItems:"center",children:[e.jsxs(i,{flex:1,children:[e.jsx(a,{variant:"subtitle1",sx:{fontWeight:"bold"},children:s.name}),s.sku&&e.jsxs(a,{variant:"caption",color:"text.secondary",children:["SKU: ",s.sku]}),e.jsxs(p,{direction:"row",spacing:1,sx:{mt:1},children:[e.jsx(g,{size:"small",icon:e.jsx(X,{sx:{fontSize:"0.8rem !important"}}),label:`Stock: ${o}`,color:"error",variant:"outlined",sx:{borderRadius:1.5,fontWeight:"bold"}}),e.jsx(g,{size:"small",label:`Min: ${s.triggerBelow}`,variant:"outlined",sx:{borderRadius:1.5}})]})]}),e.jsxs(i,{sx:{width:80},children:[e.jsx(a,{variant:"caption",sx:{display:"block",fontWeight:"bold",color:"success.main",textTransform:"uppercase",mb:.5,textAlign:"center"},children:"Input Qty"}),e.jsx(Z,{size:"small",type:"number",value:x[s.id]??0,onChange:N=>T(s.id,Number(N.target.value)),inputProps:{style:{textAlign:"center",fontWeight:"bold"}},variant:"standard",sx:{borderRadius:1,border:1,borderColor:"success.main","& .MuiInput-root":{"&:before, &:after":{display:"none"}}}})]})]})})]})}return null}})]}),e.jsxs(te,{open:z,onClose:()=>y(!1),fullWidth:!0,maxWidth:"xs",PaperProps:{sx:{borderRadius:3}},children:[e.jsx(re,{sx:{fontWeight:"bold",pb:1,textAlign:"center"},children:"Select Contact"}),e.jsx(se,{children:e.jsx(ee,{disablePadding:!0,children:c.find(t=>t.id===m)?.contacts?.map((t,r)=>e.jsx(k,{variant:"outlined",sx:{mb:2,borderRadius:3,overflow:"hidden",border:1,borderColor:"divider"},children:e.jsx(oe,{disablePadding:!0,children:e.jsxs(i,{sx:{p:2,width:"100%"},children:[e.jsxs(p,{direction:"row",spacing:2,alignItems:"center",sx:{mb:2},children:[e.jsx(I,{sx:{bgcolor:"primary.light",color:"primary.main",width:44,height:44},children:e.jsx(ne,{})}),e.jsxs(i,{sx:{flex:1},children:[e.jsx(a,{variant:"subtitle1",fontWeight:"bold",sx:{lineHeight:1.2},children:t.name}),e.jsx(a,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:t.phone||"No Phone"})]})]}),e.jsxs(b,{container:!0,spacing:1,children:[e.jsx(b,{size:6,children:e.jsx(f,{fullWidth:!0,size:"small",variant:"outlined",startIcon:e.jsx(ie,{}),onClick:()=>E(t),sx:{color:"#25D366",borderColor:"#25D366",borderRadius:2,textTransform:"none",fontWeight:"bold","&:hover":{borderColor:"#128C7E",bgcolor:"rgba(37, 211, 102, 0.05)"}},children:"WhatsApp"})}),e.jsx(b,{size:6,children:e.jsx(f,{fullWidth:!0,size:"small",variant:"outlined",startIcon:e.jsx(ae,{}),onClick:()=>$(t),sx:{borderRadius:2,textTransform:"none",fontWeight:"bold"},children:"Email"})})]})]})})},r))})})]})]})}export{Te as component};
